<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Microscopy module | DIPlib | a library for quantitative image analysis</title>
  <link rel="stylesheet" href="m-dip+documentation.compiled.css" />
  <link rel="icon" href="DIPlib_logo_32.png" type="image/png" />
  <link rel="search" type="application/opensearchdescription+xml" href="opensearch.xml" title="Search DIPlib documentation" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#ffffff" />
</head>
<body>
<header><nav id="navigation">
  <div class="m-container">
    <div class="m-row">
      <span id="m-navbar-brand" class="m-col-t-8 m-col-m-none m-left-m">
        <a href="https://diplib.org"><img src="DIPlib_logo.svg" alt="" />DIPlib</a><span class="m-breadcrumb">┃</span><a href="index.html" class="m-thin">a library for quantitative image analysis</a><span class="m-breadcrumb">┃</span><a href="https://github.com/DIPlib/diplib/releases/tag/3.3.0" class="m-thin">version 3.3.0</a>      </span>
      <div class="m-col-t-4 m-hide-m m-text-right m-nopadr">
        <a href="#search" class="m-doc-search-icon" title="Search" onclick="return showSearch()"><svg style="height: 0.9rem;" viewBox="0 0 16 16">
          <path id="m-doc-search-icon-path" d="m6 0c-3.31 0-6 2.69-6 6 0 3.31 2.69 6 6 6 1.49 0 2.85-0.541 3.89-1.44-0.0164 0.338 0.147 0.759 0.5 1.15l3.22 3.79c0.552 0.614 1.45 0.665 2 0.115 0.55-0.55 0.499-1.45-0.115-2l-3.79-3.22c-0.392-0.353-0.812-0.515-1.15-0.5 0.895-1.05 1.44-2.41 1.44-3.89 0-3.31-2.69-6-6-6zm0 1.56a4.44 4.44 0 0 1 4.44 4.44 4.44 4.44 0 0 1-4.44 4.44 4.44 4.44 0 0 1-4.44-4.44 4.44 4.44 0 0 1 4.44-4.44z"/>
        </svg></a>
        <a id="m-navbar-show" href="#navigation" title="Show navigation"></a>
        <a id="m-navbar-hide" href="#" title="Hide navigation"></a>
      </div>
      <div id="m-navbar-collapse" class="m-col-t-12 m-show-m m-col-m-none m-right-m">
        <div class="m-row">
          <ol class="m-col-t-6 m-col-m-none">
            <li><a href="pages.html">Pages</a></li>
            <li><a href="modules.html">Modules</a></li>
          </ol>
          <ol class="m-col-t-6 m-col-m-none" start="3">
            <li><a href="classes.html">Classes</a></li>
            <li><a href="files.html">Files</a></li>
            <li class="m-show-m"><a href="#search" class="m-doc-search-icon" title="Search" onclick="return showSearch()"><svg style="height: 0.9rem;" viewBox="0 0 16 16">
              <use href="#m-doc-search-icon-path" />
            </svg></a></li>
          </ol>
        </div>
      </div>
    </div>
  </div>
</nav></header>
<main><article>
  <div class="m-container m-container-inflatable">
    <div class="m-row">
      <div class="m-col-l-10 m-push-l-1">
        <h1>
          Microscopy <span class="m-thin">module</span>          <div class="m-doc-include m-code m-inverted m-text-right"><span class="cp">#include</span> <a class="cpf" href="file--diplib--microscopy-h.html">"diplib/microscopy.h"</a></div>
        </h1>
        <p>Assorted tools useful in microscopy, some presumably also in astronomy and other applications.</p>
        <div class="m-block m-default">
          <h3>Contents</h3>
          <ul>
            <li>
              Reference
              <ul>
                <li><a href="#nested-classes">Classes</a></li>
                <li><a href="#function-members">Functions</a></li>
              </ul>
            </li>
          </ul>
        </div>
        <section id="nested-classes">
          <h2>Classes</h2>
          <dl class="m-doc">
            <dt>
              struct <a href="#dip-ColocalizationCoefficients" class="m-doc">dip::<wbr />ColocalizationCoefficients</a>
            </dt>
            <dd>Holds Colocalization Coefficients as described by Manders, see <a href="microscopy.html#dip-MandersColocalizationCoefficients-dip-Image-CL-dip-Image-CL-dip-Image-CL-dip-dfloat--dip-dfloat-"><code>dip::MandersColocalizationCoefficients</code></a>.</dd>
          </dl>
        </section>
        <section id="function-members">
          <h2>Functions</h2>
          <dl class="m-doc">
            <dt>
              <span class="m-doc-wrap-bumper">void <a href="#dip-BeerLambertMapping-dip-Image-CL-dip-Image-L-Image-Pixel-CL" class="m-doc">dip::<wbr />BeerLambertMapping</a>(</span><span class="m-doc-wrap"><a href="dip-Image.html" class="m-doc">dip::Image</a> const&amp; in,
              <a href="dip-Image.html" class="m-doc">dip::Image</a>&amp; out,
              <a href="dip-Image-Pixel.html" class="m-doc">dip::Image::Pixel</a> const&amp; background)</span>
            </dt>
            <dd>Applies a logarithmic mapping to a transmittance image to obtain an absorbance image</dd>
            <dt>
              <span class="m-doc-wrap-bumper">void <a href="#dip-InverseBeerLambertMapping-dip-Image-CL-dip-Image-L-Image-Pixel-CL" class="m-doc">dip::<wbr />InverseBeerLambertMapping</a>(</span><span class="m-doc-wrap"><a href="dip-Image.html" class="m-doc">dip::Image</a> const&amp; in,
              <a href="dip-Image.html" class="m-doc">dip::Image</a>&amp; out,
              <a href="dip-Image-Pixel.html" class="m-doc">dip::Image::Pixel</a> const&amp; background = {255})</span>
            </dt>
            <dd>Applies an exponential mapping to an absorbance image to obtain a transmittance image</dd>
            <dt>
              <span class="m-doc-wrap-bumper">void <a href="#dip-UnmixStains-dip-Image-CL-dip-Image-L-std-vector<Image-Pixel>-CL" class="m-doc">dip::<wbr />UnmixStains</a>(</span><span class="m-doc-wrap"><a href="dip-Image.html" class="m-doc">dip::Image</a> const&amp; in,
              <a href="dip-Image.html" class="m-doc">dip::Image</a>&amp; out,
              std::vector&lt;Image::Pixel&gt; const&amp; stains)</span>
            </dt>
            <dd>Unmixes stains in a brightfield absorbance image or a fluorescence emission image.</dd>
            <dt>
              <span class="m-doc-wrap-bumper">void <a href="#dip-MixStains-dip-Image-CL-dip-Image-L-std-vector<Image-Pixel>-CL" class="m-doc">dip::<wbr />MixStains</a>(</span><span class="m-doc-wrap"><a href="dip-Image.html" class="m-doc">dip::Image</a> const&amp; in,
              <a href="dip-Image.html" class="m-doc">dip::Image</a>&amp; out,
              std::vector&lt;Image::Pixel&gt; const&amp; stains)</span>
            </dt>
            <dd>Composes a color image given stain densities and stain absorbance values (brightfield) or stain emission
values (fluorescence)</dd>
            <dt>
              <span class="m-doc-wrap-bumper">auto <a href="#dip-MandersOverlapCoefficient-dip-Image-CL-dip-Image-CL-dip-Image-CL" class="m-doc">dip::<wbr />MandersOverlapCoefficient</a>(</span><span class="m-doc-wrap"><a href="dip-Image.html" class="m-doc">dip::Image</a> const&amp; channel1,
              <a href="dip-Image.html" class="m-doc">dip::Image</a> const&amp; channel2,
              <a href="dip-Image.html" class="m-doc">dip::Image</a> const&amp; mask = {}) -&gt; <a href="pixeltypes.html#dip-dfloat" class="m-doc">dip::dfloat</a></span>
            </dt>
            <dd>Computes the Manders Overlap Coefficient.</dd>
            <dt>
              <span class="m-doc-wrap-bumper">auto <a href="#dip-IntensityCorrelationQuotient-dip-Image-CL-dip-Image-CL-dip-Image-CL" class="m-doc">dip::<wbr />IntensityCorrelationQuotient</a>(</span><span class="m-doc-wrap"><a href="dip-Image.html" class="m-doc">dip::Image</a> const&amp; channel1,
              <a href="dip-Image.html" class="m-doc">dip::Image</a> const&amp; channel2,
              <a href="dip-Image.html" class="m-doc">dip::Image</a> const&amp; mask = {}) -&gt; <a href="pixeltypes.html#dip-dfloat" class="m-doc">dip::dfloat</a></span>
            </dt>
            <dd>Computes Li&rsquo;s Intensity Correlation Quotient.</dd>
            <dt>
              <span class="m-doc-wrap-bumper">auto <a href="#dip-MandersColocalizationCoefficients-dip-Image-CL-dip-Image-CL-dip-Image-CL-dip-dfloat--dip-dfloat-" class="m-doc">dip::<wbr />MandersColocalizationCoefficients</a>(</span><span class="m-doc-wrap"><a href="dip-Image.html" class="m-doc">dip::Image</a> const&amp; channel1,
              <a href="dip-Image.html" class="m-doc">dip::Image</a> const&amp; channel2,
              <a href="dip-Image.html" class="m-doc">dip::Image</a> const&amp; mask = {},
              <a href="pixeltypes.html#dip-dfloat" class="m-doc">dip::dfloat</a> threshold1 = 0,
              <a href="pixeltypes.html#dip-dfloat" class="m-doc">dip::dfloat</a> threshold2 = 0) -&gt; <a href="microscopy.html#dip-ColocalizationCoefficients" class="m-doc">dip::ColocalizationCoefficients</a></span>
            </dt>
            <dd>Computes Manders&rsquo; Colocalization Coefficients.</dd>
            <dt>
              <span class="m-doc-wrap-bumper">auto <a href="#dip-CostesColocalizationCoefficients-dip-Image-CL-dip-Image-CL-dip-Image-CL" class="m-doc">dip::<wbr />CostesColocalizationCoefficients</a>(</span><span class="m-doc-wrap"><a href="dip-Image.html" class="m-doc">dip::Image</a> const&amp; channel1,
              <a href="dip-Image.html" class="m-doc">dip::Image</a> const&amp; channel2,
              <a href="dip-Image.html" class="m-doc">dip::Image</a> const&amp; mask = {}) -&gt; <a href="microscopy.html#dip-ColocalizationCoefficients" class="m-doc">dip::ColocalizationCoefficients</a></span>
            </dt>
            <dd>Computes Costes&rsquo; colocalization coefficients.</dd>
            <dt>
              <span class="m-doc-wrap-bumper">auto <a href="#dip-CostesSignificanceTest-dip-Image-CL-dip-Image-CL-dip-Image-CL-dip-Random-L-dip-UnsignedArray--dip-uint-" class="m-doc">dip::<wbr />CostesSignificanceTest</a>(</span><span class="m-doc-wrap"><a href="dip-Image.html" class="m-doc">dip::Image</a> const&amp; channel1,
              <a href="dip-Image.html" class="m-doc">dip::Image</a> const&amp; channel2,
              <a href="dip-Image.html" class="m-doc">dip::Image</a> const&amp; mask,
              <a href="dip-Random.html" class="m-doc">dip::Random</a>&amp; random,
              <a href="supporttypes.html#dip-UnsignedArray" class="m-doc">dip::UnsignedArray</a> blockSizes = {3},
              <a href="supporttypes.html#dip-uint" class="m-doc">dip::uint</a> repetitions = 200) -&gt; <a href="pixeltypes.html#dip-dfloat" class="m-doc">dip::dfloat</a></span>
            </dt>
            <dd>Computes Costes&rsquo; test of significance of true colocalization</dd>
            <dt id="dip-CostesSignificanceTest-dip-Image-CL-dip-Image-CL-dip-Image-CL-dip-UnsignedArray--dip-uint-">
              <span class="m-doc-wrap-bumper">auto <a href="#dip-CostesSignificanceTest-dip-Image-CL-dip-Image-CL-dip-Image-CL-dip-UnsignedArray--dip-uint-" class="m-doc-self">dip::<wbr />CostesSignificanceTest</a>(</span><span class="m-doc-wrap"><a href="dip-Image.html" class="m-doc">dip::Image</a> const&amp; channel1,
              <a href="dip-Image.html" class="m-doc">dip::Image</a> const&amp; channel2,
              <a href="dip-Image.html" class="m-doc">dip::Image</a> const&amp; mask = {},
              <a href="supporttypes.html#dip-UnsignedArray" class="m-doc">dip::UnsignedArray</a> blockSizes = {3},
              <a href="supporttypes.html#dip-uint" class="m-doc">dip::uint</a> repetitions = 200) -&gt; <a href="pixeltypes.html#dip-dfloat" class="m-doc">dip::dfloat</a></span>
            </dt>
            <dd>Like above, using a default-initialized <a href="dip-Random.html"><code>dip::Random</code></a> object.</dd>
            <dt>
              <span class="m-doc-wrap-bumper">void <a href="#dip-IncoherentOTF-dip-Image-L-dip-dfloat--dip-dfloat--dip-dfloat--dip-String-CL" class="m-doc">dip::<wbr />IncoherentOTF</a>(</span><span class="m-doc-wrap"><a href="dip-Image.html" class="m-doc">dip::Image</a>&amp; out,
              <a href="pixeltypes.html#dip-dfloat" class="m-doc">dip::dfloat</a> defocus = 0,
              <a href="pixeltypes.html#dip-dfloat" class="m-doc">dip::dfloat</a> oversampling = 1,
              <a href="pixeltypes.html#dip-dfloat" class="m-doc">dip::dfloat</a> amplitude = 1,
              <a href="supporttypes.html#dip-String" class="m-doc">dip::String</a> const&amp; method = "Stokseth")</span>
            </dt>
            <dd>Generates an incoherent OTF (optical transfer function)</dd>
            <dt>
              <span class="m-doc-wrap-bumper">void <a href="#dip-IncoherentPSF-dip-Image-L-dip-dfloat--dip-dfloat-" class="m-doc">dip::<wbr />IncoherentPSF</a>(</span><span class="m-doc-wrap"><a href="dip-Image.html" class="m-doc">dip::Image</a>&amp; out,
              <a href="pixeltypes.html#dip-dfloat" class="m-doc">dip::dfloat</a> oversampling = 1,
              <a href="pixeltypes.html#dip-dfloat" class="m-doc">dip::dfloat</a> amplitude = 1)</span>
            </dt>
            <dd>Generates an incoherent PSF (point spread function)</dd>
            <dt>
              <span class="m-doc-wrap-bumper">void <a href="#dip-WienerDeconvolution-dip-Image-CL-dip-Image-CL-dip-Image-CL-dip-Image-CL-dip-Image-L-dip-StringSet-CL" class="m-doc">dip::<wbr />WienerDeconvolution</a>(</span><span class="m-doc-wrap"><a href="dip-Image.html" class="m-doc">dip::Image</a> const&amp; in,
              <a href="dip-Image.html" class="m-doc">dip::Image</a> const&amp; psf,
              <a href="dip-Image.html" class="m-doc">dip::Image</a> const&amp; signalPower,
              <a href="dip-Image.html" class="m-doc">dip::Image</a> const&amp; noisePower,
              <a href="dip-Image.html" class="m-doc">dip::Image</a>&amp; out,
              <a href="supporttypes.html#dip-StringSet" class="m-doc">dip::StringSet</a> const&amp; options = {})</span>
            </dt>
            <dd>Wiener Deconvolution using estimates of signal and noise power</dd>
            <dt>
              <span class="m-doc-wrap-bumper">void <a href="#dip-WienerDeconvolution-dip-Image-CL-dip-Image-CL-dip-Image-L-dip-dfloat--dip-StringSet-CL" class="m-doc">dip::<wbr />WienerDeconvolution</a>(</span><span class="m-doc-wrap"><a href="dip-Image.html" class="m-doc">dip::Image</a> const&amp; in,
              <a href="dip-Image.html" class="m-doc">dip::Image</a> const&amp; psf,
              <a href="dip-Image.html" class="m-doc">dip::Image</a>&amp; out,
              <a href="pixeltypes.html#dip-dfloat" class="m-doc">dip::dfloat</a> regularization = 1e-4,
              <a href="supporttypes.html#dip-StringSet" class="m-doc">dip::StringSet</a> const&amp; options = {})</span>
            </dt>
            <dd>Wiener Deconvolution using an estimate of noise-to-signal ratio</dd>
            <dt>
              <span class="m-doc-wrap-bumper">void <a href="#dip-ExponentialFitCorrection-dip-Image-CL-dip-Image-CL-dip-Image-L-dip-dfloat--dip-String-CL-dip-dfloat--dip-String-CL" class="m-doc">dip::<wbr />ExponentialFitCorrection</a>(</span><span class="m-doc-wrap"><a href="dip-Image.html" class="m-doc">dip::Image</a> const&amp; in,
              <a href="dip-Image.html" class="m-doc">dip::Image</a> const&amp; mask,
              <a href="dip-Image.html" class="m-doc">dip::Image</a>&amp; out,
              <a href="pixeltypes.html#dip-dfloat" class="m-doc">dip::dfloat</a> percentile = -1.0,
              <a href="supporttypes.html#dip-String" class="m-doc">dip::String</a> const&amp; fromWhere = "first plane",
              <a href="pixeltypes.html#dip-dfloat" class="m-doc">dip::dfloat</a> hysteresis = 1.0,
              <a href="supporttypes.html#dip-String" class="m-doc">dip::String</a> const&amp; weighting = "none")</span>
            </dt>
            <dd>3D fluorescence attenuation correction using an exponential fit</dd>
            <dt>
              <span class="m-doc-wrap-bumper">void <a href="#dip-AttenuationCorrection-dip-Image-CL-dip-Image-L-dip-dfloat--dip-dfloat--dip-dfloat--dip-dfloat--dip-dfloat--dip-dfloat--dip-String-CL" class="m-doc">dip::<wbr />AttenuationCorrection</a>(</span><span class="m-doc-wrap"><a href="dip-Image.html" class="m-doc">dip::Image</a> const&amp; in,
              <a href="dip-Image.html" class="m-doc">dip::Image</a>&amp; out,
              <a href="pixeltypes.html#dip-dfloat" class="m-doc">dip::dfloat</a> fAttenuation = 0.01,
              <a href="pixeltypes.html#dip-dfloat" class="m-doc">dip::dfloat</a> bAttenuation = 0.01,
              <a href="pixeltypes.html#dip-dfloat" class="m-doc">dip::dfloat</a> background = 0.0,
              <a href="pixeltypes.html#dip-dfloat" class="m-doc">dip::dfloat</a> threshold = 0.0,
              <a href="pixeltypes.html#dip-dfloat" class="m-doc">dip::dfloat</a> NA = 1.4,
              <a href="pixeltypes.html#dip-dfloat" class="m-doc">dip::dfloat</a> refIndex = 1.518,
              <a href="supporttypes.html#dip-String" class="m-doc">dip::String</a> const&amp; method = "DET")</span>
            </dt>
            <dd>3D fluorescence attenuation correction using one of three iterative algorithms</dd>
            <dt>
              <span class="m-doc-wrap-bumper">void <a href="#dip-SimulatedAttenuation-dip-Image-CL-dip-Image-L-dip-dfloat--dip-dfloat--dip-dfloat--dip-dfloat--dip-uint--dip-dfloat-" class="m-doc">dip::<wbr />SimulatedAttenuation</a>(</span><span class="m-doc-wrap"><a href="dip-Image.html" class="m-doc">dip::Image</a> const&amp; in,
              <a href="dip-Image.html" class="m-doc">dip::Image</a>&amp; out,
              <a href="pixeltypes.html#dip-dfloat" class="m-doc">dip::dfloat</a> fAttenuation = 0.01,
              <a href="pixeltypes.html#dip-dfloat" class="m-doc">dip::dfloat</a> bAttenuation = 0.01,
              <a href="pixeltypes.html#dip-dfloat" class="m-doc">dip::dfloat</a> NA = 1.4,
              <a href="pixeltypes.html#dip-dfloat" class="m-doc">dip::dfloat</a> refIndex = 1.518,
              <a href="supporttypes.html#dip-uint" class="m-doc">dip::uint</a> oversample = 1,
              <a href="pixeltypes.html#dip-dfloat" class="m-doc">dip::dfloat</a> rayStep = 1)</span>
            </dt>
            <dd>3D fluorescence attenuation simulation</dd>
          </dl>
        </section>
        <section>
            <h2>Class documentation</h2>
                      <section class="m-doc-details" id="dip-ColocalizationCoefficients"><div>
            <h3>
              struct <a href="#dip-ColocalizationCoefficients" class="m-doc-self">dip::<wbr />ColocalizationCoefficients</a>
            </h3>
            <p>Holds Colocalization Coefficients as described by Manders, see <a href="microscopy.html#dip-MandersColocalizationCoefficients-dip-Image-CL-dip-Image-CL-dip-Image-CL-dip-dfloat--dip-dfloat-"><code>dip::MandersColocalizationCoefficients</code></a>.</p>
            <table class="m-table m-fullwidth m-first-tight m-flat m-doc">
              <thead><tr><th>Variables</th><th></th></tr></thead>
              <tbody>
                <tr>
                  <td>
                  <a href="pixeltypes.html#dip-dfloat" class="m-doc">dip::dfloat</a> <a href="#dip-ColocalizationCoefficients-M1" class="m-doc-self" id="dip-ColocalizationCoefficients-M1">M1</a>                  </td>
                  <td>
                  Proportional to the fraction of fluorescence in channel 1 that colocalizes.
                  </td>
                </tr>
                <tr>
                  <td>
                  <a href="pixeltypes.html#dip-dfloat" class="m-doc">dip::dfloat</a> <a href="#dip-ColocalizationCoefficients-M2" class="m-doc-self" id="dip-ColocalizationCoefficients-M2">M2</a>                  </td>
                  <td>
                  Proportional to the fraction of fluorescence in channel 2 that colocalizes.
                  </td>
                </tr>
              </tbody>
            </table>
          </div></section>
        </section>
        <section>
          <h2>Function documentation</h2>
          <section class="m-doc-details" id="dip-BeerLambertMapping-dip-Image-CL-dip-Image-L-Image-Pixel-CL"><div>
            <h3>
              <span class="m-doc-wrap-bumper">void
                </span><span class="m-doc-wrap"><span class="m-doc-wrap-bumper"><a href="#dip-BeerLambertMapping-dip-Image-CL-dip-Image-L-Image-Pixel-CL" class="m-doc-self">dip::<wbr />BeerLambertMapping</a>(</span><span class="m-doc-wrap"><a href="dip-Image.html" class="m-doc">dip::Image</a> const&amp; in,
              <a href="dip-Image.html" class="m-doc">dip::Image</a>&amp; out,
              <a href="dip-Image-Pixel.html" class="m-doc">dip::Image::Pixel</a> const&amp; background)</span></span>
            </h3>
            <p>Applies a logarithmic mapping to a transmittance image to obtain an absorbance image</p>
<p>The Beer-Lambert law describes how light is attenuated as it travels through an absorbing medium.
In brightfield microscopy, this law describes the relationship between the intensity of the transmitted
light and the absorbance of the stains on the slide, which provide contrast. The absorbance is influenced
by different factors, but for a given dye molecule, the concentration is directly proportional to the
absorbance. Thus, estimating absorbance yields an estimate of the relative dye concentration at each image
pixel.</p>
<p>This function applies the mapping <span class="m-math"><svg style="width: 0.732em; height: 0.796em; vertical-align: -0.000em; " viewBox=".29 -7.96 7.32 7.96">
<title>
\(A\)
</title>
<defs>
<path id='eq81-g1-22' d='M6.72 0V-.19C6.04-.25 5.96-.35 5.81-1.21L4.69-7.96H4.38L.93-2C-.01-.42-.13-.29-.61-.19V0H1.62V-.19C1.01-.25 .92-.31 .92-.61C.92-.83 .95-.94 1.16-1.35L1.83-2.69H4.45L4.69-1.13C4.7-1.02 4.72-.92 4.72-.82C4.72-.37 4.55-.26 3.79-.19V0H6.72ZM4.39-3.12H2.08L3.87-6.22L4.39-3.12Z'/>
</defs>
<g id='eq81-page1'>
<use x='.9' y='0' xlink:href='#eq81-g1-22'/>
</g>
</svg></span> to the intensities <span class="m-math"><svg style="width: 0.467em; height: 0.778em; vertical-align: -0.000em; " viewBox=".39 -7.78 4.67 7.78">
<title>
\(I\)
</title>
<defs>
<path id='eq82-g1-30' d='M2.81 0V-.19C2.13-.27 2-.35 2-.68C2-.92 2.02-1.04 2.13-1.43L3.6-6.71C3.81-7.4 3.88-7.47 4.57-7.59V-7.78H1.63V-7.59C2.32-7.5 2.47-7.42 2.47-7.07C2.47-6.9 2.43-6.66 2.33-6.34L.87-1.07C.66-.38 .57-.31-.1-.19V0H2.81Z'/>
</defs>
<g id='eq82-page1'>
<use x='.49' y='0' xlink:href='#eq82-g1-30'/>
</g>
</svg></span> in image <code>in</code>.</p>
<div class="m-math"><svg style="width: 9.108em; height: 1.099em; vertical-align: 0.003em; " viewBox="148.48 -11.02 91.08 10.99">
<title>
\[ A = -log_{10}(I/I_0) \; , \]
</title>
<defs>
<path id='eq80-g4-0' d='M6.84-2.73V-3.39H.74V-2.73H6.84Z'/>
<path id='eq80-g4-157' d='M.74 2.3H1.36L4.74-8.42H4.12L.74 2.3Z'/>
<path id='eq80-g4-185' d='M3.51-8.54C1.79-7.42 .57-5.49 .57-3.06C.57-.85 1.83 1.39 3.48 2.41L3.62 2.22C2.05 .98 1.6-.46 1.6-3.1C1.6-5.74 2.08-7.11 3.62-8.35L3.51-8.54Z'/>
<path id='eq80-g4-186' d='M.45-8.54L.35-8.35C1.88-7.11 2.37-5.74 2.37-3.1C2.37-.46 1.92 .98 .35 2.22L.49 2.41C2.13 1.39 3.39-.85 3.39-3.06C3.39-5.49 2.18-7.42 .45-8.54Z'/>
<path id='eq80-g1-61' d='M6.57-3.93V-4.6H.48V-3.93H6.57ZM6.57-1.51V-2.18H.48V-1.51H6.57Z'/>
<path id='eq80-g11-48' d='M4.16-2.88C4.16-4.67 3.36-5.9 2.22-5.9C1.74-5.9 1.37-5.76 1.05-5.45C.54-4.96 .21-3.96 .21-2.93C.21-1.98 .5-.96 .91-.47C1.23-.09 1.68 .12 2.18 .12C2.63 .12 3-.03 3.32-.33C3.83-.81 4.16-1.83 4.16-2.88ZM3.32-2.86C3.32-1.04 2.93-.1 2.18-.1S1.05-1.04 1.05-2.86C1.05-4.71 1.44-5.68 2.19-5.68C2.93-5.68 3.32-4.69 3.32-2.86Z'/>
<path id='eq80-g11-49' d='M3.44 0V-.13C2.75-.14 2.61-.23 2.61-.65V-5.89L2.54-5.9L.97-5.11V-4.99C1.07-5.03 1.17-5.07 1.21-5.08C1.36-5.14 1.51-5.18 1.6-5.18C1.78-5.18 1.86-5.05 1.86-4.77V-.81C1.86-.52 1.79-.32 1.65-.24C1.52-.17 1.4-.14 1.03-.13V0H3.44Z'/>
<path id='eq80-g7-22' d='M6.72 0V-.19C6.04-.25 5.96-.35 5.81-1.21L4.69-7.96H4.38L.93-2C-.01-.42-.13-.29-.61-.19V0H1.62V-.19C1.01-.25 .92-.31 .92-.61C.92-.83 .95-.94 1.16-1.35L1.83-2.69H4.45L4.69-1.13C4.7-1.02 4.72-.92 4.72-.82C4.72-.37 4.55-.26 3.79-.19V0H6.72ZM4.39-3.12H2.08L3.87-6.22L4.39-3.12Z'/>
<path id='eq80-g7-30' d='M2.81 0V-.19C2.13-.27 2-.35 2-.68C2-.92 2.02-1.04 2.13-1.43L3.6-6.71C3.81-7.4 3.88-7.47 4.57-7.59V-7.78H1.63V-7.59C2.32-7.5 2.47-7.42 2.47-7.07C2.47-6.9 2.43-6.66 2.33-6.34L.87-1.07C.66-.38 .57-.31-.1-.19V0H2.81Z'/>
<path id='eq80-g7-54' d='M4.6 .71C4.59-.04 4.01-.56 2.87-.86C2.35-.99 2.04-1.18 2.04-1.36S2.31-1.85 2.47-1.85C2.47-1.85 2.51-1.85 2.55-1.83C2.64-1.81 2.81-1.8 2.92-1.8C4-1.8 5.1-2.75 5.1-3.68C5.1-3.88 5.06-4.11 4.99-4.36H5.59L5.57-4.82H4.85C4.81-4.82 4.75-4.85 4.66-4.92C4.34-5.13 3.94-5.25 3.49-5.25C2.17-5.25 1.11-4.34 1.11-3.22C1.12-2.6 1.38-2.24 2.06-1.93C1.37-1.45 1.16-1.21 1.16-.93C1.16-.77 1.26-.63 1.49-.46C.35 .29 .11 .54 .11 1.06C.11 1.92 .88 2.45 2.11 2.45C3.61 2.45 4.6 1.75 4.6 .71ZM3.88 1.07C3.88 1.72 3.2 2.19 2.29 2.19C1.33 2.19 .76 1.74 .76 .98C.76 .69 .82 .49 1.01 .26C1.17 .06 1.67-.33 1.76-.33C1.76-.33 1.8-.32 1.82-.31L2.17-.2C3.43 .19 3.87 .52 3.88 1.07ZM3.8-2.8C3.54-2.31 3.17-2.05 2.76-2.05C2.3-2.05 2.05-2.39 2.05-2.97C2.05-4.05 2.72-4.99 3.48-4.99C3.92-4.99 4.14-4.7 4.16-4.14C4.16-3.73 4.01-3.2 3.8-2.8Z'/>
<path id='eq80-g7-59' d='M2.87-1.36L2.72-1.46C2.61-1.33 2.5-1.19 2.41-1.06C2.01-.56 1.8-.38 1.58-.38C1.46-.38 1.41-.45 1.41-.6C1.41-.71 1.46-.95 1.52-1.18L3.32-8.08L3.26-8.13C2.56-7.98 2.11-7.9 1.41-7.81V-7.62H1.61C1.98-7.62 2.22-7.52 2.22-7.35C2.22-7.31 2.2-7.23 2.17-7.13L.54-.85C.5-.73 .49-.63 .49-.54C.49-.1 .69 .13 1.07 .13C1.69 .13 2.1-.21 2.87-1.36Z'/>
<path id='eq80-g7-62' d='M5.57-3.59C5.57-4.57 4.88-5.25 3.87-5.25C3.38-5.25 2.93-5.13 2.47-4.88C1.21-4.22 .32-2.82 .32-1.54C.32-.5 .99 .13 2.07 .13C2.86 .13 3.62-.21 4.31-.91C5.1-1.68 5.57-2.68 5.57-3.59ZM4.57-3.88C4.57-3.03 4.2-1.87 3.69-1.1C3.24-.44 2.78-.12 2.25-.12C1.69-.12 1.32-.55 1.32-1.2C1.32-2.06 1.66-3.08 2.2-3.92C2.68-4.63 3.2-5 3.73-5C4.24-5 4.57-4.56 4.57-3.88Z'/>
<path id='eq80-g7-150' d='M2.32-.07C2.32-1.06 1.63-1.21 1.36-1.21C1.06-1.21 .67-1.04 .67-.52C.67-.05 1.1 .07 1.41 .07C1.49 .07 1.55 .06 1.58 .05C1.63 .04 1.67 .02 1.69 .02C1.77 .02 1.86 .08 1.86 .19C1.86 .42 1.67 .95 .88 1.45L.99 1.68C1.35 1.56 2.32 .77 2.32-.07Z'/>
</defs>
<g id='eq80-page1'>
<use x='149.08' y='-2.48' xlink:href='#eq80-g7-22'/>
<use x='159.86' y='-2.48' xlink:href='#eq80-g1-61'/>
<use x='170.26' y='-2.48' xlink:href='#eq80-g4-0'/>
<use x='177.91' y='-2.48' xlink:href='#eq80-g7-59'/>
<use x='182.13' y='-2.48' xlink:href='#eq80-g7-62'/>
<use x='188.54' y='-2.48' xlink:href='#eq80-g7-54'/>
<use x='194.64' y='-.69' xlink:href='#eq80-g11-49'/>
<use x='199.02' y='-.69' xlink:href='#eq80-g11-48'/>
<use x='204.5' y='-2.48' xlink:href='#eq80-g4-185'/>
<use x='209.45' y='-2.48' xlink:href='#eq80-g7-30'/>
<use x='214.31' y='-2.48' xlink:href='#eq80-g4-157'/>
<use x='220.29' y='-2.48' xlink:href='#eq80-g7-30'/>
<use x='224.45' y='-.69' xlink:href='#eq80-g11-48'/>
<use x='229.34' y='-2.48' xlink:href='#eq80-g4-186'/>
<use x='237.24' y='-2.48' xlink:href='#eq80-g7-150'/>
</g>
</svg></div>
<p>with <span class="m-math"><svg style="width: 0.841em; height: 0.969em; vertical-align: -0.191em; " viewBox=".39 -7.78 8.41 9.69">
<title>
\(I_0\)
</title>
<defs>
<path id='eq83-g5-48' d='M4.16-2.88C4.16-4.67 3.36-5.9 2.22-5.9C1.74-5.9 1.37-5.76 1.05-5.45C.54-4.96 .21-3.96 .21-2.93C.21-1.98 .5-.96 .91-.47C1.23-.09 1.68 .12 2.18 .12C2.63 .12 3-.03 3.32-.33C3.83-.81 4.16-1.83 4.16-2.88ZM3.32-2.86C3.32-1.04 2.93-.1 2.18-.1S1.05-1.04 1.05-2.86C1.05-4.71 1.44-5.68 2.19-5.68C2.93-5.68 3.32-4.69 3.32-2.86Z'/>
<path id='eq83-g1-30' d='M2.81 0V-.19C2.13-.27 2-.35 2-.68C2-.92 2.02-1.04 2.13-1.43L3.6-6.71C3.81-7.4 3.88-7.47 4.57-7.59V-7.78H1.63V-7.59C2.32-7.5 2.47-7.42 2.47-7.07C2.47-6.9 2.43-6.66 2.33-6.34L.87-1.07C.66-.38 .57-.31-.1-.19V0H2.81Z'/>
</defs>
<g id='eq83-page1'>
<use x='.49' y='0' xlink:href='#eq83-g1-30'/>
<use x='4.65' y='1.79' xlink:href='#eq83-g5-48'/>
</g>
</svg></span> the intensity of the illumination (<code>background</code>), and <span class="m-math"><svg style="width: 0.732em; height: 0.796em; vertical-align: -0.000em; " viewBox=".29 -7.96 7.32 7.96">
<title>
\(A\)
</title>
<defs>
<path id='eq84-g1-22' d='M6.72 0V-.19C6.04-.25 5.96-.35 5.81-1.21L4.69-7.96H4.38L.93-2C-.01-.42-.13-.29-.61-.19V0H1.62V-.19C1.01-.25 .92-.31 .92-.61C.92-.83 .95-.94 1.16-1.35L1.83-2.69H4.45L4.69-1.13C4.7-1.02 4.72-.92 4.72-.82C4.72-.37 4.55-.26 3.79-.19V0H6.72ZM4.39-3.12H2.08L3.87-6.22L4.39-3.12Z'/>
</defs>
<g id='eq84-page1'>
<use x='.9' y='0' xlink:href='#eq84-g1-22'/>
</g>
</svg></span> the absorbance written to <code>out</code>).</p>
<p><code>background</code> can be a single value or one value per tensor element (channel) in <code>in</code>. <code>out</code> will have the same
number of tensor elements. It should be estimated from a background region in the image, or from a
calibration image taken without a slide in the optical path.</p>
<p><code>in</code> must be real-valued. Values outside of the range [0,<code>background</code>] will be clipped.
<code>out</code> will be a floating-point type (do not force it to be an integer type, as the rounding will destroy
all data).</p>
          </div></section>
          <section class="m-doc-details" id="dip-InverseBeerLambertMapping-dip-Image-CL-dip-Image-L-Image-Pixel-CL"><div>
            <h3>
              <span class="m-doc-wrap-bumper">void
                </span><span class="m-doc-wrap"><span class="m-doc-wrap-bumper"><a href="#dip-InverseBeerLambertMapping-dip-Image-CL-dip-Image-L-Image-Pixel-CL" class="m-doc-self">dip::<wbr />InverseBeerLambertMapping</a>(</span><span class="m-doc-wrap"><a href="dip-Image.html" class="m-doc">dip::Image</a> const&amp; in,
              <a href="dip-Image.html" class="m-doc">dip::Image</a>&amp; out,
              <a href="dip-Image-Pixel.html" class="m-doc">dip::Image::Pixel</a> const&amp; background = {255})</span></span>
            </h3>
            <p>Applies an exponential mapping to an absorbance image to obtain a transmittance image</p>
<p>Applies the inverse mapping of <a href="microscopy.html#dip-BeerLambertMapping-dip-Image-CL-dip-Image-L-Image-Pixel-CL"><code>dip::BeerLambertMapping</code></a>, simulating the image obtained under a brightfield
microscope given the stain densities in the image <code>in</code>. <code>background</code> is the illumination intensity, values of
0 in the input will be mapped to the value of <code>background</code>, whereas larger input values will be mapped to darker
values. Input values should be relatively small, such that <code>background * dip::Exp10(-input)</code> can be represented
in the output data type. Best results are obtained when the input is in the range [0,1], but larger values are
allowed.</p>
<p><code>in</code> must be real-valued, negative values will be clipped to 0. <code>out</code> will be a floating-point type, unless
it was protected before calling this function (see <a href="dip-Image.html#dip-Image-Protect-bool-"><code>dip::Image::Protect</code></a>).</p>
          </div></section>
          <section class="m-doc-details" id="dip-UnmixStains-dip-Image-CL-dip-Image-L-std-vector<Image-Pixel>-CL"><div>
            <h3>
              <span class="m-doc-wrap-bumper">void
                </span><span class="m-doc-wrap"><span class="m-doc-wrap-bumper"><a href="#dip-UnmixStains-dip-Image-CL-dip-Image-L-std-vector<Image-Pixel>-CL" class="m-doc-self">dip::<wbr />UnmixStains</a>(</span><span class="m-doc-wrap"><a href="dip-Image.html" class="m-doc">dip::Image</a> const&amp; in,
              <a href="dip-Image.html" class="m-doc">dip::Image</a>&amp; out,
              std::vector&lt;Image::Pixel&gt; const&amp; stains)</span></span>
            </h3>
            <p>Unmixes stains in a brightfield absorbance image or a fluorescence emission image.</p>
<h2 id="unmixstains_brightfield">Brightfield</h2>
<p>A color image, obtained from a brightfield microscope, and converted to an absorbance image by
<a href="microscopy.html#dip-BeerLambertMapping-dip-Image-CL-dip-Image-L-Image-Pixel-CL"><code>dip::BeerLambertMapping</code></a>, can be separated into individual stains as long as there are no more
stains than channels. For an RGB image, up to three stains can be separated. For a multi-spectral
image, this number is larger.</p>
<p>The stain unmixing process requires knowledge of the absorption spectrum of each of the dyes on the slide.
These are usually determined using slides especially prepared with a single dye. Alternatively, find small
regions in the image where each stain is on its own (not mixed with other dyes). Below is a table
with values for some common dyes, which can be used as a first approximation. However, these
absorbance values depend on the tissue, tissue preparation and staining protocols, and imaging equipment.
Consequently, best results are always obtained with project-specific values.</p>
<p>The absorption of the dyes in each channel combine linearly with the density of each of the dyes,</p>
<div class="m-math"><svg style="width: 16.690em; height: 1.116em; vertical-align: -0.000em; " viewBox="110.45 -11.16 166.9 11.16">
<title>
\[ A_R = S_{R,1} d_1 + S_{R,2} d_2 + S_{R,3} d_3 + ... \]
</title>
<defs>
<path id='eq85-g4-184' d='M2.97-3.41H.36V-2.62H2.97V0H3.75V-2.62H6.36V-3.41H3.75V-6.03H2.97V-3.41Z'/>
<path id='eq85-g14-49' d='M3.44 0V-.13C2.75-.14 2.61-.23 2.61-.65V-5.89L2.54-5.9L.97-5.11V-4.99C1.07-5.03 1.17-5.07 1.21-5.08C1.36-5.14 1.51-5.18 1.6-5.18C1.78-5.18 1.86-5.05 1.86-4.77V-.81C1.86-.52 1.79-.32 1.65-.24C1.52-.17 1.4-.14 1.03-.13V0H3.44Z'/>
<path id='eq85-g14-50' d='M4.15-1.2L4.04-1.24C3.71-.74 3.6-.66 3.21-.66H1.12L2.59-2.2C3.36-3.01 3.7-3.68 3.7-4.36C3.7-5.23 3-5.9 2.09-5.9C1.61-5.9 1.15-5.71 .83-5.36C.55-5.07 .42-4.79 .27-4.17L.45-4.12C.8-4.98 1.12-5.26 1.72-5.26C2.45-5.26 2.95-4.76 2.95-4.03C2.95-3.35 2.55-2.53 1.82-1.76L.26-.1V0H3.67L4.15-1.2Z'/>
<path id='eq85-g14-51' d='M3.77-1.91C3.77-2.36 3.63-2.77 3.38-3.04C3.21-3.23 3.04-3.34 2.66-3.5C3.26-3.91 3.48-4.24 3.48-4.71C3.48-5.42 2.92-5.9 2.11-5.9C1.68-5.9 1.29-5.76 .98-5.48C.72-5.24 .59-5.01 .39-4.49L.52-4.45C.88-5.09 1.28-5.38 1.83-5.38C2.39-5.38 2.79-5 2.79-4.45C2.79-4.13 2.66-3.82 2.44-3.6C2.17-3.34 1.93-3.21 1.34-3V-2.88C1.85-2.88 2.05-2.86 2.26-2.79C2.8-2.59 3.14-2.1 3.14-1.49C3.14-.76 2.65-.19 2-.19C1.76-.19 1.59-.25 1.27-.46C1-.62 .86-.68 .71-.68C.51-.68 .38-.56 .38-.38C.38-.07 .75 .12 1.36 .12C2.04 .12 2.73-.1 3.14-.46S3.77-1.33 3.77-1.91Z'/>
<path id='eq85-g1-61' d='M6.57-3.93V-4.6H.48V-3.93H6.57ZM6.57-1.51V-2.18H.48V-1.51H6.57Z'/>
<path id='eq85-g7-22' d='M4.93 0V-.14C4.43-.18 4.37-.25 4.26-.89L3.44-5.83H3.21L.68-1.47C-.01-.31-.1-.21-.45-.14V0H1.19V-.14C.74-.18 .67-.23 .67-.45C.67-.61 .7-.69 .85-.99L1.35-1.97H3.27L3.44-.83C3.45-.75 3.46-.67 3.46-.6C3.46-.27 3.34-.19 2.78-.14V0H4.93ZM3.22-2.29H1.53L2.84-4.56L3.22-2.29Z'/>
<path id='eq85-g7-39' d='M4.95 0V-.14C4.57-.17 4.39-.31 4.23-.77L3.42-2.91C4.09-3.06 4.38-3.18 4.69-3.46C4.98-3.71 5.14-4.05 5.14-4.45C5.14-5.26 4.5-5.7 3.32-5.7H1.15V-5.56C1.52-5.51 1.56-5.5 1.66-5.44C1.72-5.4 1.77-5.29 1.77-5.2C1.77-5.09 1.74-4.88 1.67-4.65L.59-.79C.44-.27 .38-.22-.11-.14V0H2.02V-.14C1.48-.21 1.42-.24 1.42-.55C1.42-.64 1.44-.72 1.53-1.05L2.02-2.87L2.59-2.83L3.66 0H4.95ZM4.22-4.46C4.22-3.6 3.66-3.15 2.57-3.15C2.41-3.15 2.34-3.16 2.12-3.2L2.69-5.2C2.74-5.38 2.86-5.44 3.14-5.44C3.86-5.44 4.22-5.12 4.22-4.46Z'/>
<path id='eq85-g7-40' d='M3.76-1.59C3.76-2.16 3.57-2.49 2.78-3.29C1.98-4.09 1.91-4.21 1.91-4.64C1.91-5.19 2.28-5.53 2.87-5.53C3.2-5.53 3.46-5.42 3.64-5.21C3.84-5 3.91-4.7 3.93-4.11L4.09-4.09L4.44-5.83H4.24C4.11-5.64 4.04-5.6 3.84-5.6C3.73-5.6 3.62-5.62 3.44-5.69C3.26-5.77 2.97-5.82 2.7-5.82C1.79-5.82 1.14-5.21 1.14-4.36C1.14-3.89 1.28-3.63 1.8-3.07C1.91-2.96 2.03-2.84 2.14-2.71L2.48-2.34C2.89-1.91 3-1.69 3-1.31C3-.65 2.52-.15 1.88-.15C1.14-.15 .6-.77 .6-1.62C.6-1.69 .6-1.72 .62-1.8L.45-1.82L.15 .13H.31C.37-.07 .46-.16 .64-.16C.73-.16 .86-.12 1.09-.04C1.49 .1 1.73 .16 2 .16C3 .16 3.76-.59 3.76-1.59Z'/>
<path id='eq85-g7-51' d='M4.15-.88L4.04-.97C3.56-.42 3.48-.35 3.33-.35C3.24-.35 3.17-.42 3.17-.52C3.17-.66 3.44-1.69 3.74-2.67L4.6-5.92L4.56-5.97C4.1-5.87 3.78-5.82 3.22-5.76V-5.62C3.7-5.6 3.76-5.57 3.76-5.39C3.76-5.27 3.76-5.24 3.63-4.78L3.25-3.35C3.18-3.71 3.02-3.85 2.68-3.85C1.55-3.85 .13-2.21 .13-.9C.13-.28 .48 .1 1.05 .1C1.64 .1 2.03-.18 2.62-1.06C2.52-.62 2.51-.48 2.51-.28C2.51-.04 2.65 .11 2.87 .11C3.24 .11 3.7-.24 4.15-.88ZM3.11-3.15C3.11-1.83 2.2-.32 1.4-.32C1.09-.32 .89-.55 .89-.9C.89-1.62 1.33-2.64 1.9-3.25C2.14-3.49 2.44-3.65 2.68-3.65C2.69-3.65 2.71-3.65 2.72-3.65C2.98-3.63 3.11-3.47 3.11-3.15Z'/>
<path id='eq85-g7-149' d='M1.58-.38C1.58-.65 1.35-.87 1.09-.87S.61-.66 .61-.38C.61-.04 .91 .1 1.09 .1S1.58-.05 1.58-.38Z'/>
<path id='eq85-g7-150' d='M1.7-.05C1.7-.78 1.2-.89 1-.89C.78-.89 .49-.76 .49-.38C.49-.03 .8 .05 1.03 .05C1.09 .05 1.14 .04 1.16 .03C1.2 .03 1.22 .02 1.24 .02C1.3 .02 1.36 .06 1.36 .14C1.36 .31 1.22 .7 .65 1.07L.72 1.23C.99 1.14 1.7 .57 1.7-.05Z'/>
<use id='eq85-g10-22' xlink:href='#eq85-g7-22' transform='scale(1.36)'/>
<use id='eq85-g10-40' xlink:href='#eq85-g7-40' transform='scale(1.36)'/>
<use id='eq85-g10-51' xlink:href='#eq85-g7-51' transform='scale(1.36)'/>
<use id='eq85-g10-149' xlink:href='#eq85-g7-149' transform='scale(1.36)'/>
</defs>
<g id='eq85-page1'>
<use x='111.05' y='-3.03' xlink:href='#eq85-g10-22'/>
<use x='118.8' y='-1.24' xlink:href='#eq85-g7-39'/>
<use x='128.24' y='-3.03' xlink:href='#eq85-g1-61'/>
<use x='138.88' y='-3.03' xlink:href='#eq85-g10-40'/>
<use x='145.54' y='-1.24' xlink:href='#eq85-g7-39'/>
<use x='151.17' y='-1.24' xlink:href='#eq85-g7-150'/>
<use x='153.45' y='-1.24' xlink:href='#eq85-g14-49'/>
<use x='158.63' y='-3.03' xlink:href='#eq85-g10-51'/>
<use x='164.9' y='-1.24' xlink:href='#eq85-g14-49'/>
<use x='172.44' y='-3.03' xlink:href='#eq85-g4-184'/>
<use x='182.08' y='-3.03' xlink:href='#eq85-g10-40'/>
<use x='188.74' y='-1.24' xlink:href='#eq85-g7-39'/>
<use x='194.37' y='-1.24' xlink:href='#eq85-g7-150'/>
<use x='196.65' y='-1.24' xlink:href='#eq85-g14-50'/>
<use x='201.83' y='-3.03' xlink:href='#eq85-g10-51'/>
<use x='208.1' y='-1.24' xlink:href='#eq85-g14-50'/>
<use x='215.64' y='-3.03' xlink:href='#eq85-g4-184'/>
<use x='225.28' y='-3.03' xlink:href='#eq85-g10-40'/>
<use x='231.94' y='-1.24' xlink:href='#eq85-g7-39'/>
<use x='237.56' y='-1.24' xlink:href='#eq85-g7-150'/>
<use x='239.85' y='-1.24' xlink:href='#eq85-g14-51'/>
<use x='245.03' y='-3.03' xlink:href='#eq85-g10-51'/>
<use x='251.3' y='-1.24' xlink:href='#eq85-g14-51'/>
<use x='258.84' y='-3.03' xlink:href='#eq85-g4-184'/>
<use x='268.43' y='-3.03' xlink:href='#eq85-g10-149'/>
<use x='271.81' y='-3.03' xlink:href='#eq85-g10-149'/>
<use x='275.19' y='-3.03' xlink:href='#eq85-g10-149'/>
</g>
</svg></div>
<p>with <span class="m-math"><svg style="width: 1.876em; height: 1.097em; vertical-align: -0.303em; " viewBox=".24 -7.94 18.76 10.97">
<title>
\(S_{R,n}\)
</title>
<defs>
<path id='eq87-g1-39' d='M4.95 0V-.14C4.57-.17 4.39-.31 4.23-.77L3.42-2.91C4.09-3.06 4.38-3.18 4.69-3.46C4.98-3.71 5.14-4.05 5.14-4.45C5.14-5.26 4.5-5.7 3.32-5.7H1.15V-5.56C1.52-5.51 1.56-5.5 1.66-5.44C1.72-5.4 1.77-5.29 1.77-5.2C1.77-5.09 1.74-4.88 1.67-4.65L.59-.79C.44-.27 .38-.22-.11-.14V0H2.02V-.14C1.48-.21 1.42-.24 1.42-.55C1.42-.64 1.44-.72 1.53-1.05L2.02-2.87L2.59-2.83L3.66 0H4.95ZM4.22-4.46C4.22-3.6 3.66-3.15 2.57-3.15C2.41-3.15 2.34-3.16 2.12-3.2L2.69-5.2C2.74-5.38 2.86-5.44 3.14-5.44C3.86-5.44 4.22-5.12 4.22-4.46Z'/>
<path id='eq87-g1-40' d='M3.76-1.59C3.76-2.16 3.57-2.49 2.78-3.29C1.98-4.09 1.91-4.21 1.91-4.64C1.91-5.19 2.28-5.53 2.87-5.53C3.2-5.53 3.46-5.42 3.64-5.21C3.84-5 3.91-4.7 3.93-4.11L4.09-4.09L4.44-5.83H4.24C4.11-5.64 4.04-5.6 3.84-5.6C3.73-5.6 3.62-5.62 3.44-5.69C3.26-5.77 2.97-5.82 2.7-5.82C1.79-5.82 1.14-5.21 1.14-4.36C1.14-3.89 1.28-3.63 1.8-3.07C1.91-2.96 2.03-2.84 2.14-2.71L2.48-2.34C2.89-1.91 3-1.69 3-1.31C3-.65 2.52-.15 1.88-.15C1.14-.15 .6-.77 .6-1.62C.6-1.69 .6-1.72 .62-1.8L.45-1.82L.15 .13H.31C.37-.07 .46-.16 .64-.16C.73-.16 .86-.12 1.09-.04C1.49 .1 1.73 .16 2 .16C3 .16 3.76-.59 3.76-1.59Z'/>
<path id='eq87-g1-61' d='M4.14-.91L4.02-1.02C3.96-.94 3.9-.86 3.83-.79C3.58-.47 3.42-.33 3.3-.33C3.22-.33 3.16-.39 3.16-.47C3.16-.54 3.2-.71 3.28-1.02L3.78-2.82C3.83-3 3.86-3.2 3.86-3.32C3.86-3.63 3.62-3.85 3.28-3.85C2.73-3.85 2.17-3.32 1.28-1.93L1.86-3.83L1.83-3.85L.42-3.58V-3.44C.86-3.43 .98-3.38 .98-3.21C.98-3.15 .97-3.1 .96-3.06L.12 0H.78C1.19-1.38 1.27-1.57 1.65-2.17C2.17-2.98 2.62-3.41 2.94-3.41C3.07-3.41 3.15-3.31 3.15-3.15C3.15-3.05 3.1-2.76 3.03-2.49L2.65-1.05C2.53-.59 2.51-.48 2.51-.39C2.51-.06 2.63 .08 2.92 .08C3.31 .08 3.53-.1 4.14-.91Z'/>
<path id='eq87-g1-150' d='M1.7-.05C1.7-.78 1.2-.89 1-.89C.78-.89 .49-.76 .49-.38C.49-.03 .8 .05 1.03 .05C1.09 .05 1.14 .04 1.16 .03C1.2 .03 1.22 .02 1.24 .02C1.3 .02 1.36 .06 1.36 .14C1.36 .31 1.22 .7 .65 1.07L.72 1.23C.99 1.14 1.7 .57 1.7-.05Z'/>
<use id='eq87-g4-40' xlink:href='#eq87-g1-40' transform='scale(1.36)'/>
</defs>
<g id='eq87-page1'>
<use x='.24' y='0' xlink:href='#eq87-g4-40'/>
<use x='6.9' y='1.79' xlink:href='#eq87-g1-39'/>
<use x='12.53' y='1.79' xlink:href='#eq87-g1-150'/>
<use x='14.86' y='1.79' xlink:href='#eq87-g1-61'/>
</g>
</svg></span> the absorbance of dye <span class="m-math"><svg style="width: 0.565em; height: 0.536em; vertical-align: -0.011em; " viewBox=".06 -5.25 5.65 5.36">
<title>
\(n\)
</title>
<defs>
<path id='eq88-g1-61' d='M5.65-1.24L5.48-1.39C5.4-1.29 5.31-1.18 5.23-1.08C4.88-.64 4.67-.45 4.5-.45C4.39-.45 4.31-.54 4.31-.64C4.31-.74 4.36-.96 4.48-1.39L5.16-3.85C5.23-4.1 5.26-4.36 5.26-4.53C5.26-4.95 4.94-5.25 4.48-5.25C3.72-5.25 2.97-4.53 1.74-2.63L2.54-5.23L2.5-5.25L.57-4.88V-4.69C1.18-4.68 1.33-4.61 1.33-4.37C1.33-4.3 1.32-4.23 1.31-4.17L.17 0H1.06C1.62-1.88 1.73-2.14 2.25-2.95C2.97-4.06 3.57-4.65 4.01-4.65C4.19-4.65 4.3-4.51 4.3-4.3C4.3-4.16 4.23-3.76 4.13-3.39L3.61-1.43C3.45-.81 3.42-.66 3.42-.54C3.42-.08 3.59 .11 3.98 .11C4.51 .11 4.81-.13 5.65-1.24Z'/>
</defs>
<g id='eq88-page1'>
<use x='.06' y='0' xlink:href='#eq88-g1-61'/>
</g>
</svg></span> in the red channel, <span class="m-math"><svg style="width: 1.045em; height: 1.001em; vertical-align: -0.188em; " viewBox=".3 -8.13 10.45 10.01">
<title>
\(d_n\)
</title>
<defs>
<path id='eq89-g1-51' d='M4.15-.88L4.04-.97C3.56-.42 3.48-.35 3.33-.35C3.24-.35 3.17-.42 3.17-.52C3.17-.66 3.44-1.69 3.74-2.67L4.6-5.92L4.56-5.97C4.1-5.87 3.78-5.82 3.22-5.76V-5.62C3.7-5.6 3.76-5.57 3.76-5.39C3.76-5.27 3.76-5.24 3.63-4.78L3.25-3.35C3.18-3.71 3.02-3.85 2.68-3.85C1.55-3.85 .13-2.21 .13-.9C.13-.28 .48 .1 1.05 .1C1.64 .1 2.03-.18 2.62-1.06C2.52-.62 2.51-.48 2.51-.28C2.51-.04 2.65 .11 2.87 .11C3.24 .11 3.7-.24 4.15-.88ZM3.11-3.15C3.11-1.83 2.2-.32 1.4-.32C1.09-.32 .89-.55 .89-.9C.89-1.62 1.33-2.64 1.9-3.25C2.14-3.49 2.44-3.65 2.68-3.65C2.69-3.65 2.71-3.65 2.72-3.65C2.98-3.63 3.11-3.47 3.11-3.15Z'/>
<path id='eq89-g1-61' d='M4.14-.91L4.02-1.02C3.96-.94 3.9-.86 3.83-.79C3.58-.47 3.42-.33 3.3-.33C3.22-.33 3.16-.39 3.16-.47C3.16-.54 3.2-.71 3.28-1.02L3.78-2.82C3.83-3 3.86-3.2 3.86-3.32C3.86-3.63 3.62-3.85 3.28-3.85C2.73-3.85 2.17-3.32 1.28-1.93L1.86-3.83L1.83-3.85L.42-3.58V-3.44C.86-3.43 .98-3.38 .98-3.21C.98-3.15 .97-3.1 .96-3.06L.12 0H.78C1.19-1.38 1.27-1.57 1.65-2.17C2.17-2.98 2.62-3.41 2.94-3.41C3.07-3.41 3.15-3.31 3.15-3.15C3.15-3.05 3.1-2.76 3.03-2.49L2.65-1.05C2.53-.59 2.51-.48 2.51-.39C2.51-.06 2.63 .08 2.92 .08C3.31 .08 3.53-.1 4.14-.91Z'/>
<use id='eq89-g4-51' xlink:href='#eq89-g1-51' transform='scale(1.36)'/>
</defs>
<g id='eq89-page1'>
<use x='.3' y='0' xlink:href='#eq89-g4-51'/>
<use x='6.61' y='1.79' xlink:href='#eq89-g1-61'/>
</g>
</svg></span> the density (concentration) of
dye <span class="m-math"><svg style="width: 0.565em; height: 0.536em; vertical-align: -0.011em; " viewBox=".06 -5.25 5.65 5.36">
<title>
\(n\)
</title>
<defs>
<path id='eq90-g1-61' d='M5.65-1.24L5.48-1.39C5.4-1.29 5.31-1.18 5.23-1.08C4.88-.64 4.67-.45 4.5-.45C4.39-.45 4.31-.54 4.31-.64C4.31-.74 4.36-.96 4.48-1.39L5.16-3.85C5.23-4.1 5.26-4.36 5.26-4.53C5.26-4.95 4.94-5.25 4.48-5.25C3.72-5.25 2.97-4.53 1.74-2.63L2.54-5.23L2.5-5.25L.57-4.88V-4.69C1.18-4.68 1.33-4.61 1.33-4.37C1.33-4.3 1.32-4.23 1.31-4.17L.17 0H1.06C1.62-1.88 1.73-2.14 2.25-2.95C2.97-4.06 3.57-4.65 4.01-4.65C4.19-4.65 4.3-4.51 4.3-4.3C4.3-4.16 4.23-3.76 4.13-3.39L3.61-1.43C3.45-.81 3.42-.66 3.42-.54C3.42-.08 3.59 .11 3.98 .11C4.51 .11 4.81-.13 5.65-1.24Z'/>
</defs>
<g id='eq90-page1'>
<use x='.06' y='0' xlink:href='#eq90-g1-61'/>
</g>
</svg></span>, and <span class="m-math"><svg style="width: 1.348em; height: 0.975em; vertical-align: -0.179em; " viewBox=".29 -7.96 13.48 9.75">
<title>
\(A_R\)
</title>
<defs>
<path id='eq91-g1-22' d='M4.93 0V-.14C4.43-.18 4.37-.25 4.26-.89L3.44-5.83H3.21L.68-1.47C-.01-.31-.1-.21-.45-.14V0H1.19V-.14C.74-.18 .67-.23 .67-.45C.67-.61 .7-.69 .85-.99L1.35-1.97H3.27L3.44-.83C3.45-.75 3.46-.67 3.46-.6C3.46-.27 3.34-.19 2.78-.14V0H4.93ZM3.22-2.29H1.53L2.84-4.56L3.22-2.29Z'/>
<path id='eq91-g1-39' d='M4.95 0V-.14C4.57-.17 4.39-.31 4.23-.77L3.42-2.91C4.09-3.06 4.38-3.18 4.69-3.46C4.98-3.71 5.14-4.05 5.14-4.45C5.14-5.26 4.5-5.7 3.32-5.7H1.15V-5.56C1.52-5.51 1.56-5.5 1.66-5.44C1.72-5.4 1.77-5.29 1.77-5.2C1.77-5.09 1.74-4.88 1.67-4.65L.59-.79C.44-.27 .38-.22-.11-.14V0H2.02V-.14C1.48-.21 1.42-.24 1.42-.55C1.42-.64 1.44-.72 1.53-1.05L2.02-2.87L2.59-2.83L3.66 0H4.95ZM4.22-4.46C4.22-3.6 3.66-3.15 2.57-3.15C2.41-3.15 2.34-3.16 2.12-3.2L2.69-5.2C2.74-5.38 2.86-5.44 3.14-5.44C3.86-5.44 4.22-5.12 4.22-4.46Z'/>
<use id='eq91-g4-22' xlink:href='#eq91-g1-22' transform='scale(1.36)'/>
</defs>
<g id='eq91-page1'>
<use x='.9' y='0' xlink:href='#eq91-g4-22'/>
<use x='8.64' y='1.79' xlink:href='#eq91-g1-39'/>
</g>
</svg></span> the total absorbance in the red channel. In matrix notation this leads to</p>
<div class="m-math"><svg style="width: 4.100em; height: 0.847em; vertical-align: -0.000em; " viewBox="173.4 -8.47 41 8.47">
<title>
\[ A = \mathbf{S} d \; . \]
</title>
<defs>
<path id='eq86-g2-83' d='M6.11-2.29C6.11-3.18 5.57-4.07 4.8-4.45L3.05-5.32C2.08-5.8 1.82-6.09 1.82-6.67C1.82-7.41 2.32-7.86 3.13-7.86C3.67-7.86 4.17-7.63 4.6-7.19C5-6.78 5.19-6.43 5.43-5.66H5.76V-8.24H5.41C5.32-7.92 5.24-7.84 5.03-7.84C4.92-7.84 4.78-7.87 4.53-7.96C3.98-8.16 3.6-8.23 3.13-8.23C1.51-8.23 .52-7.31 .52-5.8C.52-5.5 .57-5.25 .66-5.01C.91-4.38 1.55-3.82 2.56-3.33L3.36-2.95C4.41-2.45 4.69-2.14 4.69-1.51C4.69-.69 4.11-.17 3.19-.17C2.5-.17 1.93-.45 1.48-1.02C1.13-1.46 .96-1.87 .76-2.72H.42V.23H.76C.83-.08 .93-.18 1.12-.18C1.21-.18 1.35-.14 1.61-.06C2.19 .14 2.63 .23 3.16 .23C4.92 .23 6.11-.79 6.11-2.29Z'/>
<path id='eq86-g4-61' d='M6.57-3.93V-4.6H.48V-3.93H6.57ZM6.57-1.51V-2.18H.48V-1.51H6.57Z'/>
<path id='eq86-g7-22' d='M6.72 0V-.19C6.04-.25 5.96-.35 5.81-1.21L4.69-7.96H4.38L.93-2C-.01-.42-.13-.29-.61-.19V0H1.62V-.19C1.01-.25 .92-.31 .92-.61C.92-.83 .95-.94 1.16-1.35L1.83-2.69H4.45L4.69-1.13C4.7-1.02 4.72-.92 4.72-.82C4.72-.37 4.55-.26 3.79-.19V0H6.72ZM4.39-3.12H2.08L3.87-6.22L4.39-3.12Z'/>
<path id='eq86-g7-51' d='M5.66-1.2L5.51-1.32C4.86-.57 4.74-.48 4.54-.48C4.42-.48 4.32-.57 4.32-.71C4.32-.91 4.69-2.3 5.1-3.64L6.28-8.08L6.22-8.13C5.59-8 5.16-7.93 4.39-7.86V-7.66C5.05-7.63 5.13-7.6 5.13-7.35C5.13-7.18 5.12-7.15 4.95-6.52L4.43-4.56C4.34-5.06 4.12-5.25 3.66-5.25C2.11-5.25 .18-3.01 .18-1.23C.18-.38 .66 .13 1.43 .13C2.24 .13 2.76-.25 3.57-1.44C3.44-.85 3.42-.66 3.42-.38C3.42-.06 3.61 .15 3.92 .15C4.42 .15 5.05-.33 5.66-1.2ZM4.24-4.3C4.24-2.49 3-.44 1.91-.44C1.49-.44 1.21-.75 1.21-1.23C1.21-2.22 1.81-3.6 2.6-4.43C2.92-4.76 3.32-4.98 3.66-4.98C3.67-4.98 3.69-4.98 3.7-4.98C4.06-4.95 4.24-4.73 4.24-4.3Z'/>
<path id='eq86-g7-149' d='M2.16-.51C2.16-.88 1.85-1.19 1.49-1.19S.83-.89 .83-.51C.83-.06 1.24 .13 1.49 .13S2.16-.07 2.16-.51Z'/>
</defs>
<g id='eq86-page1'>
<use x='174.01' y='-.23' xlink:href='#eq86-g7-22'/>
<use x='184.79' y='-.23' xlink:href='#eq86-g4-61'/>
<use x='195.18' y='-.23' xlink:href='#eq86-g2-83'/>
<use x='202.13' y='-.23' xlink:href='#eq86-g7-51'/>
<use x='212.24' y='-.23' xlink:href='#eq86-g7-149'/>
</g>
</svg></div>
<p>Here, <span class="m-math"><svg style="width: 0.732em; height: 0.796em; vertical-align: -0.000em; " viewBox=".29 -7.96 7.32 7.96">
<title>
\(A\)
</title>
<defs>
<path id='eq92-g1-22' d='M6.72 0V-.19C6.04-.25 5.96-.35 5.81-1.21L4.69-7.96H4.38L.93-2C-.01-.42-.13-.29-.61-.19V0H1.62V-.19C1.01-.25 .92-.31 .92-.61C.92-.83 .95-.94 1.16-1.35L1.83-2.69H4.45L4.69-1.13C4.7-1.02 4.72-.92 4.72-.82C4.72-.37 4.55-.26 3.79-.19V0H6.72ZM4.39-3.12H2.08L3.87-6.22L4.39-3.12Z'/>
</defs>
<g id='eq92-page1'>
<use x='.9' y='0' xlink:href='#eq92-g1-22'/>
</g>
</svg></span> is a pixel in the multi-channel absorbance image (<code>in</code>), <span class="m-math"><svg style="width: 0.611em; height: 0.847em; vertical-align: -0.023em; " viewBox="0 -8.24 6.11 8.47">
<title>
\(\mathbf{S}\)
</title>
<defs>
<path id='eq93-g2-83' d='M6.11-2.29C6.11-3.18 5.57-4.07 4.8-4.45L3.05-5.32C2.08-5.8 1.82-6.09 1.82-6.67C1.82-7.41 2.32-7.86 3.13-7.86C3.67-7.86 4.17-7.63 4.6-7.19C5-6.78 5.19-6.43 5.43-5.66H5.76V-8.24H5.41C5.32-7.92 5.24-7.84 5.03-7.84C4.92-7.84 4.78-7.87 4.53-7.96C3.98-8.16 3.6-8.23 3.13-8.23C1.51-8.23 .52-7.31 .52-5.8C.52-5.5 .57-5.25 .66-5.01C.91-4.38 1.55-3.82 2.56-3.33L3.36-2.95C4.41-2.45 4.69-2.14 4.69-1.51C4.69-.69 4.11-.17 3.19-.17C2.5-.17 1.93-.45 1.48-1.02C1.13-1.46 .96-1.87 .76-2.72H.42V.23H.76C.83-.08 .93-.18 1.12-.18C1.21-.18 1.35-.14 1.61-.06C2.19 .14 2.63 .23 3.16 .23C4.92 .23 6.11-.79 6.11-2.29Z'/>
</defs>
<g id='eq93-page1'>
<use x='0' y='0' xlink:href='#eq93-g2-83'/>
</g>
</svg></span> is a matrix that
combines absorbance for each dye and each channel, and <span class="m-math"><svg style="width: 0.628em; height: 0.829em; vertical-align: -0.016em; " viewBox=".3 -8.13 6.28 8.29">
<title>
\(d\)
</title>
<defs>
<path id='eq94-g1-51' d='M5.66-1.2L5.51-1.32C4.86-.57 4.74-.48 4.54-.48C4.42-.48 4.32-.57 4.32-.71C4.32-.91 4.69-2.3 5.1-3.64L6.28-8.08L6.22-8.13C5.59-8 5.16-7.93 4.39-7.86V-7.66C5.05-7.63 5.13-7.6 5.13-7.35C5.13-7.18 5.12-7.15 4.95-6.52L4.43-4.56C4.34-5.06 4.12-5.25 3.66-5.25C2.11-5.25 .18-3.01 .18-1.23C.18-.38 .66 .13 1.43 .13C2.24 .13 2.76-.25 3.57-1.44C3.44-.85 3.42-.66 3.42-.38C3.42-.06 3.61 .15 3.92 .15C4.42 .15 5.05-.33 5.66-1.2ZM4.24-4.3C4.24-2.49 3-.44 1.91-.44C1.49-.44 1.21-.75 1.21-1.23C1.21-2.22 1.81-3.6 2.6-4.43C2.92-4.76 3.32-4.98 3.66-4.98C3.67-4.98 3.69-4.98 3.7-4.98C4.06-4.95 4.24-4.73 4.24-4.3Z'/>
</defs>
<g id='eq94-page1'>
<use x='.3' y='0' xlink:href='#eq94-g1-51'/>
</g>
</svg></span> is a vector with the density for each
dye (a pixel in <code>out</code>). To find <span class="m-math"><svg style="width: 0.628em; height: 0.829em; vertical-align: -0.016em; " viewBox=".3 -8.13 6.28 8.29">
<title>
\(d\)
</title>
<defs>
<path id='eq95-g1-51' d='M5.66-1.2L5.51-1.32C4.86-.57 4.74-.48 4.54-.48C4.42-.48 4.32-.57 4.32-.71C4.32-.91 4.69-2.3 5.1-3.64L6.28-8.08L6.22-8.13C5.59-8 5.16-7.93 4.39-7.86V-7.66C5.05-7.63 5.13-7.6 5.13-7.35C5.13-7.18 5.12-7.15 4.95-6.52L4.43-4.56C4.34-5.06 4.12-5.25 3.66-5.25C2.11-5.25 .18-3.01 .18-1.23C.18-.38 .66 .13 1.43 .13C2.24 .13 2.76-.25 3.57-1.44C3.44-.85 3.42-.66 3.42-.38C3.42-.06 3.61 .15 3.92 .15C4.42 .15 5.05-.33 5.66-1.2ZM4.24-4.3C4.24-2.49 3-.44 1.91-.44C1.49-.44 1.21-.75 1.21-1.23C1.21-2.22 1.81-3.6 2.6-4.43C2.92-4.76 3.32-4.98 3.66-4.98C3.67-4.98 3.69-4.98 3.7-4.98C4.06-4.95 4.24-4.73 4.24-4.3Z'/>
</defs>
<g id='eq95-page1'>
<use x='.3' y='0' xlink:href='#eq95-g1-51'/>
</g>
</svg></span>, this linear set of equations needs to be solved. This process
is described by Ruifrok (2001). This function computes a Moore-Penrose pseudo-inverse of <span class="m-math"><svg style="width: 0.611em; height: 0.847em; vertical-align: -0.023em; " viewBox="0 -8.24 6.11 8.47">
<title>
\(\mathbf{S}\)
</title>
<defs>
<path id='eq96-g2-83' d='M6.11-2.29C6.11-3.18 5.57-4.07 4.8-4.45L3.05-5.32C2.08-5.8 1.82-6.09 1.82-6.67C1.82-7.41 2.32-7.86 3.13-7.86C3.67-7.86 4.17-7.63 4.6-7.19C5-6.78 5.19-6.43 5.43-5.66H5.76V-8.24H5.41C5.32-7.92 5.24-7.84 5.03-7.84C4.92-7.84 4.78-7.87 4.53-7.96C3.98-8.16 3.6-8.23 3.13-8.23C1.51-8.23 .52-7.31 .52-5.8C.52-5.5 .57-5.25 .66-5.01C.91-4.38 1.55-3.82 2.56-3.33L3.36-2.95C4.41-2.45 4.69-2.14 4.69-1.51C4.69-.69 4.11-.17 3.19-.17C2.5-.17 1.93-.45 1.48-1.02C1.13-1.46 .96-1.87 .76-2.72H.42V.23H.76C.83-.08 .93-.18 1.12-.18C1.21-.18 1.35-.14 1.61-.06C2.19 .14 2.63 .23 3.16 .23C4.92 .23 6.11-.79 6.11-2.29Z'/>
</defs>
<g id='eq96-page1'>
<use x='0' y='0' xlink:href='#eq96-g2-83'/>
</g>
</svg></span>,
and applies a per-pixel matrix multiplication with <code>in</code> to obtain <code>out</code>.</p>
<p><code>stains</code> is a <code>std::vector</code> that contains each of the columns of matrix <span class="m-math"><svg style="width: 0.611em; height: 0.847em; vertical-align: -0.023em; " viewBox="0 -8.24 6.11 8.47">
<title>
\(\mathbf{S}\)
</title>
<defs>
<path id='eq97-g2-83' d='M6.11-2.29C6.11-3.18 5.57-4.07 4.8-4.45L3.05-5.32C2.08-5.8 1.82-6.09 1.82-6.67C1.82-7.41 2.32-7.86 3.13-7.86C3.67-7.86 4.17-7.63 4.6-7.19C5-6.78 5.19-6.43 5.43-5.66H5.76V-8.24H5.41C5.32-7.92 5.24-7.84 5.03-7.84C4.92-7.84 4.78-7.87 4.53-7.96C3.98-8.16 3.6-8.23 3.13-8.23C1.51-8.23 .52-7.31 .52-5.8C.52-5.5 .57-5.25 .66-5.01C.91-4.38 1.55-3.82 2.56-3.33L3.36-2.95C4.41-2.45 4.69-2.14 4.69-1.51C4.69-.69 4.11-.17 3.19-.17C2.5-.17 1.93-.45 1.48-1.02C1.13-1.46 .96-1.87 .76-2.72H.42V.23H.76C.83-.08 .93-.18 1.12-.18C1.21-.18 1.35-.14 1.61-.06C2.19 .14 2.63 .23 3.16 .23C4.92 .23 6.11-.79 6.11-2.29Z'/>
</defs>
<g id='eq97-page1'>
<use x='0' y='0' xlink:href='#eq97-g2-83'/>
</g>
</svg></span>. That is, each element
of <code>stains</code> is the values of one column of <span class="m-math"><svg style="width: 0.611em; height: 0.847em; vertical-align: -0.023em; " viewBox="0 -8.24 6.11 8.47">
<title>
\(\mathbf{S}\)
</title>
<defs>
<path id='eq98-g2-83' d='M6.11-2.29C6.11-3.18 5.57-4.07 4.8-4.45L3.05-5.32C2.08-5.8 1.82-6.09 1.82-6.67C1.82-7.41 2.32-7.86 3.13-7.86C3.67-7.86 4.17-7.63 4.6-7.19C5-6.78 5.19-6.43 5.43-5.66H5.76V-8.24H5.41C5.32-7.92 5.24-7.84 5.03-7.84C4.92-7.84 4.78-7.87 4.53-7.96C3.98-8.16 3.6-8.23 3.13-8.23C1.51-8.23 .52-7.31 .52-5.8C.52-5.5 .57-5.25 .66-5.01C.91-4.38 1.55-3.82 2.56-3.33L3.36-2.95C4.41-2.45 4.69-2.14 4.69-1.51C4.69-.69 4.11-.17 3.19-.17C2.5-.17 1.93-.45 1.48-1.02C1.13-1.46 .96-1.87 .76-2.72H.42V.23H.76C.83-.08 .93-.18 1.12-.18C1.21-.18 1.35-.14 1.61-.06C2.19 .14 2.63 .23 3.16 .23C4.92 .23 6.11-.79 6.11-2.29Z'/>
</defs>
<g id='eq98-page1'>
<use x='0' y='0' xlink:href='#eq98-g2-83'/>
</g>
</svg></span>, which we refer to as a <em>stain vector</em>. These
stain vectors are represented by a <a href="dip-Image-Pixel.html"><code>dip::Image::Pixel</code></a> with the same number of tensor elements as <code>in</code>.
<code>stains</code> cannot have more elements than channels (tensor elements) are in <code>in</code>.
<code>out</code> will contain one channel for each stain. For example, assuming an RGB image with 3 channels, <code>stains</code> can
have one, two or three elements, each element being a <a href="dip-Image-Pixel.html"><code>dip::Image::Pixel</code></a> with exactly 3 elements (corresponding
to the 3 RGB channels).</p>
<p>Best results are obtained when each element of <code>stains</code> is normalized (i.e. the norm of each stain vector is 1);
this function does not normalize these stain vectors. The standard brightfield stain vectors given below are
normalized.</p>
<p>Example:</p>
<div class="m-code"><pre><span></span><span class="n">dip</span><span class="o">::</span><span class="n">Image</span><span class="w"> </span><span class="n">img</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dip</span><span class="o">::</span><span class="n">ImageReadTIFF</span><span class="p">(</span><span class="w"> </span><span class="s">&quot;brightfield.tif&quot;</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="n">img</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dip</span><span class="o">::</span><span class="n">BeerLambertMapping</span><span class="p">(</span><span class="w"> </span><span class="n">img</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">255</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="n">img</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dip</span><span class="o">::</span><span class="n">UnmixStains</span><span class="p">(</span><span class="w"> </span><span class="n">img</span><span class="p">,</span><span class="w"> </span><span class="p">{{</span><span class="w"> </span><span class="mf">0.644</span><span class="p">,</span><span class="w"> </span><span class="mf">0.717</span><span class="p">,</span><span class="w"> </span><span class="mf">0.267</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mf">0.268</span><span class="p">,</span><span class="w"> </span><span class="mf">0.570</span><span class="p">,</span><span class="w"> </span><span class="mf">0.776</span><span class="w"> </span><span class="p">}}</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="n">dip</span><span class="o">::</span><span class="n">Image</span><span class="w"> </span><span class="n">nuclei</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">img</span><span class="p">[</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">];</span><span class="w"></span>
<span class="n">dip</span><span class="o">::</span><span class="n">Image</span><span class="w"> </span><span class="n">dab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">img</span><span class="p">[</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">];</span><span class="w"></span>
</pre></div>

<h2 id="unmixstains_fluorescence">Fluorescence</h2>
<p>The explanation above translates to fluorescence imaging, replacing &lsquo;absorbance&rsquo; with &lsquo;emission&rsquo;. In the case
of fluorescence, <a href="microscopy.html#dip-BeerLambertMapping-dip-Image-CL-dip-Image-L-Image-Pixel-CL"><code>dip::BeerLambertMapping</code></a> should not be used.
Typically, fluorescence imaging systems are set up such that each channel collects light only from a single dye,
but in practice it is not always possible to use dyes with perfectly separated emission spectra. Therefore, there
will be cross-talk, i.e. light from one dye is partially recorded in a channel set up for a different dye.</p>
<p>Again, it is possible to measure the emission intensity in each channel (or channel cross-talk ratios) using
slides prepared for the purpose, with a single dye.</p>
<p>In multi-spectral fluorescence imaging, channels are not set up specifically for each dye. Instead, the spectrum
is divided up into a set of channels. Each dye will be visible in a subset of these channels. Measuring the
emission strength for each dye in each channel again leads to the data to be written in <code>stains</code> to estimate
dye densities using this function.</p>
<h2 id="unmixstains_standard_vectors">Standard brightfield stain vectors</h2>
<table class="m-table">
<thead>
<tr>
<th>Stain name</th>
<th>RGB absorbance triplet</th>
</tr>
</thead>
<tbody>
<tr>
<td>AEC</td>
<td>0.274, 0.679, 0.680</td>
</tr>
<tr>
<td>Alcian blue</td>
<td>0.875, 0.458, 0.158</td>
</tr>
<tr>
<td>Aniline blue</td>
<td>0.853, 0.509, 0.113</td>
</tr>
<tr>
<td>Azocarmine</td>
<td>0.071, 0.977, 0.198</td>
</tr>
<tr>
<td>DAB</td>
<td>0.268, 0.570, 0.776</td>
</tr>
<tr>
<td>Eosin</td>
<td>0.093, 0.954, 0.283</td>
</tr>
<tr>
<td>Fast blue</td>
<td>0.749, 0.606, 0.267</td>
</tr>
<tr>
<td>Fast red</td>
<td>0.214, 0.851, 0.478</td>
</tr>
<tr>
<td>Feulgen</td>
<td>0.464, 0.830, 0.308</td>
</tr>
<tr>
<td>Hematoxylin</td>
<td>0.644, 0.717, 0.267</td>
</tr>
<tr>
<td>Hematoxylin + PAS</td>
<td>0.553, 0.754, 0.354</td>
</tr>
<tr>
<td>Methyl blue</td>
<td>0.799, 0.591, 0.105</td>
</tr>
<tr>
<td>Methyl green</td>
<td>0.980, 0.144, 0.133</td>
</tr>
<tr>
<td>Methylene blue</td>
<td>0.553, 0.754, 0.354</td>
</tr>
<tr>
<td>Orange-G</td>
<td>0.107, 0.368, 0.923</td>
</tr>
<tr>
<td>PAS</td>
<td>0.175, 0.972, 0.155</td>
</tr>
<tr>
<td>Ponceau-Fuchsin</td>
<td>0.100, 0.737, 0.668</td>
</tr>
</tbody>
</table>
<aside class="m-note m-default">
<h4>Literature</h4>
<ul>
<li>A.C. Ruifrok and D.A. Johnston, &ldquo;Quantification of histochemical staining by color deconvolution&rdquo;,
  Analytical and Quantitative Cytology and Histology 23(4):291-299, 2001.</li>
<li>Stain color triplets taken from CellProfiler,
  <a href="https://github.com/CellProfiler/CellProfiler/blob/master/cellprofiler/modules/unmixcolors.py"><code>unmixcolors.py</code></a> module.</li>
</ul>
</aside>
          </div></section>
          <section class="m-doc-details" id="dip-MixStains-dip-Image-CL-dip-Image-L-std-vector<Image-Pixel>-CL"><div>
            <h3>
              <span class="m-doc-wrap-bumper">void
                </span><span class="m-doc-wrap"><span class="m-doc-wrap-bumper"><a href="#dip-MixStains-dip-Image-CL-dip-Image-L-std-vector<Image-Pixel>-CL" class="m-doc-self">dip::<wbr />MixStains</a>(</span><span class="m-doc-wrap"><a href="dip-Image.html" class="m-doc">dip::Image</a> const&amp; in,
              <a href="dip-Image.html" class="m-doc">dip::Image</a>&amp; out,
              std::vector&lt;Image::Pixel&gt; const&amp; stains)</span></span>
            </h3>
            <p>Composes a color image given stain densities and stain absorbance values (brightfield) or stain emission
values (fluorescence)</p>
<p>This function does the opposite of what <a href="microscopy.html#dip-UnmixStains-dip-Image-CL-dip-Image-L-std-vector&lt;Image-Pixel&gt;-CL"><code>dip::UnmixStains</code></a> does: it applies the per-pixel
matrix multiplication <span class="m-math"><svg style="width: 3.501em; height: 0.847em; vertical-align: -0.023em; " viewBox=".29 -8.24 35.01 8.47">
<title>
\(A = \mathbf{S} d\)
</title>
<defs>
<path id='eq99-g2-83' d='M6.11-2.29C6.11-3.18 5.57-4.07 4.8-4.45L3.05-5.32C2.08-5.8 1.82-6.09 1.82-6.67C1.82-7.41 2.32-7.86 3.13-7.86C3.67-7.86 4.17-7.63 4.6-7.19C5-6.78 5.19-6.43 5.43-5.66H5.76V-8.24H5.41C5.32-7.92 5.24-7.84 5.03-7.84C4.92-7.84 4.78-7.87 4.53-7.96C3.98-8.16 3.6-8.23 3.13-8.23C1.51-8.23 .52-7.31 .52-5.8C.52-5.5 .57-5.25 .66-5.01C.91-4.38 1.55-3.82 2.56-3.33L3.36-2.95C4.41-2.45 4.69-2.14 4.69-1.51C4.69-.69 4.11-.17 3.19-.17C2.5-.17 1.93-.45 1.48-1.02C1.13-1.46 .96-1.87 .76-2.72H.42V.23H.76C.83-.08 .93-.18 1.12-.18C1.21-.18 1.35-.14 1.61-.06C2.19 .14 2.63 .23 3.16 .23C4.92 .23 6.11-.79 6.11-2.29Z'/>
<path id='eq99-g4-61' d='M6.57-3.93V-4.6H.48V-3.93H6.57ZM6.57-1.51V-2.18H.48V-1.51H6.57Z'/>
<path id='eq99-g7-22' d='M6.72 0V-.19C6.04-.25 5.96-.35 5.81-1.21L4.69-7.96H4.38L.93-2C-.01-.42-.13-.29-.61-.19V0H1.62V-.19C1.01-.25 .92-.31 .92-.61C.92-.83 .95-.94 1.16-1.35L1.83-2.69H4.45L4.69-1.13C4.7-1.02 4.72-.92 4.72-.82C4.72-.37 4.55-.26 3.79-.19V0H6.72ZM4.39-3.12H2.08L3.87-6.22L4.39-3.12Z'/>
<path id='eq99-g7-51' d='M5.66-1.2L5.51-1.32C4.86-.57 4.74-.48 4.54-.48C4.42-.48 4.32-.57 4.32-.71C4.32-.91 4.69-2.3 5.1-3.64L6.28-8.08L6.22-8.13C5.59-8 5.16-7.93 4.39-7.86V-7.66C5.05-7.63 5.13-7.6 5.13-7.35C5.13-7.18 5.12-7.15 4.95-6.52L4.43-4.56C4.34-5.06 4.12-5.25 3.66-5.25C2.11-5.25 .18-3.01 .18-1.23C.18-.38 .66 .13 1.43 .13C2.24 .13 2.76-.25 3.57-1.44C3.44-.85 3.42-.66 3.42-.38C3.42-.06 3.61 .15 3.92 .15C4.42 .15 5.05-.33 5.66-1.2ZM4.24-4.3C4.24-2.49 3-.44 1.91-.44C1.49-.44 1.21-.75 1.21-1.23C1.21-2.22 1.81-3.6 2.6-4.43C2.92-4.76 3.32-4.98 3.66-4.98C3.67-4.98 3.69-4.98 3.7-4.98C4.06-4.95 4.24-4.73 4.24-4.3Z'/>
</defs>
<g id='eq99-page1'>
<use x='.9' y='0' xlink:href='#eq99-g7-22'/>
<use x='11.68' y='0' xlink:href='#eq99-g4-61'/>
<use x='22.08' y='0' xlink:href='#eq99-g2-83'/>
<use x='29.02' y='0' xlink:href='#eq99-g7-51'/>
</g>
</svg></span> to obtain <span class="m-math"><svg style="width: 0.732em; height: 0.796em; vertical-align: -0.000em; " viewBox=".29 -7.96 7.32 7.96">
<title>
\(A\)
</title>
<defs>
<path id='eq100-g1-22' d='M6.72 0V-.19C6.04-.25 5.96-.35 5.81-1.21L4.69-7.96H4.38L.93-2C-.01-.42-.13-.29-.61-.19V0H1.62V-.19C1.01-.25 .92-.31 .92-.61C.92-.83 .95-.94 1.16-1.35L1.83-2.69H4.45L4.69-1.13C4.7-1.02 4.72-.92 4.72-.82C4.72-.37 4.55-.26 3.79-.19V0H6.72ZM4.39-3.12H2.08L3.87-6.22L4.39-3.12Z'/>
</defs>
<g id='eq100-page1'>
<use x='.9' y='0' xlink:href='#eq100-g1-22'/>
</g>
</svg></span> (<code>out</code>) from  <span class="m-math"><svg style="width: 0.628em; height: 0.829em; vertical-align: -0.016em; " viewBox=".3 -8.13 6.28 8.29">
<title>
\(d\)
</title>
<defs>
<path id='eq101-g1-51' d='M5.66-1.2L5.51-1.32C4.86-.57 4.74-.48 4.54-.48C4.42-.48 4.32-.57 4.32-.71C4.32-.91 4.69-2.3 5.1-3.64L6.28-8.08L6.22-8.13C5.59-8 5.16-7.93 4.39-7.86V-7.66C5.05-7.63 5.13-7.6 5.13-7.35C5.13-7.18 5.12-7.15 4.95-6.52L4.43-4.56C4.34-5.06 4.12-5.25 3.66-5.25C2.11-5.25 .18-3.01 .18-1.23C.18-.38 .66 .13 1.43 .13C2.24 .13 2.76-.25 3.57-1.44C3.44-.85 3.42-.66 3.42-.38C3.42-.06 3.61 .15 3.92 .15C4.42 .15 5.05-.33 5.66-1.2ZM4.24-4.3C4.24-2.49 3-.44 1.91-.44C1.49-.44 1.21-.75 1.21-1.23C1.21-2.22 1.81-3.6 2.6-4.43C2.92-4.76 3.32-4.98 3.66-4.98C3.67-4.98 3.69-4.98 3.7-4.98C4.06-4.95 4.24-4.73 4.24-4.3Z'/>
</defs>
<g id='eq101-page1'>
<use x='.3' y='0' xlink:href='#eq101-g1-51'/>
</g>
</svg></span> (<code>in</code>) and
<span class="m-math"><svg style="width: 0.611em; height: 0.847em; vertical-align: -0.023em; " viewBox="0 -8.24 6.11 8.47">
<title>
\(\mathbf{S}\)
</title>
<defs>
<path id='eq102-g2-83' d='M6.11-2.29C6.11-3.18 5.57-4.07 4.8-4.45L3.05-5.32C2.08-5.8 1.82-6.09 1.82-6.67C1.82-7.41 2.32-7.86 3.13-7.86C3.67-7.86 4.17-7.63 4.6-7.19C5-6.78 5.19-6.43 5.43-5.66H5.76V-8.24H5.41C5.32-7.92 5.24-7.84 5.03-7.84C4.92-7.84 4.78-7.87 4.53-7.96C3.98-8.16 3.6-8.23 3.13-8.23C1.51-8.23 .52-7.31 .52-5.8C.52-5.5 .57-5.25 .66-5.01C.91-4.38 1.55-3.82 2.56-3.33L3.36-2.95C4.41-2.45 4.69-2.14 4.69-1.51C4.69-.69 4.11-.17 3.19-.17C2.5-.17 1.93-.45 1.48-1.02C1.13-1.46 .96-1.87 .76-2.72H.42V.23H.76C.83-.08 .93-.18 1.12-.18C1.21-.18 1.35-.14 1.61-.06C2.19 .14 2.63 .23 3.16 .23C4.92 .23 6.11-.79 6.11-2.29Z'/>
</defs>
<g id='eq102-page1'>
<use x='0' y='0' xlink:href='#eq102-g2-83'/>
</g>
</svg></span> (composed from the values in <code>stains</code>).</p>
<p><code>stains</code> is a vector with these absorbance/emission values, and should have the same number of
elements as channels (tensor elements) in the image <code>in</code>. Each element of the vector should have the
same number of channels, and these dictate the number of channels in the output image <code>out</code>. If <code>out</code>
has three channels, it will be tagged as an RGB image. Call <a href="microscopy.html#dip-InverseBeerLambertMapping-dip-Image-CL-dip-Image-L-Image-Pixel-CL"><code>dip::InverseBeerLambertMapping</code></a> with <code>out</code>
to create an image as seen through a brightfield microscope:</p>
<p>Example:</p>
<div class="m-code"><pre><span></span><span class="n">dip</span><span class="o">::</span><span class="n">Image</span><span class="w"> </span><span class="nf">img</span><span class="p">(</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">1024</span><span class="p">,</span><span class="w"> </span><span class="mi">1024</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="n">dip</span><span class="o">::</span><span class="n">DrawBandlimitedBall</span><span class="p">(</span><span class="w"> </span><span class="n">img</span><span class="p">,</span><span class="w"> </span><span class="mi">300</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">400</span><span class="p">,</span><span class="w"> </span><span class="mi">500</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="n">dip</span><span class="o">::</span><span class="n">DrawBandlimitedBall</span><span class="p">(</span><span class="w"> </span><span class="n">img</span><span class="p">,</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">500</span><span class="p">,</span><span class="w"> </span><span class="mi">600</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="n">img</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dip</span><span class="o">::</span><span class="n">MixStains</span><span class="p">(</span><span class="w"> </span><span class="n">img</span><span class="p">,</span><span class="w"> </span><span class="p">{{</span><span class="w"> </span><span class="mf">0.644</span><span class="p">,</span><span class="w"> </span><span class="mf">0.717</span><span class="p">,</span><span class="w"> </span><span class="mf">0.267</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mf">0.268</span><span class="p">,</span><span class="w"> </span><span class="mf">0.570</span><span class="p">,</span><span class="w"> </span><span class="mf">0.776</span><span class="w"> </span><span class="p">}}</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
<span class="n">img</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dip</span><span class="o">::</span><span class="n">InverseBeerLambertMapping</span><span class="p">(</span><span class="w"> </span><span class="n">img</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">255</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
</pre></div>

<p>If there are more stains than channels, this process is irreversible (that is, it will not be possible
to unmix the stains again).</p>
          </div></section>
          <section class="m-doc-details" id="dip-MandersOverlapCoefficient-dip-Image-CL-dip-Image-CL-dip-Image-CL"><div>
            <h3>
              <span class="m-doc-wrap-bumper"><a href="pixeltypes.html#dip-dfloat" class="m-doc">dip::dfloat</a>
                </span><span class="m-doc-wrap"><span class="m-doc-wrap-bumper"><a href="#dip-MandersOverlapCoefficient-dip-Image-CL-dip-Image-CL-dip-Image-CL" class="m-doc-self">dip::<wbr />MandersOverlapCoefficient</a>(</span><span class="m-doc-wrap"><a href="dip-Image.html" class="m-doc">dip::Image</a> const&amp; channel1,
              <a href="dip-Image.html" class="m-doc">dip::Image</a> const&amp; channel2,
              <a href="dip-Image.html" class="m-doc">dip::Image</a> const&amp; mask = {})</span></span>
            </h3>
            <p>Computes the Manders Overlap Coefficient.</p>
<p>The Manders Overlap Coefficient is defined similarly to the Pearson Correlation Coefficient, but without
subtracting the means from each of the variables,</p>
<div class="m-math"><svg style="width: 13.037em; height: 3.106em; vertical-align: -0.004em; " viewBox="128.59 -31.02 130.37 31.06">
<title>
\[ r = \frac{\sum{C_1(p) C_2(p)}}{\sqrt{\sum{C_1(p)^2}\sum{C_2(p)^2}}} \; , \]
</title>
<defs>
<path id='eq103-g7-185' d='M3.51-8.54C1.79-7.42 .57-5.49 .57-3.06C.57-.85 1.83 1.39 3.48 2.41L3.62 2.22C2.05 .98 1.6-.46 1.6-3.1C1.6-5.74 2.08-7.11 3.62-8.35L3.51-8.54Z'/>
<path id='eq103-g7-186' d='M.45-8.54L.35-8.35C1.88-7.11 2.37-5.74 2.37-3.1C2.37-.46 1.92 .98 .35 2.22L.49 2.41C2.13 1.39 3.39-.85 3.39-3.06C3.39-5.49 2.18-7.42 .45-8.54Z'/>
<path id='eq103-g4-112' d='M9.08-.67H8.37L5.34 11.23L3 6.26L.71 7.48L.86 7.73L2.13 7.25L5.26 13.82L9.08-.67Z'/>
<path id='eq103-g4-205' d='M8.65 7.3H8.4C8.16 8.79 7.61 9.46 6.78 9.46H2.11L5.56 5.03L2.49 .46H6.3C7.17 .46 7.72 .94 7.97 2.45H8.23L8.16 0H1.01L4.66 5.23L.51 10.48H8.52L8.65 7.3Z'/>
<path id='eq103-g1-61' d='M6.57-3.93V-4.6H.48V-3.93H6.57ZM6.57-1.51V-2.18H.48V-1.51H6.57Z'/>
<path id='eq103-g14-49' d='M3.44 0V-.13C2.75-.14 2.61-.23 2.61-.65V-5.89L2.54-5.9L.97-5.11V-4.99C1.07-5.03 1.17-5.07 1.21-5.08C1.36-5.14 1.51-5.18 1.6-5.18C1.78-5.18 1.86-5.05 1.86-4.77V-.81C1.86-.52 1.79-.32 1.65-.24C1.52-.17 1.4-.14 1.03-.13V0H3.44Z'/>
<path id='eq103-g14-50' d='M4.15-1.2L4.04-1.24C3.71-.74 3.6-.66 3.21-.66H1.12L2.59-2.2C3.36-3.01 3.7-3.68 3.7-4.36C3.7-5.23 3-5.9 2.09-5.9C1.61-5.9 1.15-5.71 .83-5.36C.55-5.07 .42-4.79 .27-4.17L.45-4.12C.8-4.98 1.12-5.26 1.72-5.26C2.45-5.26 2.95-4.76 2.95-4.03C2.95-3.35 2.55-2.53 1.82-1.76L.26-.1V0H3.67L4.15-1.2Z'/>
<path id='eq103-g10-24' d='M7.15-1.56L6.94-1.73C5.87-.67 5.18-.32 4.2-.32C2.88-.32 2.12-1.21 2.12-2.76C2.12-4.18 2.69-5.62 3.62-6.59C4.19-7.18 4.94-7.5 5.73-7.5C6.82-7.5 7.43-6.86 7.55-5.57L7.77-5.54L8.21-7.91H7.96C7.86-7.72 7.74-7.65 7.5-7.65C7.4-7.65 7.27-7.67 7.02-7.73C6.49-7.86 6.01-7.93 5.62-7.93C3.07-7.93 .79-5.55 .79-2.89C.79-1.07 2.07 .21 3.89 .21C5.12 .21 6.07-.3 7.15-1.56Z'/>
<path id='eq103-g10-63' d='M5.59-3.76C5.59-4.69 5.07-5.25 4.22-5.25C3.44-5.25 2.87-4.87 2.18-3.91L2.55-5.2C2.55-5.2 2.53-5.25 2.49-5.25H2.48L.64-4.99L.67-4.81C1.02-4.81 1.44-4.81 1.44-4.49C1.44-4.35 1.02-2.7 .6-1.12L-.1 1.55C-.21 2.1-.38 2.24-.89 2.25V2.44H1.55V2.26C.99 2.26 .79 2.17 .79 1.91C.79 1.74 .99 .85 1.23-.07C1.52 .08 1.74 .13 2.01 .13C3.75 .13 5.59-1.86 5.59-3.76ZM4.51-3.73C4.51-2.94 4.19-1.95 3.69-1.23C3.18-.48 2.6-.1 1.97-.1C1.63-.1 1.39-.27 1.39-.54C1.39-.94 1.81-2.49 2.17-3.38C2.48-4.17 3.14-4.74 3.73-4.74C3.74-4.74 3.76-4.74 3.78-4.74C4.29-4.72 4.51-4.41 4.51-3.73Z'/>
<path id='eq103-g10-65' d='M4.91-4.65C4.91-5 4.68-5.25 4.35-5.25C4.07-5.25 3.75-5.07 3.44-4.75C2.95-4.24 2.48-3.55 2.29-3.07L2.12-2.64L2.75-5.23L2.72-5.25L.87-4.93V-4.73C.96-4.73 1.07-4.73 1.17-4.73C1.44-4.73 1.69-4.7 1.69-4.45C1.69-4.29 1.69-4.29 1.5-3.48L.54 0H1.44C2.05-2 2.24-2.48 2.76-3.36C3.18-4.09 3.53-4.48 3.74-4.48C3.82-4.48 3.87-4.43 3.93-4.31C4.03-4.11 4.12-4.05 4.36-4.05C4.72-4.05 4.91-4.26 4.91-4.65Z'/>
<path id='eq103-g10-150' d='M2.32-.07C2.32-1.06 1.63-1.21 1.36-1.21C1.06-1.21 .67-1.04 .67-.52C.67-.05 1.1 .07 1.41 .07C1.49 .07 1.55 .06 1.58 .05C1.63 .04 1.67 .02 1.69 .02C1.77 .02 1.86 .08 1.86 .19C1.86 .42 1.67 .95 .88 1.45L.99 1.68C1.35 1.56 2.32 .77 2.32-.07Z'/>
</defs>
<g id='eq103-page1'>
<use x='128.59' y='-14.38' xlink:href='#eq103-g10-65'/>
<use x='137.46' y='-14.38' xlink:href='#eq103-g1-61'/>
<use x='165.13' y='-30.84' xlink:href='#eq103-g4-205'/>
<use x='176.59' y='-22.48' xlink:href='#eq103-g10-24'/>
<use x='184.57' y='-20.68' xlink:href='#eq103-g14-49'/>
<use x='190.05' y='-22.48' xlink:href='#eq103-g7-185'/>
<use x='195.38' y='-22.48' xlink:href='#eq103-g10-63'/>
<use x='201.84' y='-22.48' xlink:href='#eq103-g7-186'/>
<use x='206.22' y='-22.48' xlink:href='#eq103-g10-24'/>
<use x='214.2' y='-20.68' xlink:href='#eq103-g14-50'/>
<use x='219.68' y='-22.48' xlink:href='#eq103-g7-185'/>
<use x='225.01' y='-22.48' xlink:href='#eq103-g10-63'/>
<use x='231.46' y='-22.48' xlink:href='#eq103-g7-186'/>
<rect x='149.05' y='-17.79' height='.67' width='103.07'/>
<use x='149.05' y='-13.77' xlink:href='#eq103-g4-112'/>
<rect x='157.81' y='-14.44' height='.67' width='94.32'/>
<use x='157.81' y='-11.39' xlink:href='#eq103-g4-205'/>
<use x='169.27' y='-3.02' xlink:href='#eq103-g10-24'/>
<use x='177.24' y='-1.23' xlink:href='#eq103-g14-49'/>
<use x='182.72' y='-3.02' xlink:href='#eq103-g7-185'/>
<use x='188.05' y='-3.02' xlink:href='#eq103-g10-63'/>
<use x='194.51' y='-3.02' xlink:href='#eq103-g7-186'/>
<use x='199.09' y='-6.48' xlink:href='#eq103-g14-50'/>
<use x='205.96' y='-11.39' xlink:href='#eq103-g4-205'/>
<use x='217.42' y='-3.02' xlink:href='#eq103-g10-24'/>
<use x='225.4' y='-1.23' xlink:href='#eq103-g14-50'/>
<use x='230.87' y='-3.02' xlink:href='#eq103-g7-185'/>
<use x='236.21' y='-3.02' xlink:href='#eq103-g10-63'/>
<use x='242.66' y='-3.02' xlink:href='#eq103-g7-186'/>
<use x='247.24' y='-6.48' xlink:href='#eq103-g14-50'/>
<use x='256.64' y='-14.38' xlink:href='#eq103-g10-150'/>
</g>
</svg></div>
<p>with <span class="m-math"><svg style="width: 1.142em; height: 0.973em; vertical-align: -0.180em; " viewBox="-.19 -7.93 11.42 9.73">
<title>
\(C_1\)
</title>
<defs>
<path id='eq104-g5-49' d='M3.44 0V-.13C2.75-.14 2.61-.23 2.61-.65V-5.89L2.54-5.9L.97-5.11V-4.99C1.07-5.03 1.17-5.07 1.21-5.08C1.36-5.14 1.51-5.18 1.6-5.18C1.78-5.18 1.86-5.05 1.86-4.77V-.81C1.86-.52 1.79-.32 1.65-.24C1.52-.17 1.4-.14 1.03-.13V0H3.44Z'/>
<path id='eq104-g1-24' d='M7.15-1.56L6.94-1.73C5.87-.67 5.18-.32 4.2-.32C2.88-.32 2.12-1.21 2.12-2.76C2.12-4.18 2.69-5.62 3.62-6.59C4.19-7.18 4.94-7.5 5.73-7.5C6.82-7.5 7.43-6.86 7.55-5.57L7.77-5.54L8.21-7.91H7.96C7.86-7.72 7.74-7.65 7.5-7.65C7.4-7.65 7.27-7.67 7.02-7.73C6.49-7.86 6.01-7.93 5.62-7.93C3.07-7.93 .79-5.55 .79-2.89C.79-1.07 2.07 .21 3.89 .21C5.12 .21 6.07-.3 7.15-1.56Z'/>
</defs>
<g id='eq104-page1'>
<use x='-.19' y='0' xlink:href='#eq104-g1-24'/>
<use x='7.78' y='1.79' xlink:href='#eq104-g5-49'/>
</g>
</svg></span> and <span class="m-math"><svg style="width: 1.212em; height: 0.973em; vertical-align: -0.180em; " viewBox="-.19 -7.93 12.12 9.73">
<title>
\(C_2\)
</title>
<defs>
<path id='eq105-g5-50' d='M4.15-1.2L4.04-1.24C3.71-.74 3.6-.66 3.21-.66H1.12L2.59-2.2C3.36-3.01 3.7-3.68 3.7-4.36C3.7-5.23 3-5.9 2.09-5.9C1.61-5.9 1.15-5.71 .83-5.36C.55-5.07 .42-4.79 .27-4.17L.45-4.12C.8-4.98 1.12-5.26 1.72-5.26C2.45-5.26 2.95-4.76 2.95-4.03C2.95-3.35 2.55-2.53 1.82-1.76L.26-.1V0H3.67L4.15-1.2Z'/>
<path id='eq105-g1-24' d='M7.15-1.56L6.94-1.73C5.87-.67 5.18-.32 4.2-.32C2.88-.32 2.12-1.21 2.12-2.76C2.12-4.18 2.69-5.62 3.62-6.59C4.19-7.18 4.94-7.5 5.73-7.5C6.82-7.5 7.43-6.86 7.55-5.57L7.77-5.54L8.21-7.91H7.96C7.86-7.72 7.74-7.65 7.5-7.65C7.4-7.65 7.27-7.67 7.02-7.73C6.49-7.86 6.01-7.93 5.62-7.93C3.07-7.93 .79-5.55 .79-2.89C.79-1.07 2.07 .21 3.89 .21C5.12 .21 6.07-.3 7.15-1.56Z'/>
</defs>
<g id='eq105-page1'>
<use x='-.19' y='0' xlink:href='#eq105-g1-24'/>
<use x='7.78' y='1.79' xlink:href='#eq105-g5-50'/>
</g>
</svg></span> the two channels.
Thus, it returns a value proportional to the fraction of pixels where both channels have a large value.
Do note the arguments against this method by Adler and Parmryd (2010).</p>
<p>The images must be scalar and real-valued.</p>
<p>If <code>mask</code> is not forged, all input pixels are considered. For this measure, it is very important to select
only relevant pixels, and exclude any background pixels with background staining. Furthermore, the zero
level is important, any offset should be subtracted first.</p>
<p>To compute the Manders Overlap Coefficient between two channels in a multi-channel image (a tensor image):</p>
<div class="m-code"><pre><span></span><span class="n">MandersOverlapCoefficient</span><span class="p">(</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">],</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">],</span><span class="w"> </span><span class="n">mask</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
</pre></div>

<aside class="m-note m-default">
<h4>See also</h4>
<p><a href="histograms.html#dip-PearsonCorrelation-dip-Histogram-CL"><code>dip::PearsonCorrelation</code></a>, <a href="math_statistics.html#dip-SpearmanRankCorrelation-dip-Image-CL-dip-Image-CL-dip-Image-CL"><code>dip::SpearmanRankCorrelation</code></a>, <a href="microscopy.html#dip-IntensityCorrelationQuotient-dip-Image-CL-dip-Image-CL-dip-Image-CL"><code>dip::IntensityCorrelationQuotient</code></a>, <a href="microscopy.html#dip-MandersColocalizationCoefficients-dip-Image-CL-dip-Image-CL-dip-Image-CL-dip-dfloat--dip-dfloat-"><code>dip::MandersColocalizationCoefficients</code></a>, <a href="microscopy.html#dip-CostesColocalizationCoefficients-dip-Image-CL-dip-Image-CL-dip-Image-CL"><code>dip::CostesColocalizationCoefficients</code></a></p>
</aside>
<aside class="m-note m-default">
<h4>Literature</h4>
<ul>
<li>E.M.M. Manders, F.J. Verbeek, and J.A. Aten, &ldquo;Measurement of co-localization of objects in dual-color confocal images&rdquo;,
  Journal of Microscopy 169(3):375-382, 1993.</li>
<li>J. Adler, and I. Parmryd, &ldquo;Quantifying colocalization by correlation: the Pearson correlation coefficient is superior
  to the Mander&rsquo;s overlap coefficient&rdquo;, Cytometry A 77(8):733-42, 2010.</li>
</ul>
</aside>
          </div></section>
          <section class="m-doc-details" id="dip-IntensityCorrelationQuotient-dip-Image-CL-dip-Image-CL-dip-Image-CL"><div>
            <h3>
              <span class="m-doc-wrap-bumper"><a href="pixeltypes.html#dip-dfloat" class="m-doc">dip::dfloat</a>
                </span><span class="m-doc-wrap"><span class="m-doc-wrap-bumper"><a href="#dip-IntensityCorrelationQuotient-dip-Image-CL-dip-Image-CL-dip-Image-CL" class="m-doc-self">dip::<wbr />IntensityCorrelationQuotient</a>(</span><span class="m-doc-wrap"><a href="dip-Image.html" class="m-doc">dip::Image</a> const&amp; channel1,
              <a href="dip-Image.html" class="m-doc">dip::Image</a> const&amp; channel2,
              <a href="dip-Image.html" class="m-doc">dip::Image</a> const&amp; mask = {})</span></span>
            </h3>
            <p>Computes Li&rsquo;s Intensity Correlation Quotient.</p>
<p>Li&rsquo;s Intensity Correlation Quotient is proportional to the fraction of pixels where the two channels vary in a
dependent manner. For each pixel, <span class="m-math"><svg style="width: 11.396em; height: 1.315em; vertical-align: -0.240em; " viewBox=".13 -10.75 113.96 13.15">
<title>
\(c = (C_1 - \overline{C_1})(C_2 - \overline{C_2})\)
</title>
<defs>
<path id='eq106-g4-0' d='M6.84-2.73V-3.39H.74V-2.73H6.84Z'/>
<path id='eq106-g4-185' d='M3.51-8.54C1.79-7.42 .57-5.49 .57-3.06C.57-.85 1.83 1.39 3.48 2.41L3.62 2.22C2.05 .98 1.6-.46 1.6-3.1C1.6-5.74 2.08-7.11 3.62-8.35L3.51-8.54Z'/>
<path id='eq106-g4-186' d='M.45-8.54L.35-8.35C1.88-7.11 2.37-5.74 2.37-3.1C2.37-.46 1.92 .98 .35 2.22L.49 2.41C2.13 1.39 3.39-.85 3.39-3.06C3.39-5.49 2.18-7.42 .45-8.54Z'/>
<path id='eq106-g1-61' d='M6.57-3.93V-4.6H.48V-3.93H6.57ZM6.57-1.51V-2.18H.48V-1.51H6.57Z'/>
<path id='eq106-g11-49' d='M3.44 0V-.13C2.75-.14 2.61-.23 2.61-.65V-5.89L2.54-5.9L.97-5.11V-4.99C1.07-5.03 1.17-5.07 1.21-5.08C1.36-5.14 1.51-5.18 1.6-5.18C1.78-5.18 1.86-5.05 1.86-4.77V-.81C1.86-.52 1.79-.32 1.65-.24C1.52-.17 1.4-.14 1.03-.13V0H3.44Z'/>
<path id='eq106-g11-50' d='M4.15-1.2L4.04-1.24C3.71-.74 3.6-.66 3.21-.66H1.12L2.59-2.2C3.36-3.01 3.7-3.68 3.7-4.36C3.7-5.23 3-5.9 2.09-5.9C1.61-5.9 1.15-5.71 .83-5.36C.55-5.07 .42-4.79 .27-4.17L.45-4.12C.8-4.98 1.12-5.26 1.72-5.26C2.45-5.26 2.95-4.76 2.95-4.03C2.95-3.35 2.55-2.53 1.82-1.76L.26-.1V0H3.67L4.15-1.2Z'/>
<path id='eq106-g7-24' d='M7.15-1.56L6.94-1.73C5.87-.67 5.18-.32 4.2-.32C2.88-.32 2.12-1.21 2.12-2.76C2.12-4.18 2.69-5.62 3.62-6.59C4.19-7.18 4.94-7.5 5.73-7.5C6.82-7.5 7.43-6.86 7.55-5.57L7.77-5.54L8.21-7.91H7.96C7.86-7.72 7.74-7.65 7.5-7.65C7.4-7.65 7.27-7.67 7.02-7.73C6.49-7.86 6.01-7.93 5.62-7.93C3.07-7.93 .79-5.55 .79-2.89C.79-1.07 2.07 .21 3.89 .21C5.12 .21 6.07-.3 7.15-1.56Z'/>
<path id='eq106-g7-50' d='M4.36-1.14L4.17-1.26C3.51-.56 3.05-.3 2.47-.3C1.79-.3 1.38-.8 1.38-1.66C1.38-2.67 1.8-3.73 2.47-4.43C2.81-4.79 3.29-5 3.76-5C4.04-5 4.2-4.91 4.2-4.76C4.2-4.7 4.19-4.65 4.13-4.54C4.05-4.38 4.03-4.31 4.03-4.19C4.03-3.91 4.2-3.74 4.49-3.74C4.82-3.74 5.06-3.97 5.06-4.29C5.06-4.85 4.54-5.25 3.81-5.25C2.02-5.25 .36-3.51 .36-1.66C.36-.52 1 .13 2.11 .13C3 .13 3.63-.23 4.36-1.14Z'/>
</defs>
<g id='eq106-page1'>
<use x='.13' y='0' xlink:href='#eq106-g7-50'/>
<use x='9.11' y='0' xlink:href='#eq106-g1-61'/>
<use x='20.11' y='0' xlink:href='#eq106-g4-185'/>
<use x='24.38' y='0' xlink:href='#eq106-g7-24'/>
<use x='32.35' y='1.79' xlink:href='#eq106-g11-49'/>
<use x='39.89' y='0' xlink:href='#eq106-g4-0'/>
<rect x='50.15' y='-10.75' height='.67' width='12.66'/>
<use x='49.96' y='0' xlink:href='#eq106-g7-24'/>
<use x='57.93' y='1.79' xlink:href='#eq106-g11-49'/>
<use x='62.81' y='0' xlink:href='#eq106-g4-186'/>
<use x='67.99' y='0' xlink:href='#eq106-g4-185'/>
<use x='72.26' y='0' xlink:href='#eq106-g7-24'/>
<use x='80.23' y='1.79' xlink:href='#eq106-g11-50'/>
<use x='87.77' y='0' xlink:href='#eq106-g4-0'/>
<rect x='98.03' y='-10.75' height='.67' width='12.66'/>
<use x='97.84' y='0' xlink:href='#eq106-g7-24'/>
<use x='105.81' y='1.79' xlink:href='#eq106-g11-50'/>
<use x='110.7' y='0' xlink:href='#eq106-g4-186'/>
</g>
</svg></span> is computed. Then the ICQ is
<span class="m-math"><svg style="width: 4.818em; height: 1.779em; vertical-align: -0.582em; " viewBox="1.2 -11.97 48.18 17.79">
<title>
\(\frac{|c&gt;0|}{|c|} - 0.5\)
</title>
<defs>
<use id='eq107-g4-0' xlink:href='#eq107-g1-0' transform='scale(1.36)'/>
<use id='eq107-g10-149' xlink:href='#eq107-g7-149' transform='scale(1.36)'/>
<path id='eq107-g7-50' d='M3.2-.84L3.06-.93C2.58-.41 2.24-.22 1.81-.22C1.31-.22 1.01-.59 1.01-1.21C1.01-1.96 1.32-2.73 1.81-3.25C2.06-3.51 2.41-3.67 2.76-3.67C2.96-3.67 3.08-3.6 3.08-3.49C3.08-3.45 3.07-3.41 3.03-3.33C2.97-3.21 2.95-3.16 2.95-3.07C2.95-2.86 3.08-2.74 3.29-2.74C3.54-2.74 3.71-2.91 3.71-3.14C3.71-3.55 3.33-3.85 2.79-3.85C1.48-3.85 .26-2.58 .26-1.21C.26-.38 .73 .1 1.55 .1C2.2 .1 2.66-.17 3.2-.84Z'/>
<path id='eq107-g7-149' d='M1.58-.38C1.58-.65 1.35-.87 1.09-.87S.61-.66 .61-.38C.61-.04 .91 .1 1.09 .1S1.58-.05 1.58-.38Z'/>
<path id='eq107-g7-161' d='M5.01-2.16V-2.33L.54-4.44V-3.95L4.18-2.24L.54-.54V-.05L5.01-2.16Z'/>
<use id='eq107-g17-48' xlink:href='#eq107-g14-48' transform='scale(1.36)'/>
<use id='eq107-g17-53' xlink:href='#eq107-g14-53' transform='scale(1.36)'/>
<path id='eq107-g14-48' d='M4.16-2.88C4.16-4.67 3.36-5.9 2.22-5.9C1.74-5.9 1.37-5.76 1.05-5.45C.54-4.96 .21-3.96 .21-2.93C.21-1.98 .5-.96 .91-.47C1.23-.09 1.68 .12 2.18 .12C2.63 .12 3-.03 3.32-.33C3.83-.81 4.16-1.83 4.16-2.88ZM3.32-2.86C3.32-1.04 2.93-.1 2.18-.1S1.05-1.04 1.05-2.86C1.05-4.71 1.44-5.68 2.19-5.68C2.93-5.68 3.32-4.69 3.32-2.86Z'/>
<path id='eq107-g14-53' d='M3.83-5.95L3.75-6.01C3.62-5.83 3.53-5.78 3.35-5.78H1.52L.57-3.71C.56-3.69 .56-3.67 .56-3.67C.56-3.62 .59-3.6 .66-3.6C.94-3.6 1.29-3.54 1.65-3.42C2.66-3.1 3.12-2.56 3.12-1.69C3.12-.86 2.59-.2 1.9-.2C1.73-.2 1.58-.26 1.32-.45C1.04-.66 .84-.74 .66-.74C.4-.74 .28-.64 .28-.42C.28-.09 .69 .12 1.35 .12C2.08 .12 2.71-.11 3.14-.56C3.55-.95 3.73-1.45 3.73-2.11C3.73-2.74 3.56-3.14 3.13-3.58C2.74-3.97 2.24-4.17 1.21-4.35L1.58-5.09H3.29C3.43-5.09 3.47-5.11 3.49-5.17L3.83-5.95Z'/>
<path id='eq107-g1-0' d='M5.01-2V-2.49H.54V-2H5.01Z'/>
<path id='eq107-g1-106' d='M1.12 1.69V-6.18H.63V1.69H1.12Z'/>
</defs>
<g id='eq107-page1'>
<use x='1.55' y='-5.8' xlink:href='#eq107-g1-106'/>
<use x='3.75' y='-5.8' xlink:href='#eq107-g7-50'/>
<use x='8.08' y='-5.8' xlink:href='#eq107-g7-161'/>
<use x='13.85' y='-5.8' xlink:href='#eq107-g14-48'/>
<use x='18.59' y='-5.8' xlink:href='#eq107-g1-106'/>
<rect x='1.2' y='-3.41' height='.67' width='19.49'/>
<use x='6.71' y='4.13' xlink:href='#eq107-g1-106'/>
<use x='8.91' y='4.13' xlink:href='#eq107-g7-50'/>
<use x='13.42' y='4.13' xlink:href='#eq107-g1-106'/>
<use x='24.54' y='0' xlink:href='#eq107-g4-0'/>
<use x='34.8' y='0' xlink:href='#eq107-g17-48'/>
<use x='40.97' y='0' xlink:href='#eq107-g10-149'/>
<use x='44.16' y='0' xlink:href='#eq107-g17-53'/>
</g>
</svg></span>, with <span class="m-math"><svg style="width: 1.341em; height: 1.072em; vertical-align: -0.230em; " viewBox=".48 -8.42 13.41 10.72">
<title>
\(|\cdot|\)
</title>
<defs>
<path id='eq108-g1-1' d='M2.16-3.05C2.16-3.42 1.85-3.73 1.49-3.73S.83-3.43 .83-3.05C.83-2.6 1.24-2.41 1.49-2.41S2.16-2.61 2.16-3.05Z'/>
<path id='eq108-g1-106' d='M1.52 2.3V-8.42H.86V2.3H1.52Z'/>
</defs>
<g id='eq108-page1'>
<use x='.48' y='0' xlink:href='#eq108-g1-106'/>
<use x='6.12' y='0' xlink:href='#eq108-g1-1'/>
<use x='12.37' y='0' xlink:href='#eq108-g1-106'/>
</g>
</svg></span> the count operator.</p>
<p>The images must be scalar and real-valued. If <code>mask</code> is not forged, all input pixels are considered.</p>
<p>To compute Li&rsquo;s Intensity Correlation Quotient between two channels in a multi-channel image (a tensor image):</p>
<div class="m-code"><pre><span></span><span class="n">IntensityCorrelationQuotient</span><span class="p">(</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">],</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">],</span><span class="w"> </span><span class="n">mask</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
</pre></div>

<aside class="m-note m-default">
<h4>See also</h4>
<p><a href="histograms.html#dip-PearsonCorrelation-dip-Histogram-CL"><code>dip::PearsonCorrelation</code></a>, <a href="math_statistics.html#dip-SpearmanRankCorrelation-dip-Image-CL-dip-Image-CL-dip-Image-CL"><code>dip::SpearmanRankCorrelation</code></a>, <a href="microscopy.html#dip-MandersOverlapCoefficient-dip-Image-CL-dip-Image-CL-dip-Image-CL"><code>dip::MandersOverlapCoefficient</code></a></p>
</aside>
<aside class="m-note m-default">
<h4>Literature</h4>
<ul>
<li>Q. Li, A. Lau, T.J. Morris, L. Guo, C.B. Fordyce, and E.F. Stanley, &ldquo;A Syntaxin 1, G&alpha;<sup>o</sup>, and N-Type
  Calcium Channel Complex at a Presynaptic Nerve Terminal: Analysis by Quantitative Immunocolocalization&rdquo;,
  Journal of Neuroscience 24(16):4070-4081, 2004.</li>
</ul>
</aside>
          </div></section>
          <section class="m-doc-details" id="dip-MandersColocalizationCoefficients-dip-Image-CL-dip-Image-CL-dip-Image-CL-dip-dfloat--dip-dfloat-"><div>
            <h3>
              <span class="m-doc-wrap-bumper"><a href="microscopy.html#dip-ColocalizationCoefficients" class="m-doc">dip::ColocalizationCoefficients</a>
                </span><span class="m-doc-wrap"><span class="m-doc-wrap-bumper"><a href="#dip-MandersColocalizationCoefficients-dip-Image-CL-dip-Image-CL-dip-Image-CL-dip-dfloat--dip-dfloat-" class="m-doc-self">dip::<wbr />MandersColocalizationCoefficients</a>(</span><span class="m-doc-wrap"><a href="dip-Image.html" class="m-doc">dip::Image</a> const&amp; channel1,
              <a href="dip-Image.html" class="m-doc">dip::Image</a> const&amp; channel2,
              <a href="dip-Image.html" class="m-doc">dip::Image</a> const&amp; mask = {},
              <a href="pixeltypes.html#dip-dfloat" class="m-doc">dip::dfloat</a> threshold1 = 0,
              <a href="pixeltypes.html#dip-dfloat" class="m-doc">dip::dfloat</a> threshold2 = 0)</span></span>
            </h3>
            <p>Computes Manders&rsquo; Colocalization Coefficients.</p>
<p>Manders&rsquo; Colocalization Coefficients separate out the contributions in Manders Overlap Coefficient of the two
channels <span class="m-math"><svg style="width: 1.142em; height: 0.973em; vertical-align: -0.180em; " viewBox="-.19 -7.93 11.42 9.73">
<title>
\(C_1\)
</title>
<defs>
<path id='eq110-g5-49' d='M3.44 0V-.13C2.75-.14 2.61-.23 2.61-.65V-5.89L2.54-5.9L.97-5.11V-4.99C1.07-5.03 1.17-5.07 1.21-5.08C1.36-5.14 1.51-5.18 1.6-5.18C1.78-5.18 1.86-5.05 1.86-4.77V-.81C1.86-.52 1.79-.32 1.65-.24C1.52-.17 1.4-.14 1.03-.13V0H3.44Z'/>
<path id='eq110-g1-24' d='M7.15-1.56L6.94-1.73C5.87-.67 5.18-.32 4.2-.32C2.88-.32 2.12-1.21 2.12-2.76C2.12-4.18 2.69-5.62 3.62-6.59C4.19-7.18 4.94-7.5 5.73-7.5C6.82-7.5 7.43-6.86 7.55-5.57L7.77-5.54L8.21-7.91H7.96C7.86-7.72 7.74-7.65 7.5-7.65C7.4-7.65 7.27-7.67 7.02-7.73C6.49-7.86 6.01-7.93 5.62-7.93C3.07-7.93 .79-5.55 .79-2.89C.79-1.07 2.07 .21 3.89 .21C5.12 .21 6.07-.3 7.15-1.56Z'/>
</defs>
<g id='eq110-page1'>
<use x='-.19' y='0' xlink:href='#eq110-g1-24'/>
<use x='7.78' y='1.79' xlink:href='#eq110-g5-49'/>
</g>
</svg></span> and <span class="m-math"><svg style="width: 1.212em; height: 0.973em; vertical-align: -0.180em; " viewBox="-.19 -7.93 12.12 9.73">
<title>
\(C_2\)
</title>
<defs>
<path id='eq111-g5-50' d='M4.15-1.2L4.04-1.24C3.71-.74 3.6-.66 3.21-.66H1.12L2.59-2.2C3.36-3.01 3.7-3.68 3.7-4.36C3.7-5.23 3-5.9 2.09-5.9C1.61-5.9 1.15-5.71 .83-5.36C.55-5.07 .42-4.79 .27-4.17L.45-4.12C.8-4.98 1.12-5.26 1.72-5.26C2.45-5.26 2.95-4.76 2.95-4.03C2.95-3.35 2.55-2.53 1.82-1.76L.26-.1V0H3.67L4.15-1.2Z'/>
<path id='eq111-g1-24' d='M7.15-1.56L6.94-1.73C5.87-.67 5.18-.32 4.2-.32C2.88-.32 2.12-1.21 2.12-2.76C2.12-4.18 2.69-5.62 3.62-6.59C4.19-7.18 4.94-7.5 5.73-7.5C6.82-7.5 7.43-6.86 7.55-5.57L7.77-5.54L8.21-7.91H7.96C7.86-7.72 7.74-7.65 7.5-7.65C7.4-7.65 7.27-7.67 7.02-7.73C6.49-7.86 6.01-7.93 5.62-7.93C3.07-7.93 .79-5.55 .79-2.89C.79-1.07 2.07 .21 3.89 .21C5.12 .21 6.07-.3 7.15-1.56Z'/>
</defs>
<g id='eq111-page1'>
<use x='-.19' y='0' xlink:href='#eq111-g1-24'/>
<use x='7.78' y='1.79' xlink:href='#eq111-g5-50'/>
</g>
</svg></span>, defining two coefficients as the fraction of staining in one channel that
appears where the other channel has some staining,</p>
<div class="m-math"><svg style="width: 26.436em; height: 3.109em; vertical-align: 0.003em; " viewBox="61.76 -31.12 264.36 31.09">
<title>
\[ M_1 = \frac{\sum_{p|C_2(p) &gt; 0}{C_1(p)}}{\sum_p{C_1(p)}} \; , \qquad
   M_2 = \frac{\sum_{p|C_1(p) &gt; 0}{C_2(p)}}{\sum_p{C_2(p)}} \; . \]
</title>
<defs>
<path id='eq109-g7-106' d='M1.12 1.69V-6.18H.63V1.69H1.12Z'/>
<path id='eq109-g7-185' d='M2.58-6.26C1.31-5.44 .42-4.03 .42-2.24C.42-.62 1.35 1.02 2.55 1.76L2.66 1.62C1.5 .72 1.17-.34 1.17-2.27C1.17-4.21 1.53-5.21 2.66-6.12L2.58-6.26Z'/>
<path id='eq109-g7-186' d='M.33-6.26L.25-6.12C1.38-5.21 1.74-4.21 1.74-2.27C1.74-.34 1.41 .72 .25 1.62L.36 1.76C1.56 1.02 2.49-.62 2.49-2.24C2.49-4.03 1.6-5.44 .33-6.26Z'/>
<path id='eq109-g4-205' d='M8.65 7.3H8.4C8.16 8.79 7.61 9.46 6.78 9.46H2.11L5.56 5.03L2.49 .46H6.3C7.17 .46 7.72 .94 7.97 2.45H8.23L8.16 0H1.01L4.66 5.23L.51 10.48H8.52L8.65 7.3Z'/>
<use id='eq109-g10-185' xlink:href='#eq109-g7-185' transform='scale(1.36)'/>
<use id='eq109-g10-186' xlink:href='#eq109-g7-186' transform='scale(1.36)'/>
<use id='eq109-g16-24' xlink:href='#eq109-g13-24' transform='scale(1.36)'/>
<use id='eq109-g16-34' xlink:href='#eq109-g13-34' transform='scale(1.36)'/>
<use id='eq109-g16-63' xlink:href='#eq109-g13-63' transform='scale(1.36)'/>
<use id='eq109-g16-149' xlink:href='#eq109-g13-149' transform='scale(1.36)'/>
<use id='eq109-g16-150' xlink:href='#eq109-g13-150' transform='scale(1.36)'/>
<path id='eq109-g13-24' d='M5.24-1.14L5.09-1.27C4.31-.49 3.8-.24 3.08-.24C2.11-.24 1.55-.89 1.55-2.03C1.55-3.07 1.97-4.12 2.66-4.83C3.07-5.27 3.62-5.5 4.2-5.5C5-5.5 5.45-5.03 5.54-4.09L5.69-4.06L6.02-5.8H5.83C5.76-5.66 5.68-5.61 5.5-5.61C5.42-5.61 5.33-5.62 5.14-5.67C4.76-5.76 4.41-5.82 4.12-5.82C2.25-5.82 .58-4.07 .58-2.12C.58-.79 1.52 .16 2.86 .16C3.76 .16 4.45-.22 5.24-1.14Z'/>
<path id='eq109-g13-34' d='M6.41 0V-.14C5.82-.19 5.74-.24 5.74-.52C5.74-.66 5.76-.77 5.83-1.05L6.91-4.92C7.07-5.44 7.11-5.49 7.63-5.56V-5.7H6.17L3.23-1.4L2.75-5.7H1.17V-5.56C1.61-5.54 1.82-5.44 1.82-5.24C1.82-5.17 1.78-5.04 1.73-4.88L1.65-4.62L1.62-4.52L.7-1.28C.43-.37 .3-.19-.16-.14V0H1.57V-.14C1.13-.17 .95-.28 .95-.52C.95-.62 .99-.83 1.03-.99L2.06-4.77L2.59 0H2.74L6.04-4.9L4.91-.79C4.77-.33 4.59-.2 4.03-.14V0H6.41Z'/>
<path id='eq109-g13-63' d='M4.1-2.76C4.1-3.44 3.72-3.85 3.09-3.85C2.52-3.85 2.1-3.57 1.6-2.86L1.87-3.82C1.87-3.82 1.85-3.85 1.83-3.85H1.82L.47-3.66L.49-3.53C.75-3.53 1.06-3.53 1.06-3.29C1.06-3.19 .75-1.98 .44-.82L-.07 1.14C-.16 1.54-.28 1.64-.66 1.65V1.79H1.14V1.66C.72 1.66 .58 1.59 .58 1.4C.58 1.28 .72 .62 .9-.05C1.12 .06 1.28 .1 1.48 .1C2.75 .1 4.1-1.36 4.1-2.76ZM3.31-2.73C3.31-2.16 3.07-1.43 2.71-.9C2.33-.35 1.9-.07 1.44-.07C1.2-.07 1.02-.2 1.02-.39C1.02-.69 1.33-1.83 1.59-2.48C1.82-3.06 2.31-3.48 2.73-3.48C2.74-3.48 2.76-3.48 2.77-3.48C3.14-3.46 3.31-3.23 3.31-2.73Z'/>
<path id='eq109-g13-149' d='M1.58-.38C1.58-.65 1.35-.87 1.09-.87S.61-.66 .61-.38C.61-.04 .91 .1 1.09 .1S1.58-.05 1.58-.38Z'/>
<path id='eq109-g13-150' d='M1.7-.05C1.7-.78 1.2-.89 1-.89C.78-.89 .49-.76 .49-.38C.49-.03 .8 .05 1.03 .05C1.09 .05 1.14 .04 1.16 .03C1.2 .03 1.22 .02 1.24 .02C1.3 .02 1.36 .06 1.36 .14C1.36 .31 1.22 .7 .65 1.07L.72 1.23C.99 1.14 1.7 .57 1.7-.05Z'/>
<path id='eq109-g13-161' d='M5.01-2.16V-2.33L.54-4.44V-3.95L4.18-2.24L.54-.54V-.05L5.01-2.16Z'/>
<path id='eq109-g20-48' d='M3.12-2.16C3.12-3.5 2.52-4.43 1.66-4.43C1.3-4.43 1.03-4.32 .79-4.09C.41-3.72 .16-2.97 .16-2.2C.16-1.49 .37-.72 .68-.35C.92-.07 1.26 .09 1.64 .09C1.97 .09 2.25-.02 2.49-.25C2.87-.61 3.12-1.37 3.12-2.16ZM2.49-2.15C2.49-.78 2.2-.08 1.64-.08S.79-.78 .79-2.14C.79-3.53 1.08-4.26 1.64-4.26C2.19-4.26 2.49-3.52 2.49-2.15Z'/>
<path id='eq109-g20-49' d='M2.58 0V-.1C2.06-.1 1.96-.17 1.96-.48V-4.42L1.91-4.43L.73-3.83V-3.74C.81-3.77 .88-3.8 .9-3.81C1.02-3.86 1.13-3.88 1.2-3.88C1.34-3.88 1.4-3.79 1.4-3.58V-.61C1.4-.39 1.34-.24 1.24-.18C1.14-.12 1.05-.1 .77-.1V0H2.58Z'/>
<path id='eq109-g20-50' d='M3.11-.9L3.03-.93C2.78-.56 2.7-.5 2.4-.5H.84L1.94-1.65C2.52-2.26 2.78-2.76 2.78-3.27C2.78-3.92 2.25-4.43 1.57-4.43C1.21-4.43 .86-4.28 .62-4.02C.41-3.8 .31-3.59 .2-3.12L.34-3.09C.6-3.73 .84-3.94 1.29-3.94C1.84-3.94 2.21-3.57 2.21-3.02C2.21-2.51 1.91-1.9 1.36-1.32L.2-.08V0H2.75L3.11-.9Z'/>
<path id='eq109-g1-61' d='M6.57-3.93V-4.6H.48V-3.93H6.57ZM6.57-1.51V-2.18H.48V-1.51H6.57Z'/>
<use id='eq109-g23-48' xlink:href='#eq109-g20-48' transform='scale(1.33)'/>
<use id='eq109-g23-49' xlink:href='#eq109-g20-49' transform='scale(1.33)'/>
<use id='eq109-g23-50' xlink:href='#eq109-g20-50' transform='scale(1.33)'/>
</defs>
<g id='eq109-page1'>
<use x='61.98' y='-12.68' xlink:href='#eq109-g16-34'/>
<use x='71.88' y='-10.89' xlink:href='#eq109-g23-49'/>
<use x='80.08' y='-12.68' xlink:href='#eq109-g1-61'/>
<use x='91.67' y='-30.95' xlink:href='#eq109-g4-205'/>
<use x='101.97' y='-19.92' xlink:href='#eq109-g13-63'/>
<use x='107.06' y='-19.92' xlink:href='#eq109-g7-106'/>
<use x='109.02' y='-19.92' xlink:href='#eq109-g13-24'/>
<use x='114.87' y='-18.57' xlink:href='#eq109-g20-50'/>
<use x='119.09' y='-19.92' xlink:href='#eq109-g7-185'/>
<use x='123' y='-19.92' xlink:href='#eq109-g13-63'/>
<use x='127.74' y='-19.92' xlink:href='#eq109-g7-186'/>
<use x='131.28' y='-19.92' xlink:href='#eq109-g13-161'/>
<use x='137.05' y='-19.92' xlink:href='#eq109-g23-48'/>
<use x='143.73' y='-22.58' xlink:href='#eq109-g16-24'/>
<use x='151.71' y='-20.79' xlink:href='#eq109-g23-49'/>
<use x='157.19' y='-22.58' xlink:href='#eq109-g10-185'/>
<use x='162.52' y='-22.58' xlink:href='#eq109-g16-63'/>
<use x='168.97' y='-22.58' xlink:href='#eq109-g10-186'/>
<rect x='91.67' y='-16.09' height='.67' width='81.88'/>
<use x='109.04' y='-12.85' xlink:href='#eq109-g4-205'/>
<use x='119.34' y='-1.82' xlink:href='#eq109-g13-63'/>
<use x='126.37' y='-4.48' xlink:href='#eq109-g16-24'/>
<use x='134.34' y='-2.69' xlink:href='#eq109-g23-49'/>
<use x='139.82' y='-4.48' xlink:href='#eq109-g10-185'/>
<use x='145.15' y='-4.48' xlink:href='#eq109-g16-63'/>
<use x='151.61' y='-4.48' xlink:href='#eq109-g10-186'/>
<use x='178.07' y='-12.68' xlink:href='#eq109-g16-150'/>
<use x='207.69' y='-12.68' xlink:href='#eq109-g16-34'/>
<use x='217.59' y='-10.89' xlink:href='#eq109-g23-50'/>
<use x='225.79' y='-12.68' xlink:href='#eq109-g1-61'/>
<use x='237.38' y='-30.95' xlink:href='#eq109-g4-205'/>
<use x='247.68' y='-19.92' xlink:href='#eq109-g13-63'/>
<use x='252.77' y='-19.92' xlink:href='#eq109-g7-106'/>
<use x='254.73' y='-19.92' xlink:href='#eq109-g13-24'/>
<use x='260.58' y='-18.57' xlink:href='#eq109-g20-49'/>
<use x='264.8' y='-19.92' xlink:href='#eq109-g7-185'/>
<use x='268.71' y='-19.92' xlink:href='#eq109-g13-63'/>
<use x='273.45' y='-19.92' xlink:href='#eq109-g7-186'/>
<use x='276.99' y='-19.92' xlink:href='#eq109-g13-161'/>
<use x='282.76' y='-19.92' xlink:href='#eq109-g23-48'/>
<use x='289.44' y='-22.58' xlink:href='#eq109-g16-24'/>
<use x='297.42' y='-20.79' xlink:href='#eq109-g23-50'/>
<use x='302.9' y='-22.58' xlink:href='#eq109-g10-185'/>
<use x='308.23' y='-22.58' xlink:href='#eq109-g16-63'/>
<use x='314.68' y='-22.58' xlink:href='#eq109-g10-186'/>
<rect x='237.38' y='-16.09' height='.67' width='81.88'/>
<use x='254.75' y='-12.85' xlink:href='#eq109-g4-205'/>
<use x='265.05' y='-1.82' xlink:href='#eq109-g13-63'/>
<use x='272.08' y='-4.48' xlink:href='#eq109-g16-24'/>
<use x='280.05' y='-2.69' xlink:href='#eq109-g23-50'/>
<use x='285.53' y='-4.48' xlink:href='#eq109-g10-185'/>
<use x='290.87' y='-4.48' xlink:href='#eq109-g16-63'/>
<use x='297.32' y='-4.48' xlink:href='#eq109-g10-186'/>
<use x='323.97' y='-12.68' xlink:href='#eq109-g16-149'/>
</g>
</svg></div>
<p>Note that if the two input images are binary, this is equivalent to computing the precision and sensitivity using
<a href="math_error.html#dip-Precision-dip-Image-CL-dip-Image-CL"><code>dip::Precision</code></a> and <a href="math_error.html#dip-Sensitivity-dip-Image-CL-dip-Image-CL"><code>dip::Sensitivity</code></a>.</p>
<p>Here, instead of thresholding at 0, we apply <code>threshold1</code> for <code>channel1</code>, and <code>threshold2</code> for <code>channel2</code>. These
thresholds default to 0 to match the method proposed by Manders.</p>
<p>The images must be scalar and real-valued. Any negative values in the input images will cause wrong output,
make sure to clamp the input to 0 before calling this function.
If <code>mask</code> is not forged, all input pixels are considered.</p>
<p>To compute Manders&rsquo; Colocalization Coefficients between two channels in a multi-channel image (a tensor image):</p>
<div class="m-code"><pre><span></span><span class="n">MandersColocalizationCoefficients</span><span class="p">(</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">],</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">],</span><span class="w"> </span><span class="n">mask</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
</pre></div>

<aside class="m-note m-default">
<h4>See also</h4>
<p><a href="microscopy.html#dip-MandersOverlapCoefficient-dip-Image-CL-dip-Image-CL-dip-Image-CL"><code>dip::MandersOverlapCoefficient</code></a>, <a href="microscopy.html#dip-CostesColocalizationCoefficients-dip-Image-CL-dip-Image-CL-dip-Image-CL"><code>dip::CostesColocalizationCoefficients</code></a></p>
</aside>
<aside class="m-note m-default">
<h4>Literature</h4>
<ul>
<li>E.M.M. Manders, F.J. Verbeek, and J.A. Aten, &ldquo;Measurement of co-localization of objects in dual-color confocal images&rdquo;,
  Journal of Microscopy 169(3):375-382, 1993.</li>
</ul>
</aside>
          </div></section>
          <section class="m-doc-details" id="dip-CostesColocalizationCoefficients-dip-Image-CL-dip-Image-CL-dip-Image-CL"><div>
            <h3>
              <span class="m-doc-wrap-bumper"><a href="microscopy.html#dip-ColocalizationCoefficients" class="m-doc">dip::ColocalizationCoefficients</a>
                </span><span class="m-doc-wrap"><span class="m-doc-wrap-bumper"><a href="#dip-CostesColocalizationCoefficients-dip-Image-CL-dip-Image-CL-dip-Image-CL" class="m-doc-self">dip::<wbr />CostesColocalizationCoefficients</a>(</span><span class="m-doc-wrap"><a href="dip-Image.html" class="m-doc">dip::Image</a> const&amp; channel1,
              <a href="dip-Image.html" class="m-doc">dip::Image</a> const&amp; channel2,
              <a href="dip-Image.html" class="m-doc">dip::Image</a> const&amp; mask = {})</span></span>
            </h3>
            <p>Computes Costes&rsquo; colocalization coefficients.</p>
<p>Costes&rsquo; Colocalization Coefficients are similar to Manders&rsquo; colocalization coefficients, but uses a threshold
for each channel under which the correlation is zero. This threshold cuts out the background signal. Staining
is colocalized at those pixels where both channels are above their respective threshold.
The two coefficients are defined as the fraction of total staining that is colocalized,</p>
<div class="m-math"><svg style="width: 28.255em; height: 3.109em; vertical-align: 0.003em; " viewBox="52.82 -31.12 282.55 31.09">
<title>
\[ M_j = \frac{\sum_{p \in T}{C_j(p)}}{\sum_p{C_j(p)}} \;, j \in \{1,2\} \; , \qquad
   T = C_1 &gt; t_1 \wedge C_2 &gt; t_2 \]
</title>
<defs>
<path id='eq112-g20-49' d='M3.44 0V-.13C2.75-.14 2.61-.23 2.61-.65V-5.89L2.54-5.9L.97-5.11V-4.99C1.07-5.03 1.17-5.07 1.21-5.08C1.36-5.14 1.51-5.18 1.6-5.18C1.78-5.18 1.86-5.05 1.86-4.77V-.81C1.86-.52 1.79-.32 1.65-.24C1.52-.17 1.4-.14 1.03-.13V0H3.44Z'/>
<path id='eq112-g20-50' d='M4.15-1.2L4.04-1.24C3.71-.74 3.6-.66 3.21-.66H1.12L2.59-2.2C3.36-3.01 3.7-3.68 3.7-4.36C3.7-5.23 3-5.9 2.09-5.9C1.61-5.9 1.15-5.71 .83-5.36C.55-5.07 .42-4.79 .27-4.17L.45-4.12C.8-4.98 1.12-5.26 1.72-5.26C2.45-5.26 2.95-4.76 2.95-4.03C2.95-3.35 2.55-2.53 1.82-1.76L.26-.1V0H3.67L4.15-1.2Z'/>
<use id='eq112-g23-49' xlink:href='#eq112-g20-49' transform='scale(1.36)'/>
<use id='eq112-g23-50' xlink:href='#eq112-g20-50' transform='scale(1.36)'/>
<use id='eq112-g10-50' xlink:href='#eq112-g7-50' transform='scale(1.36)'/>
<use id='eq112-g10-94' xlink:href='#eq112-g7-94' transform='scale(1.36)'/>
<use id='eq112-g10-102' xlink:href='#eq112-g7-102' transform='scale(1.36)'/>
<use id='eq112-g10-103' xlink:href='#eq112-g7-103' transform='scale(1.36)'/>
<use id='eq112-g10-185' xlink:href='#eq112-g7-185' transform='scale(1.36)'/>
<use id='eq112-g10-186' xlink:href='#eq112-g7-186' transform='scale(1.36)'/>
<path id='eq112-g7-50' d='M4.23-.07V-.51H2.57C1.78-.51 1.01-1.15 .91-2.03H4.08V-2.46H.91C1-3.29 1.69-3.98 2.57-3.98H4.23V-4.42H2.6C1.39-4.42 .45-3.41 .45-2.24S1.39-.07 2.6-.07H4.23Z'/>
<path id='eq112-g7-94' d='M5.17 0L2.93-4.86H2.79L.54 0H1.04L2.86-3.98L4.67 0H5.17Z'/>
<path id='eq112-g7-102' d='M2.13-4.9C2.13-5.22 2.39-5.87 3.09-6.04C3.14-6.06 3.17-6.09 3.17-6.13C3.17-6.22 3.1-6.24 3-6.22C2.32-6.11 1.51-5.56 1.5-4.97V-3.42C1.5-3.11 1.45-2.67 1.33-2.59C1.01-2.38 .69-2.36 .5-2.36C.45-2.35 .42-2.3 .42-2.25C.42-2.17 .47-2.15 .56-2.14C1.14-2.11 1.38-1.84 1.48-1.45C1.5-1.36 1.5-1.35 1.5-1.07V.33C1.5 .66 1.41 1.06 1.83 1.35C2.17 1.59 2.66 1.73 3 1.73C3.1 1.73 3.17 1.73 3.17 1.63C3.17 1.55 3.12 1.57 3.03 1.55C2.45 1.4 2.27 1.09 2.16 .68C2.13 .61 2.13 .59 2.13 .31V-1.19C2.13-1.55 2.06-1.69 1.78-1.94C1.6-2.1 1.52-2.18 1.28-2.25C1.99-2.43 2.13-2.79 2.13-3.26V-4.9Z'/>
<path id='eq112-g7-103' d='M1.46-4.9V-3.26C1.46-2.79 1.6-2.43 2.31-2.25C2.07-2.18 1.99-2.1 1.81-1.94C1.53-1.69 1.46-1.55 1.46-1.19V.31C1.46 .59 1.46 .61 1.43 .68C1.32 1.09 1.14 1.4 .56 1.55C.47 1.57 .42 1.55 .42 1.63C.42 1.73 .49 1.73 .59 1.73C.93 1.73 1.41 1.59 1.76 1.35C2.17 1.06 2.09 .66 2.09 .33V-1.07C2.09-1.35 2.09-1.36 2.11-1.45C2.21-1.84 2.45-2.11 3.03-2.14C3.12-2.15 3.17-2.17 3.17-2.25C3.17-2.3 3.14-2.35 3.09-2.36C2.9-2.36 2.58-2.38 2.26-2.59C2.14-2.67 2.09-3.11 2.09-3.42V-4.97C2.08-5.56 1.27-6.11 .59-6.22C.49-6.24 .42-6.22 .42-6.13C.42-6.09 .45-6.06 .5-6.04C1.2-5.87 1.46-5.22 1.46-4.9Z'/>
<path id='eq112-g7-185' d='M2.58-6.26C1.31-5.44 .42-4.03 .42-2.24C.42-.62 1.35 1.02 2.55 1.76L2.66 1.62C1.5 .72 1.17-.34 1.17-2.27C1.17-4.21 1.53-5.21 2.66-6.12L2.58-6.26Z'/>
<path id='eq112-g7-186' d='M.33-6.26L.25-6.12C1.38-5.21 1.74-4.21 1.74-2.27C1.74-.34 1.41 .72 .25 1.62L.36 1.76C1.56 1.02 2.49-.62 2.49-2.24C2.49-4.03 1.6-5.44 .33-6.26Z'/>
<path id='eq112-g4-205' d='M8.65 7.3H8.4C8.16 8.79 7.61 9.46 6.78 9.46H2.11L5.56 5.03L2.49 .46H6.3C7.17 .46 7.72 .94 7.97 2.45H8.23L8.16 0H1.01L4.66 5.23L.51 10.48H8.52L8.65 7.3Z'/>
<path id='eq112-g1-61' d='M6.57-3.93V-4.6H.48V-3.93H6.57ZM6.57-1.51V-2.18H.48V-1.51H6.57Z'/>
<path id='eq112-g13-24' d='M5.24-1.14L5.09-1.27C4.31-.49 3.8-.24 3.08-.24C2.11-.24 1.55-.89 1.55-2.03C1.55-3.07 1.97-4.12 2.66-4.83C3.07-5.27 3.62-5.5 4.2-5.5C5-5.5 5.45-5.03 5.54-4.09L5.69-4.06L6.02-5.8H5.83C5.76-5.66 5.68-5.61 5.5-5.61C5.42-5.61 5.33-5.62 5.14-5.67C4.76-5.76 4.41-5.82 4.12-5.82C2.25-5.82 .58-4.07 .58-2.12C.58-.79 1.52 .16 2.86 .16C3.76 .16 4.45-.22 5.24-1.14Z'/>
<path id='eq112-g13-34' d='M6.41 0V-.14C5.82-.19 5.74-.24 5.74-.52C5.74-.66 5.76-.77 5.83-1.05L6.91-4.92C7.07-5.44 7.11-5.49 7.63-5.56V-5.7H6.17L3.23-1.4L2.75-5.7H1.17V-5.56C1.61-5.54 1.82-5.44 1.82-5.24C1.82-5.17 1.78-5.04 1.73-4.88L1.65-4.62L1.62-4.52L.7-1.28C.43-.37 .3-.19-.16-.14V0H1.57V-.14C1.13-.17 .95-.28 .95-.52C.95-.62 .99-.83 1.03-.99L2.06-4.77L2.59 0H2.74L6.04-4.9L4.91-.79C4.77-.33 4.59-.2 4.03-.14V0H6.41Z'/>
<path id='eq112-g13-41' d='M5.53-5.7H.88L.52-4.36L.67-4.32C1.11-5.22 1.39-5.4 2.57-5.4C2.63-5.4 2.69-5.4 2.75-5.4L1.49-.79C1.35-.32 1.14-.18 .57-.14V0H3.1V-.14L2.77-.17C2.41-.19 2.31-.27 2.31-.54C2.31-.65 2.33-.73 2.42-1.05L3.63-5.4H4.11C4.74-5.4 5.02-5.18 5.02-4.69C5.02-4.58 5.01-4.45 5-4.3L5.14-4.28L5.53-5.7Z'/>
<path id='eq112-g13-57' d='M1.24-.24L2.15-3.83L2.12-3.85C1.39-3.72 .92-3.65 .64-3.63V-3.49L.87-3.5H.93C1.18-3.5 1.28-3.42 1.28-3.22C1.28-3.14 1.25-2.95 1.14-2.52L.52 .03C.22 1.23 .02 1.61-.33 1.61C-.44 1.61-.49 1.57-.49 1.51C-.49 1.48-.48 1.46-.45 1.41C-.39 1.35-.38 1.3-.38 1.23C-.38 1.05-.53 .91-.73 .91S-1.08 1.07-1.08 1.28C-1.08 1.59-.79 1.81-.39 1.81C.37 1.81 .89 1.15 1.24-.24ZM2.63-5.14C2.63-5.39 2.43-5.62 2.19-5.62S1.74-5.42 1.74-5.15C1.74-4.87 1.95-4.69 2.2-4.69C2.43-4.69 2.63-4.89 2.63-5.14Z'/>
<path id='eq112-g13-63' d='M4.1-2.76C4.1-3.44 3.72-3.85 3.09-3.85C2.52-3.85 2.1-3.57 1.6-2.86L1.87-3.82C1.87-3.82 1.85-3.85 1.83-3.85H1.82L.47-3.66L.49-3.53C.75-3.53 1.06-3.53 1.06-3.29C1.06-3.19 .75-1.98 .44-.82L-.07 1.14C-.16 1.54-.28 1.64-.66 1.65V1.79H1.14V1.66C.72 1.66 .58 1.59 .58 1.4C.58 1.28 .72 .62 .9-.05C1.12 .06 1.28 .1 1.48 .1C2.75 .1 4.1-1.36 4.1-2.76ZM3.31-2.73C3.31-2.16 3.07-1.43 2.71-.9C2.33-.35 1.9-.07 1.44-.07C1.2-.07 1.02-.2 1.02-.39C1.02-.69 1.33-1.83 1.59-2.48C1.82-3.06 2.31-3.48 2.73-3.48C2.74-3.48 2.76-3.48 2.77-3.48C3.14-3.46 3.31-3.23 3.31-2.73Z'/>
<path id='eq112-g13-67' d='M2.59-3.74H1.89L2.13-4.64C2.14-4.66 2.14-4.67 2.14-4.68C2.14-4.74 2.11-4.77 2.07-4.77C2.02-4.77 1.99-4.76 1.94-4.69C1.11-3.61 .5-3.79 .5-3.51C.5-3.5 .5-3.49 .51-3.46H1.15L.52-1.06C.5-.94 .32-.4 .32-.24C.32-.04 .51 .1 .74 .1C1.14 .1 1.43-.15 1.98-.96L1.87-1.02C1.44-.47 1.3-.33 1.16-.33C1.08-.33 1.03-.4 1.03-.51C1.03-.52 1.03-.52 1.04-.55L1.81-3.46H2.54L2.59-3.74Z'/>
<path id='eq112-g13-150' d='M1.7-.05C1.7-.78 1.2-.89 1-.89C.78-.89 .49-.76 .49-.38C.49-.03 .8 .05 1.03 .05C1.09 .05 1.14 .04 1.16 .03C1.2 .03 1.22 .02 1.24 .02C1.3 .02 1.36 .06 1.36 .14C1.36 .31 1.22 .7 .65 1.07L.72 1.23C.99 1.14 1.7 .57 1.7-.05Z'/>
<path id='eq112-g13-161' d='M5.01-2.16V-2.33L.54-4.44V-3.95L4.18-2.24L.54-.54V-.05L5.01-2.16Z'/>
<use id='eq112-g16-24' xlink:href='#eq112-g13-24' transform='scale(1.36)'/>
<use id='eq112-g16-34' xlink:href='#eq112-g13-34' transform='scale(1.36)'/>
<use id='eq112-g16-41' xlink:href='#eq112-g13-41' transform='scale(1.36)'/>
<use id='eq112-g16-57' xlink:href='#eq112-g13-57' transform='scale(1.36)'/>
<use id='eq112-g16-63' xlink:href='#eq112-g13-63' transform='scale(1.36)'/>
<use id='eq112-g16-67' xlink:href='#eq112-g13-67' transform='scale(1.36)'/>
<use id='eq112-g16-150' xlink:href='#eq112-g13-150' transform='scale(1.36)'/>
<use id='eq112-g16-161' xlink:href='#eq112-g13-161' transform='scale(1.36)'/>
</defs>
<g id='eq112-page1'>
<use x='53.03' y='-12.68' xlink:href='#eq112-g16-34'/>
<use x='64.08' y='-10.89' xlink:href='#eq112-g13-57'/>
<use x='71.16' y='-12.68' xlink:href='#eq112-g1-61'/>
<use x='82.76' y='-30.95' xlink:href='#eq112-g4-205'/>
<use x='93.06' y='-19.92' xlink:href='#eq112-g13-63'/>
<use x='97.97' y='-19.92' xlink:href='#eq112-g7-50'/>
<use x='102.53' y='-19.92' xlink:href='#eq112-g13-41'/>
<use x='110.55' y='-22.58' xlink:href='#eq112-g16-24'/>
<use x='119.67' y='-20.79' xlink:href='#eq112-g13-57'/>
<use x='124.03' y='-22.58' xlink:href='#eq112-g10-185'/>
<use x='129.36' y='-22.58' xlink:href='#eq112-g16-63'/>
<use x='135.82' y='-22.58' xlink:href='#eq112-g10-186'/>
<rect x='82.76' y='-16.09' height='.67' width='57.64'/>
<use x='87.99' y='-12.85' xlink:href='#eq112-g4-205'/>
<use x='98.29' y='-1.82' xlink:href='#eq112-g13-63'/>
<use x='105.32' y='-4.48' xlink:href='#eq112-g16-24'/>
<use x='114.44' y='-2.69' xlink:href='#eq112-g13-57'/>
<use x='118.8' y='-4.48' xlink:href='#eq112-g10-185'/>
<use x='124.13' y='-4.48' xlink:href='#eq112-g16-63'/>
<use x='130.59' y='-4.48' xlink:href='#eq112-g10-186'/>
<use x='144.91' y='-12.68' xlink:href='#eq112-g16-150'/>
<use x='151.59' y='-12.68' xlink:href='#eq112-g16-57'/>
<use x='159.6' y='-12.68' xlink:href='#eq112-g10-50'/>
<use x='169.86' y='-12.68' xlink:href='#eq112-g10-102'/>
<use x='175.08' y='-12.68' xlink:href='#eq112-g23-49'/>
<use x='181.05' y='-12.68' xlink:href='#eq112-g16-150'/>
<use x='186.17' y='-12.68' xlink:href='#eq112-g23-50'/>
<use x='192.44' y='-12.68' xlink:href='#eq112-g10-103'/>
<use x='200.98' y='-12.68' xlink:href='#eq112-g16-150'/>
<use x='229.58' y='-12.68' xlink:href='#eq112-g16-41'/>
<use x='240.7' y='-12.68' xlink:href='#eq112-g1-61'/>
<use x='250.9' y='-12.68' xlink:href='#eq112-g16-24'/>
<use x='258.88' y='-10.89' xlink:href='#eq112-g20-49'/>
<use x='267.33' y='-12.68' xlink:href='#eq112-g16-161'/>
<use x='278.47' y='-12.68' xlink:href='#eq112-g16-67'/>
<use x='282.15' y='-10.89' xlink:href='#eq112-g20-49'/>
<use x='289.69' y='-12.68' xlink:href='#eq112-g10-94'/>
<use x='299.98' y='-12.68' xlink:href='#eq112-g16-24'/>
<use x='307.95' y='-10.89' xlink:href='#eq112-g20-50'/>
<use x='316.4' y='-12.68' xlink:href='#eq112-g16-161'/>
<use x='327.54' y='-12.68' xlink:href='#eq112-g16-67'/>
<use x='331.22' y='-10.89' xlink:href='#eq112-g20-50'/>
</g>
</svg></div>
<p>with <span class="m-math"><svg style="width: 1.175em; height: 1.153em; vertical-align: -0.360em; " viewBox="-.19 -7.93 11.75 11.53">
<title>
\(C_j\)
</title>
<defs>
<path id='eq113-g1-24' d='M5.24-1.14L5.09-1.27C4.31-.49 3.8-.24 3.08-.24C2.11-.24 1.55-.89 1.55-2.03C1.55-3.07 1.97-4.12 2.66-4.83C3.07-5.27 3.62-5.5 4.2-5.5C5-5.5 5.45-5.03 5.54-4.09L5.69-4.06L6.02-5.8H5.83C5.76-5.66 5.68-5.61 5.5-5.61C5.42-5.61 5.33-5.62 5.14-5.67C4.76-5.76 4.41-5.82 4.12-5.82C2.25-5.82 .58-4.07 .58-2.12C.58-.79 1.52 .16 2.86 .16C3.76 .16 4.45-.22 5.24-1.14Z'/>
<path id='eq113-g1-57' d='M1.24-.24L2.15-3.83L2.12-3.85C1.39-3.72 .92-3.65 .64-3.63V-3.49L.87-3.5H.93C1.18-3.5 1.28-3.42 1.28-3.22C1.28-3.14 1.25-2.95 1.14-2.52L.52 .03C.22 1.23 .02 1.61-.33 1.61C-.44 1.61-.49 1.57-.49 1.51C-.49 1.48-.48 1.46-.45 1.41C-.39 1.35-.38 1.3-.38 1.23C-.38 1.05-.53 .91-.73 .91S-1.08 1.07-1.08 1.28C-1.08 1.59-.79 1.81-.39 1.81C.37 1.81 .89 1.15 1.24-.24ZM2.63-5.14C2.63-5.39 2.43-5.62 2.19-5.62S1.74-5.42 1.74-5.15C1.74-4.87 1.95-4.69 2.2-4.69C2.43-4.69 2.63-4.89 2.63-5.14Z'/>
<use id='eq113-g4-24' xlink:href='#eq113-g1-24' transform='scale(1.36)'/>
</defs>
<g id='eq113-page1'>
<use x='-.19' y='0' xlink:href='#eq113-g4-24'/>
<use x='8.93' y='1.79' xlink:href='#eq113-g1-57'/>
</g>
</svg></span> the two input channels.
<span class="m-math"><svg style="width: 0.746em; height: 1.010em; vertical-align: -0.360em; " viewBox="-.05 -6.5 7.46 10.1">
<title>
\(t_j\)
</title>
<defs>
<path id='eq114-g1-57' d='M1.24-.24L2.15-3.83L2.12-3.85C1.39-3.72 .92-3.65 .64-3.63V-3.49L.87-3.5H.93C1.18-3.5 1.28-3.42 1.28-3.22C1.28-3.14 1.25-2.95 1.14-2.52L.52 .03C.22 1.23 .02 1.61-.33 1.61C-.44 1.61-.49 1.57-.49 1.51C-.49 1.48-.48 1.46-.45 1.41C-.39 1.35-.38 1.3-.38 1.23C-.38 1.05-.53 .91-.73 .91S-1.08 1.07-1.08 1.28C-1.08 1.59-.79 1.81-.39 1.81C.37 1.81 .89 1.15 1.24-.24ZM2.63-5.14C2.63-5.39 2.43-5.62 2.19-5.62S1.74-5.42 1.74-5.15C1.74-4.87 1.95-4.69 2.2-4.69C2.43-4.69 2.63-4.89 2.63-5.14Z'/>
<path id='eq114-g1-67' d='M2.59-3.74H1.89L2.13-4.64C2.14-4.66 2.14-4.67 2.14-4.68C2.14-4.74 2.11-4.77 2.07-4.77C2.02-4.77 1.99-4.76 1.94-4.69C1.11-3.61 .5-3.79 .5-3.51C.5-3.5 .5-3.49 .51-3.46H1.15L.52-1.06C.5-.94 .32-.4 .32-.24C.32-.04 .51 .1 .74 .1C1.14 .1 1.43-.15 1.98-.96L1.87-1.02C1.44-.47 1.3-.33 1.16-.33C1.08-.33 1.03-.4 1.03-.51C1.03-.52 1.03-.52 1.04-.55L1.81-3.46H2.54L2.59-3.74Z'/>
<use id='eq114-g4-67' xlink:href='#eq114-g1-67' transform='scale(1.36)'/>
</defs>
<g id='eq114-page1'>
<use x='-.05' y='0' xlink:href='#eq114-g4-67'/>
<use x='4.78' y='1.79' xlink:href='#eq114-g1-57'/>
</g>
</svg></span> are the thresholds for each channel, with <span class="m-math"><svg style="width: 5.535em; height: 0.993em; vertical-align: -0.180em; " viewBox="-.05 -8.13 55.35 9.93">
<title>
\(t_2 = a t_1 + b\)
</title>
<defs>
<path id='eq115-g4-184' d='M2.97-3.41H.36V-2.62H2.97V0H3.75V-2.62H6.36V-3.41H3.75V-6.03H2.97V-3.41Z'/>
<path id='eq115-g1-61' d='M6.57-3.93V-4.6H.48V-3.93H6.57ZM6.57-1.51V-2.18H.48V-1.51H6.57Z'/>
<path id='eq115-g11-49' d='M3.44 0V-.13C2.75-.14 2.61-.23 2.61-.65V-5.89L2.54-5.9L.97-5.11V-4.99C1.07-5.03 1.17-5.07 1.21-5.08C1.36-5.14 1.51-5.18 1.6-5.18C1.78-5.18 1.86-5.05 1.86-4.77V-.81C1.86-.52 1.79-.32 1.65-.24C1.52-.17 1.4-.14 1.03-.13V0H3.44Z'/>
<path id='eq115-g11-50' d='M4.15-1.2L4.04-1.24C3.71-.74 3.6-.66 3.21-.66H1.12L2.59-2.2C3.36-3.01 3.7-3.68 3.7-4.36C3.7-5.23 3-5.9 2.09-5.9C1.61-5.9 1.15-5.71 .83-5.36C.55-5.07 .42-4.79 .27-4.17L.45-4.12C.8-4.98 1.12-5.26 1.72-5.26C2.45-5.26 2.95-4.76 2.95-4.03C2.95-3.35 2.55-2.53 1.82-1.76L.26-.1V0H3.67L4.15-1.2Z'/>
<path id='eq115-g7-48' d='M5.67-1.19L5.53-1.31L5.19-.98C4.82-.6 4.68-.49 4.57-.49C4.48-.49 4.41-.56 4.41-.64C4.41-.88 4.91-2.93 5.47-4.97C5.5-5.09 5.51-5.11 5.54-5.22L5.46-5.25L4.73-5.17L4.69-5.13L4.56-4.56C4.47-5 4.12-5.25 3.61-5.25C2.02-5.25 .2-3.08 .2-1.19C.2-.36 .66 .13 1.42 .13C2.25 .13 2.76-.26 3.81-1.74C3.56-.76 3.54-.67 3.54-.37C3.54-.02 3.68 .12 4.01 .12C4.49 .12 4.78-.11 5.67-1.19ZM4.35-4.26C4.35-3.26 3.74-1.86 2.93-.98C2.64-.66 2.24-.45 1.89-.45C1.46-.45 1.2-.79 1.2-1.33C1.2-1.98 1.62-3.14 2.12-3.89C2.6-4.6 3.13-4.99 3.62-4.99C3.64-4.99 3.66-4.99 3.68-4.99C4.09-4.97 4.35-4.68 4.35-4.26Z'/>
<path id='eq115-g7-49' d='M5.63-3.82C5.63-4.66 5.05-5.25 4.25-5.25C3.42-5.25 2.8-4.76 1.95-3.45L3.19-8.08L3.13-8.13C2.54-8.03 2.11-7.96 1.31-7.86V-7.66C2.01-7.63 2.08-7.6 2.08-7.34C2.08-7.23 2.06-7.1 1.98-6.82L1.92-6.6L1.89-6.52L.27-.55V-.5C.27-.23 1.18 .13 1.86 .13C3.66 .13 5.63-1.94 5.63-3.82ZM4.62-3.64C4.62-2.86 4.03-1.58 3.31-.85C2.87-.39 2.36-.14 1.85-.14C1.48-.14 1.3-.27 1.3-.55C1.3-1.26 1.66-2.41 2.16-3.3C2.68-4.22 3.22-4.67 3.79-4.67C4.31-4.67 4.62-4.28 4.62-3.64Z'/>
<path id='eq115-g7-67' d='M3.53-5.1H2.57L2.91-6.32C2.92-6.35 2.92-6.37 2.92-6.38C2.92-6.47 2.88-6.5 2.82-6.5C2.75-6.5 2.72-6.49 2.64-6.4C1.51-4.92 .68-5.17 .68-4.79C.68-4.78 .68-4.75 .69-4.72H1.57L.71-1.44C.68-1.29 .44-.55 .44-.32C.44-.06 .69 .13 1.01 .13C1.56 .13 1.95-.2 2.7-1.31L2.55-1.39C1.97-.64 1.77-.45 1.58-.45C1.48-.45 1.41-.55 1.41-.69C1.41-.7 1.41-.71 1.42-.75L2.47-4.72H3.47L3.53-5.1Z'/>
</defs>
<g id='eq115-page1'>
<use x='-.05' y='0' xlink:href='#eq115-g7-67'/>
<use x='3.63' y='1.79' xlink:href='#eq115-g11-50'/>
<use x='11.84' y='0' xlink:href='#eq115-g1-61'/>
<use x='22.39' y='0' xlink:href='#eq115-g7-48'/>
<use x='28.76' y='0' xlink:href='#eq115-g7-67'/>
<use x='32.44' y='1.79' xlink:href='#eq115-g11-49'/>
<use x='39.98' y='0' xlink:href='#eq115-g4-184'/>
<use x='49.67' y='0' xlink:href='#eq115-g7-49'/>
</g>
</svg></span>, and
<span class="m-math"><svg style="width: 0.567em; height: 0.538em; vertical-align: -0.013em; " viewBox=".16 -5.25 5.67 5.38">
<title>
\(a\)
</title>
<defs>
<path id='eq116-g1-48' d='M5.67-1.19L5.53-1.31L5.19-.98C4.82-.6 4.68-.49 4.57-.49C4.48-.49 4.41-.56 4.41-.64C4.41-.88 4.91-2.93 5.47-4.97C5.5-5.09 5.51-5.11 5.54-5.22L5.46-5.25L4.73-5.17L4.69-5.13L4.56-4.56C4.47-5 4.12-5.25 3.61-5.25C2.02-5.25 .2-3.08 .2-1.19C.2-.36 .66 .13 1.42 .13C2.25 .13 2.76-.26 3.81-1.74C3.56-.76 3.54-.67 3.54-.37C3.54-.02 3.68 .12 4.01 .12C4.49 .12 4.78-.11 5.67-1.19ZM4.35-4.26C4.35-3.26 3.74-1.86 2.93-.98C2.64-.66 2.24-.45 1.89-.45C1.46-.45 1.2-.79 1.2-1.33C1.2-1.98 1.62-3.14 2.12-3.89C2.6-4.6 3.13-4.99 3.62-4.99C3.64-4.99 3.66-4.99 3.68-4.99C4.09-4.97 4.35-4.68 4.35-4.26Z'/>
</defs>
<g id='eq116-page1'>
<use x='.16' y='0' xlink:href='#eq116-g1-48'/>
</g>
</svg></span> and <span class="m-math"><svg style="width: 0.563em; height: 0.827em; vertical-align: -0.014em; " viewBox=".29 -8.13 5.63 8.27">
<title>
\(b\)
</title>
<defs>
<path id='eq117-g1-49' d='M5.63-3.82C5.63-4.66 5.05-5.25 4.25-5.25C3.42-5.25 2.8-4.76 1.95-3.45L3.19-8.08L3.13-8.13C2.54-8.03 2.11-7.96 1.31-7.86V-7.66C2.01-7.63 2.08-7.6 2.08-7.34C2.08-7.23 2.06-7.1 1.98-6.82L1.92-6.6L1.89-6.52L.27-.55V-.5C.27-.23 1.18 .13 1.86 .13C3.66 .13 5.63-1.94 5.63-3.82ZM4.62-3.64C4.62-2.86 4.03-1.58 3.31-.85C2.87-.39 2.36-.14 1.85-.14C1.48-.14 1.3-.27 1.3-.55C1.3-1.26 1.66-2.41 2.16-3.3C2.68-4.22 3.22-4.67 3.79-4.67C4.31-4.67 4.62-4.28 4.62-3.64Z'/>
</defs>
<g id='eq117-page1'>
<use x='.29' y='0' xlink:href='#eq117-g1-49'/>
</g>
</svg></span> the slope and intercept of the regression line of the two-dimensional histogram. The thresholds
are successively lowered until the pixels that are not in <span class="m-math"><svg style="width: 0.754em; height: 0.778em; vertical-align: -0.000em; " viewBox="-.42 -7.78 7.54 7.78">
<title>
\(T\)
</title>
<defs>
<path id='eq118-g1-41' d='M7.54-7.78H1.2L.7-5.94L.92-5.9C1.51-7.12 1.89-7.36 3.5-7.36C3.59-7.36 3.67-7.36 3.75-7.36L2.04-1.07C1.85-.44 1.56-.25 .77-.19V0H4.23V-.19L3.78-.23C3.29-.26 3.16-.37 3.16-.74C3.16-.88 3.18-1 3.3-1.43L4.95-7.36H5.61C6.47-7.36 6.85-7.06 6.85-6.4C6.85-6.24 6.84-6.06 6.81-5.86L7.02-5.84L7.54-7.78Z'/>
</defs>
<g id='eq118-page1'>
<use x='-.42' y='0' xlink:href='#eq118-g1-41'/>
</g>
</svg></span> exhibit no correlation between the two channels.</p>
<p>The images must be scalar and real-valued. Any negative values in the input images will cause wrong output,
make sure to clamp the input to 0 before calling this function.
If <code>mask</code> is not forged, all input pixels are considered.</p>
<p>To compute Costes&rsquo; Colocalization Coefficients between two channels in a multi-channel image (a tensor image):</p>
<div class="m-code"><pre><span></span><span class="n">CostesColocalizationCoefficients</span><span class="p">(</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">],</span><span class="w"> </span><span class="n">in</span><span class="p">[</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">],</span><span class="w"> </span><span class="n">mask</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
</pre></div>

<aside class="m-note m-default">
<h4>See also</h4>
<p><a href="microscopy.html#dip-MandersColocalizationCoefficients-dip-Image-CL-dip-Image-CL-dip-Image-CL-dip-dfloat--dip-dfloat-"><code>dip::MandersColocalizationCoefficients</code></a></p>
</aside>
<aside class="m-note m-default">
<h4>Literature</h4>
<ul>
<li>S.V. Costes, D. Daelemans, E.H. Cho, Z. Dobbin, G. Pavlakis, and S. Lockett,
  &ldquo;Automatic and Quantitative Measurement of Protein-Protein Colocalization in Live Cells&rdquo;,
  Biophysical Journal 86:3993-4003, 2004.</li>
</ul>
</aside>
          </div></section>
          <section class="m-doc-details" id="dip-CostesSignificanceTest-dip-Image-CL-dip-Image-CL-dip-Image-CL-dip-Random-L-dip-UnsignedArray--dip-uint-"><div>
            <h3>
              <span class="m-doc-wrap-bumper"><a href="pixeltypes.html#dip-dfloat" class="m-doc">dip::dfloat</a>
                </span><span class="m-doc-wrap"><span class="m-doc-wrap-bumper"><a href="#dip-CostesSignificanceTest-dip-Image-CL-dip-Image-CL-dip-Image-CL-dip-Random-L-dip-UnsignedArray--dip-uint-" class="m-doc-self">dip::<wbr />CostesSignificanceTest</a>(</span><span class="m-doc-wrap"><a href="dip-Image.html" class="m-doc">dip::Image</a> const&amp; channel1,
              <a href="dip-Image.html" class="m-doc">dip::Image</a> const&amp; channel2,
              <a href="dip-Image.html" class="m-doc">dip::Image</a> const&amp; mask,
              <a href="dip-Random.html" class="m-doc">dip::Random</a>&amp; random,
              <a href="supporttypes.html#dip-UnsignedArray" class="m-doc">dip::UnsignedArray</a> blockSizes = {3},
              <a href="supporttypes.html#dip-uint" class="m-doc">dip::uint</a> repetitions = 200)</span></span>
            </h3>
            <p>Computes Costes&rsquo; test of significance of true colocalization</p>
<p>This test verifies whether there is colocalization in the image pair by comparing the correlation
between the two channels to that of a randomly shuffled version of the channels. When randomly
shuffling one of the channels, there no longer exists correlation. This test gives a significance
value to colocalization estimates, but does not quantify the amount of colocalization. Use one of
the methods listed below to quantify colocalization.</p>
<p>The algorithm shuffles one of the channels by dividing it into blocks of <code>blockSizes</code> pixels,
and randomly permuting these blocks. This is repeated <code>repetitions</code> times. The correlation
between the shuffled channel and the other channel is computed for each of these repetitions,
and a normal distribution is fitted to the obtained values. From this distribution, we compute
the probability that a correlation not larger than the correlation between the two channels is
obtained randomly. This probability (a P-value) is returned, and can be compared to, for example,
0.95 to determine with a 5% confidence whether there exists true colocalization in the image
pair.</p>
<p><code>blockSizes</code> should be set to the size of the point-spread function or the size of the texture
in the image. An appropriate value can be estimated as the smaller of the widths of the
autocorrelation functions for the two channels. If the block size is too small, the method
will overestimate the significance of the colocalization.</p>
<p>The images must be scalar and real-valued. If <code>mask</code> is not forged, all input pixels are considered.
If <code>mask</code> is forged, only blocks that overlap the masked area by at least 3/4 are used.
However, the full block is used, including the portion that falls outside the mask.</p>
<aside class="m-note m-default">
<h4>See also</h4>
<p><a href="histograms.html#dip-PearsonCorrelation-dip-Histogram-CL"><code>dip::PearsonCorrelation</code></a>, <a href="math_statistics.html#dip-SpearmanRankCorrelation-dip-Image-CL-dip-Image-CL-dip-Image-CL"><code>dip::SpearmanRankCorrelation</code></a>, <a href="microscopy.html#dip-IntensityCorrelationQuotient-dip-Image-CL-dip-Image-CL-dip-Image-CL"><code>dip::IntensityCorrelationQuotient</code></a>, <a href="microscopy.html#dip-MandersColocalizationCoefficients-dip-Image-CL-dip-Image-CL-dip-Image-CL-dip-dfloat--dip-dfloat-"><code>dip::MandersColocalizationCoefficients</code></a>, <a href="microscopy.html#dip-CostesColocalizationCoefficients-dip-Image-CL-dip-Image-CL-dip-Image-CL"><code>dip::CostesColocalizationCoefficients</code></a></p>
</aside>
<aside class="m-note m-default">
<h4>Literature</h4>
<ul>
<li>S.V. Costes, D. Daelemans, E.H. Cho, Z. Dobbin, G. Pavlakis, and S. Lockett,
  &ldquo;Automatic and Quantitative Measurement of Protein-Protein Colocalization in Live Cells&rdquo;,
  Biophysical Journal 86:3993-4003, 2004.</li>
</ul>
</aside>
          </div></section>
          <section class="m-doc-details" id="dip-IncoherentOTF-dip-Image-L-dip-dfloat--dip-dfloat--dip-dfloat--dip-String-CL"><div>
            <h3>
              <span class="m-doc-wrap-bumper">void
                </span><span class="m-doc-wrap"><span class="m-doc-wrap-bumper"><a href="#dip-IncoherentOTF-dip-Image-L-dip-dfloat--dip-dfloat--dip-dfloat--dip-String-CL" class="m-doc-self">dip::<wbr />IncoherentOTF</a>(</span><span class="m-doc-wrap"><a href="dip-Image.html" class="m-doc">dip::Image</a>&amp; out,
              <a href="pixeltypes.html#dip-dfloat" class="m-doc">dip::dfloat</a> defocus = 0,
              <a href="pixeltypes.html#dip-dfloat" class="m-doc">dip::dfloat</a> oversampling = 1,
              <a href="pixeltypes.html#dip-dfloat" class="m-doc">dip::dfloat</a> amplitude = 1,
              <a href="supporttypes.html#dip-String" class="m-doc">dip::String</a> const&amp; method = "Stokseth")</span></span>
            </h3>
            <p>Generates an incoherent OTF (optical transfer function)</p>
<p>This function implements the formulae for a (defocused) incoherent OTF as described by Castleman.</p>
<p>The <code>defocus</code> is defined as the maximum defocus path length error divided by the wave length
(See Castleman for details).
When <code>defocus</code> is unequal to zero, either the Stokseth approximation or the Hopkins approximation
is used, depending on the value of <code>method</code> (which can be either <code>"Stokseth"</code> or <code>"Hopkins"</code>).
The summation over the Bessel functions in the Hopkins formulation is stopped when the change is
smaller than 0.0001 (this is a compile-time constant).</p>
<p><code>oversampling</code> is the oversampling rate. If set to 1, the OTF is sampled at the Nyquist rate. Increase
the value to sample more densely.</p>
<p><code>amplitude</code> is the value of the OTF at the origin, and thus equivalent to the integral over the PSF.</p>
<p><code>out</code> will be scalar and of type <a href="pixeltypes.html#dip-DT_SFLOAT"><code>dip::DT_SFLOAT</code></a>. It should have 1 or 2 dimensions, its sizes will be preserved.
If <code>out</code> has no sizes, a 256x256 image will be generated.</p>
<aside class="m-note m-default">
<h4>Literature</h4>
<ul>
<li>K.R. Castleman, &ldquo;Digital image processing&rdquo;, Second Edition, Prentice Hall, Englewood Cliffs, 1996.</li>
</ul>
</aside>
          </div></section>
          <section class="m-doc-details" id="dip-IncoherentPSF-dip-Image-L-dip-dfloat--dip-dfloat-"><div>
            <h3>
              <span class="m-doc-wrap-bumper">void
                </span><span class="m-doc-wrap"><span class="m-doc-wrap-bumper"><a href="#dip-IncoherentPSF-dip-Image-L-dip-dfloat--dip-dfloat-" class="m-doc-self">dip::<wbr />IncoherentPSF</a>(</span><span class="m-doc-wrap"><a href="dip-Image.html" class="m-doc">dip::Image</a>&amp; out,
              <a href="pixeltypes.html#dip-dfloat" class="m-doc">dip::dfloat</a> oversampling = 1,
              <a href="pixeltypes.html#dip-dfloat" class="m-doc">dip::dfloat</a> amplitude = 1)</span></span>
            </h3>
            <p>Generates an incoherent PSF (point spread function)</p>
<p>This function generates an incoherent in-focus point spread function of a diffraction limited objective.</p>
<p><code>oversampling</code> is the oversampling rate. If set to 1, the OTF is sampled at the Nyquist rate. Increase
the value to sample more densely.</p>
<p><code>amplitude</code> is the integral over the PSF.</p>
<p><code>out</code> will be scalar and of type <a href="pixeltypes.html#dip-DT_SFLOAT"><code>dip::DT_SFLOAT</code></a>. It should have 1 or 2 dimensions, its sizes will be preserved.
For 1D images, the PSF returned is a single line through the middle of a 2D PSF.
If <code>out</code> has no sizes, a square image of size <code>ceil(19*oversampling)</code> will be generated.</p>
<aside class="m-note m-default">
<h4>Literature</h4>
<ul>
<li>K.R. Castleman, &ldquo;Digital image processing&rdquo;, Second Edition, Prentice Hall, Englewood Cliffs, 1996.</li>
</ul>
</aside>
          </div></section>
          <section class="m-doc-details" id="dip-WienerDeconvolution-dip-Image-CL-dip-Image-CL-dip-Image-CL-dip-Image-CL-dip-Image-L-dip-StringSet-CL"><div>
            <h3>
              <span class="m-doc-wrap-bumper">void
                </span><span class="m-doc-wrap"><span class="m-doc-wrap-bumper"><a href="#dip-WienerDeconvolution-dip-Image-CL-dip-Image-CL-dip-Image-CL-dip-Image-CL-dip-Image-L-dip-StringSet-CL" class="m-doc-self">dip::<wbr />WienerDeconvolution</a>(</span><span class="m-doc-wrap"><a href="dip-Image.html" class="m-doc">dip::Image</a> const&amp; in,
              <a href="dip-Image.html" class="m-doc">dip::Image</a> const&amp; psf,
              <a href="dip-Image.html" class="m-doc">dip::Image</a> const&amp; signalPower,
              <a href="dip-Image.html" class="m-doc">dip::Image</a> const&amp; noisePower,
              <a href="dip-Image.html" class="m-doc">dip::Image</a>&amp; out,
              <a href="supporttypes.html#dip-StringSet" class="m-doc">dip::StringSet</a> const&amp; options = {})</span></span>
            </h3>
            <p>Wiener Deconvolution using estimates of signal and noise power</p>
<p>If <span class="m-math"><svg style="width: 0.860em; height: 0.815em; vertical-align: -0.022em; " viewBox="-.02 -7.93 8.6 8.15">
<title>
\(G\)
</title>
<defs>
<path id='eq121-g1-28' d='M8.6-3.61V-3.8H5.43V-3.61L5.78-3.57C6.17-3.54 6.36-3.42 6.36-3.2C6.36-2.94 6.29-2.63 6.05-1.83C5.79-.92 5.73-.77 5.59-.63C5.32-.37 4.87-.23 4.34-.23C2.8-.23 1.93-1.11 1.93-2.67C1.93-4.13 2.51-5.66 3.45-6.65C3.99-7.21 4.73-7.53 5.51-7.53C6.28-7.53 6.92-7.22 7.29-6.68C7.49-6.37 7.58-6.11 7.63-5.57L7.85-5.54L8.43-7.88L8.25-7.93C8.05-7.65 7.85-7.53 7.54-7.53C7.41-7.53 7.29-7.55 7.02-7.65C6.43-7.84 5.91-7.93 5.42-7.93C2.91-7.93 .62-5.55 .62-2.93C.62-2.12 .96-1.29 1.52-.71C2.13-.11 3 .21 4.04 .21C5.09 .21 5.94-.01 6.86-.52L7.44-2.75C7.63-3.42 7.83-3.56 8.6-3.61Z'/>
</defs>
<g id='eq121-page1'>
<use x='-.02' y='0' xlink:href='#eq121-g1-28'/>
</g>
</svg></span> is the Fourier transform of <code>in</code>, <span class="m-math"><svg style="width: 0.923em; height: 0.778em; vertical-align: -0.000em; " viewBox=".22 -7.78 9.23 7.78">
<title>
\(H\)
</title>
<defs>
<path id='eq122-g1-29' d='M7.48 0V-.19C6.71-.27 6.55-.36 6.55-.69C6.55-.79 6.56-.88 6.59-.98L8.16-6.71C8.36-7.4 8.46-7.47 9.14-7.59V-7.78H6.19V-7.59C6.88-7.5 7.03-7.41 7.03-7.07C7.03-6.9 6.98-6.66 6.9-6.34L6.35-4.38H2.95L3.6-6.71C3.78-7.31 4.09-7.54 4.8-7.59V-7.78H1.55V-7.59C2.3-7.52 2.47-7.42 2.47-7.07C2.47-6.9 2.43-6.66 2.33-6.34L.87-1.07C.66-.38 .57-.31-.1-.19V0H2.83V-.19C2.12-.29 1.99-.37 1.99-.71C1.99-.8 2-.89 2.02-.98L2.81-3.88H6.21L5.43-1.07C5.24-.45 5-.27 4.23-.19V0H7.48Z'/>
</defs>
<g id='eq122-page1'>
<use x='.31' y='0' xlink:href='#eq122-g1-29'/>
</g>
</svg></span> is the Fourier transform of <code>psf</code>,
and <span class="m-math"><svg style="width: 0.768em; height: 0.778em; vertical-align: -0.000em; " viewBox=".35 -7.78 7.68 7.78">
<title>
\(F\)
</title>
<defs>
<path id='eq123-g1-27' d='M7.3-5.96L7.68-7.78H1.75V-7.59C2.54-7.52 2.67-7.44 2.67-7.11C2.67-6.92 2.62-6.63 2.54-6.34L1.07-1.07C.86-.36 .77-.29 .1-.19V0H3.1V-.19C2.41-.23 2.19-.36 2.19-.71C2.19-.82 2.22-.96 2.3-1.25L3.04-3.91C3.48-3.88 3.74-3.87 4-3.87C4.47-3.87 4.54-3.86 4.66-3.81C4.82-3.73 4.92-3.56 4.92-3.32C4.92-3.13 4.9-2.99 4.82-2.62L5.03-2.56L5.93-5.35L5.72-5.41C5.18-4.34 5.15-4.32 3.14-4.3L3.93-7.07C4-7.31 4.17-7.38 4.66-7.38C6.67-7.38 7.09-7.23 7.09-6.48C7.09-6.4 7.09-6.35 7.07-6.21C7.06-6.12 7.06-6.07 7.05-5.98L7.3-5.96Z'/>
</defs>
<g id='eq123-page1'>
<use x='.35' y='0' xlink:href='#eq123-g1-27'/>
</g>
</svg></span> is the Fourier transform of <code>out</code>, then this function estimates the <span class="m-math"><svg style="width: 0.768em; height: 0.778em; vertical-align: -0.000em; " viewBox=".35 -7.78 7.68 7.78">
<title>
\(F\)
</title>
<defs>
<path id='eq124-g1-27' d='M7.3-5.96L7.68-7.78H1.75V-7.59C2.54-7.52 2.67-7.44 2.67-7.11C2.67-6.92 2.62-6.63 2.54-6.34L1.07-1.07C.86-.36 .77-.29 .1-.19V0H3.1V-.19C2.41-.23 2.19-.36 2.19-.71C2.19-.82 2.22-.96 2.3-1.25L3.04-3.91C3.48-3.88 3.74-3.87 4-3.87C4.47-3.87 4.54-3.86 4.66-3.81C4.82-3.73 4.92-3.56 4.92-3.32C4.92-3.13 4.9-2.99 4.82-2.62L5.03-2.56L5.93-5.35L5.72-5.41C5.18-4.34 5.15-4.32 3.14-4.3L3.93-7.07C4-7.31 4.17-7.38 4.66-7.38C6.67-7.38 7.09-7.23 7.09-6.48C7.09-6.4 7.09-6.35 7.07-6.21C7.06-6.12 7.06-6.07 7.05-5.98L7.3-5.96Z'/>
</defs>
<g id='eq124-page1'>
<use x='.35' y='0' xlink:href='#eq124-g1-27'/>
</g>
</svg></span> that optimally
(in the least squares sense) satisfies <span class="m-math"><svg style="width: 4.101em; height: 0.815em; vertical-align: -0.022em; " viewBox="-.02 -7.93 41.01 8.15">
<title>
\(G = FH\)
</title>
<defs>
<path id='eq125-g1-61' d='M6.57-3.93V-4.6H.48V-3.93H6.57ZM6.57-1.51V-2.18H.48V-1.51H6.57Z'/>
<path id='eq125-g4-27' d='M7.3-5.96L7.68-7.78H1.75V-7.59C2.54-7.52 2.67-7.44 2.67-7.11C2.67-6.92 2.62-6.63 2.54-6.34L1.07-1.07C.86-.36 .77-.29 .1-.19V0H3.1V-.19C2.41-.23 2.19-.36 2.19-.71C2.19-.82 2.22-.96 2.3-1.25L3.04-3.91C3.48-3.88 3.74-3.87 4-3.87C4.47-3.87 4.54-3.86 4.66-3.81C4.82-3.73 4.92-3.56 4.92-3.32C4.92-3.13 4.9-2.99 4.82-2.62L5.03-2.56L5.93-5.35L5.72-5.41C5.18-4.34 5.15-4.32 3.14-4.3L3.93-7.07C4-7.31 4.17-7.38 4.66-7.38C6.67-7.38 7.09-7.23 7.09-6.48C7.09-6.4 7.09-6.35 7.07-6.21C7.06-6.12 7.06-6.07 7.05-5.98L7.3-5.96Z'/>
<path id='eq125-g4-28' d='M8.6-3.61V-3.8H5.43V-3.61L5.78-3.57C6.17-3.54 6.36-3.42 6.36-3.2C6.36-2.94 6.29-2.63 6.05-1.83C5.79-.92 5.73-.77 5.59-.63C5.32-.37 4.87-.23 4.34-.23C2.8-.23 1.93-1.11 1.93-2.67C1.93-4.13 2.51-5.66 3.45-6.65C3.99-7.21 4.73-7.53 5.51-7.53C6.28-7.53 6.92-7.22 7.29-6.68C7.49-6.37 7.58-6.11 7.63-5.57L7.85-5.54L8.43-7.88L8.25-7.93C8.05-7.65 7.85-7.53 7.54-7.53C7.41-7.53 7.29-7.55 7.02-7.65C6.43-7.84 5.91-7.93 5.42-7.93C2.91-7.93 .62-5.55 .62-2.93C.62-2.12 .96-1.29 1.52-.71C2.13-.11 3 .21 4.04 .21C5.09 .21 5.94-.01 6.86-.52L7.44-2.75C7.63-3.42 7.83-3.56 8.6-3.61Z'/>
<path id='eq125-g4-29' d='M7.48 0V-.19C6.71-.27 6.55-.36 6.55-.69C6.55-.79 6.56-.88 6.59-.98L8.16-6.71C8.36-7.4 8.46-7.47 9.14-7.59V-7.78H6.19V-7.59C6.88-7.5 7.03-7.41 7.03-7.07C7.03-6.9 6.98-6.66 6.9-6.34L6.35-4.38H2.95L3.6-6.71C3.78-7.31 4.09-7.54 4.8-7.59V-7.78H1.55V-7.59C2.3-7.52 2.47-7.42 2.47-7.07C2.47-6.9 2.43-6.66 2.33-6.34L.87-1.07C.66-.38 .57-.31-.1-.19V0H2.83V-.19C2.12-.29 1.99-.37 1.99-.71C1.99-.8 2-.89 2.02-.98L2.81-3.88H6.21L5.43-1.07C5.24-.45 5-.27 4.23-.19V0H7.48Z'/>
</defs>
<g id='eq125-page1'>
<use x='-.02' y='0' xlink:href='#eq125-g4-28'/>
<use x='12.72' y='0' xlink:href='#eq125-g1-61'/>
<use x='23.46' y='0' xlink:href='#eq125-g4-27'/>
<use x='31.86' y='0' xlink:href='#eq125-g4-29'/>
</g>
</svg></span> (that is, <code>in</code> is the result of the convolution of
<code>out</code> with <code>psf</code>).</p>
<p>Finding <code>out</code> requires knowledge of the power spectrum of the signal and the noise. The Wiener deconvolution
filter is defined in the frequency domain as</p>
<div class="m-math"><svg style="width: 9.397em; height: 2.478em; vertical-align: 0.001em; " viewBox="147 -24.79 93.97 24.78">
<title>
\[ H_\text{inv} = \frac{H^* S}{ H^* H S + N } \; , \]
</title>
<defs>
<use id='eq119-g8-184' xlink:href='#eq119-g5-184' transform='scale(1.36)'/>
<path id='eq119-g2-61' d='M6.57-3.93V-4.6H.48V-3.93H6.57ZM6.57-1.51V-2.18H.48V-1.51H6.57Z'/>
<path id='eq119-g0-105' d='M2.22 0V-.13C1.64-.18 1.57-.26 1.57-.89V-4.01L1.53-4.03L.18-3.55V-3.42L.25-3.43C.35-3.45 .46-3.45 .54-3.45C.75-3.45 .83-3.31 .83-2.93V-.89C.83-.26 .75-.17 .14-.13V0H2.22ZM1.65-5.54C1.65-5.79 1.46-5.99 1.2-5.99C.96-5.99 .75-5.79 .75-5.54C.75-5.29 .96-5.09 1.2-5.09C1.46-5.09 1.65-5.29 1.65-5.54Z'/>
<path id='eq119-g0-110' d='M4.25 0V-.13C3.82-.18 3.72-.28 3.72-.71V-2.72C3.72-3.54 3.33-4.03 2.68-4.03C2.28-4.03 2.01-3.88 1.41-3.32V-4.02L1.35-4.03C.92-3.88 .62-3.78 .14-3.64V-3.49C.19-3.52 .28-3.52 .38-3.52C.62-3.52 .7-3.39 .7-2.96V-.79C.7-.29 .6-.17 .16-.13V0H2.02V-.13C1.57-.17 1.44-.27 1.44-.59V-3.05C1.86-3.45 2.05-3.55 2.34-3.55C2.77-3.55 2.98-3.28 2.98-2.7V-.87C2.98-.32 2.87-.17 2.43-.13V0H4.25Z'/>
<path id='eq119-g0-118' d='M4.18-3.81V-3.95H2.96V-3.81C3.24-3.79 3.38-3.7 3.38-3.53C3.38-3.45 3.36-3.36 3.32-3.27L2.45-1L1.56-3.24C1.51-3.37 1.48-3.49 1.48-3.57C1.48-3.73 1.58-3.79 1.88-3.81V-3.95H.17V-3.81C.5-3.8 .56-3.71 .96-2.81L2.02-.29C2.03-.24 2.06-.18 2.09-.11C2.14 .05 2.19 .12 2.24 .12S2.36 .01 2.49-.32L3.61-3.13C3.87-3.73 3.92-3.79 4.18-3.81Z'/>
<path id='eq119-g5-3' d='M3.57-2.92C3.57-3.07 3.45-3.22 3.29-3.22C3.09-3.22 2.38-2.51 2.12-2.36C2.12-2.85 2.37-3.34 2.37-3.63C2.37-3.82 2.24-3.93 2.06-3.93C1.89-3.93 1.78-3.81 1.78-3.63C1.78-3.29 1.99-2.83 1.99-2.36C1.71-2.52 1.03-3.26 .85-3.26C.69-3.26 .55-3.11 .55-2.95C.55-2.65 1.58-2.44 1.92-2.24C1.55-2.04 .87-1.93 .7-1.82C.61-1.76 .54-1.68 .54-1.56C.54-1.41 .66-1.27 .82-1.27C1.02-1.27 1.73-1.97 1.99-2.12C1.99-1.64 1.75-1.15 1.75-.85C1.75-.67 1.88-.55 2.05-.55S2.33-.68 2.33-.85C2.33-1.21 2.13-1.66 2.13-2.12C2.4-1.97 3.09-1.23 3.27-1.23C3.42-1.23 3.56-1.38 3.56-1.54C3.56-1.65 3.49-1.73 3.4-1.78C3.17-1.93 2.57-2.03 2.19-2.24C2.6-2.49 3.16-2.52 3.42-2.67C3.51-2.73 3.57-2.8 3.57-2.92Z'/>
<path id='eq119-g5-184' d='M2.17-2.5H.26V-1.92H2.17V0H2.75V-1.92H4.66V-2.5H2.75V-4.42H2.17V-2.5Z'/>
<path id='eq119-g11-29' d='M7.48 0V-.19C6.71-.27 6.55-.36 6.55-.69C6.55-.79 6.56-.88 6.59-.98L8.16-6.71C8.36-7.4 8.46-7.47 9.14-7.59V-7.78H6.19V-7.59C6.88-7.5 7.03-7.41 7.03-7.07C7.03-6.9 6.98-6.66 6.9-6.34L6.35-4.38H2.95L3.6-6.71C3.78-7.31 4.09-7.54 4.8-7.59V-7.78H1.55V-7.59C2.3-7.52 2.47-7.42 2.47-7.07C2.47-6.9 2.43-6.66 2.33-6.34L.87-1.07C.66-.38 .57-.31-.1-.19V0H2.83V-.19C2.12-.29 1.99-.37 1.99-.71C1.99-.8 2-.89 2.02-.98L2.81-3.88H6.21L5.43-1.07C5.24-.45 5-.27 4.23-.19V0H7.48Z'/>
<path id='eq119-g11-35' d='M8.66-7.59V-7.78H6.29V-7.59C6.97-7.53 7.12-7.41 7.12-6.98C7.12-6.84 7.1-6.71 7.02-6.46L6.99-6.36L5.78-1.83L3.3-7.78H1.38V-7.59C1.94-7.54 2.19-7.38 2.41-6.92L.99-1.95C.54-.43 .44-.29-.24-.19V0H2.12V-.19C1.5-.24 1.29-.37 1.29-.7C1.29-.86 1.32-1.1 1.39-1.35L2.75-6.37L5.49 .18H5.71L7.42-5.81C7.86-7.35 7.91-7.42 8.66-7.59Z'/>
<path id='eq119-g11-40' d='M5.13-2.17C5.13-2.94 4.87-3.39 3.79-4.49C2.7-5.57 2.61-5.74 2.61-6.32C2.61-7.07 3.11-7.54 3.92-7.54C4.36-7.54 4.72-7.4 4.97-7.11C5.24-6.81 5.34-6.41 5.36-5.61L5.57-5.57L6.05-7.94H5.78C5.61-7.69 5.5-7.63 5.24-7.63C5.09-7.63 4.94-7.67 4.69-7.77C4.44-7.87 4.05-7.93 3.68-7.93C2.44-7.93 1.56-7.11 1.56-5.94C1.56-5.3 1.74-4.95 2.45-4.19C2.61-4.04 2.76-3.87 2.92-3.69L3.38-3.19C3.94-2.61 4.1-2.3 4.1-1.79C4.1-.88 3.44-.2 2.56-.2C1.56-.2 .82-1.05 .82-2.22C.82-2.3 .82-2.35 .85-2.45L.61-2.48L.2 .18H.42C.5-.1 .63-.21 .87-.21C1-.21 1.17-.17 1.49-.06C2.04 .14 2.36 .21 2.73 .21C4.1 .21 5.13-.81 5.13-2.17Z'/>
<path id='eq119-g11-150' d='M2.32-.07C2.32-1.06 1.63-1.21 1.36-1.21C1.06-1.21 .67-1.04 .67-.52C.67-.05 1.1 .07 1.41 .07C1.49 .07 1.55 .06 1.58 .05C1.63 .04 1.67 .02 1.69 .02C1.77 .02 1.86 .08 1.86 .19C1.86 .42 1.67 .95 .88 1.45L.99 1.68C1.35 1.56 2.32 .77 2.32-.07Z'/>
</defs>
<g id='eq119-page1'>
<use x='147.09' y='-8.42' xlink:href='#eq119-g11-29'/>
<use x='155.84' y='-6.63' xlink:href='#eq119-g0-105'/>
<use x='158.28' y='-6.63' xlink:href='#eq119-g0-110'/>
<use x='162.4' y='-6.63' xlink:href='#eq119-g0-118'/>
<use x='170.6' y='-8.42' xlink:href='#eq119-g2-61'/>
<use x='198.04' y='-16.52' xlink:href='#eq119-g11-29'/>
<use x='207.34' y='-20.86' xlink:href='#eq119-g5-3'/>
<use x='212.21' y='-16.52' xlink:href='#eq119-g11-40'/>
<rect x='182.2' y='-11.83' height='.67' width='51.93'/>
<use x='182.51' y='-.22' xlink:href='#eq119-g11-29'/>
<use x='191.81' y='-3.68' xlink:href='#eq119-g5-3'/>
<use x='196.75' y='-.22' xlink:href='#eq119-g11-29'/>
<use x='206.29' y='-.22' xlink:href='#eq119-g11-40'/>
<use x='215.33' y='-.22' xlink:href='#eq119-g8-184'/>
<use x='225.18' y='-.22' xlink:href='#eq119-g11-35'/>
<use x='238.64' y='-8.42' xlink:href='#eq119-g11-150'/>
</g>
</svg></div>
<p>where <span class="m-math"><svg style="width: 0.605em; height: 0.816em; vertical-align: -0.022em; " viewBox=".24 -7.94 6.05 8.16">
<title>
\(S\)
</title>
<defs>
<path id='eq126-g1-40' d='M5.13-2.17C5.13-2.94 4.87-3.39 3.79-4.49C2.7-5.57 2.61-5.74 2.61-6.32C2.61-7.07 3.11-7.54 3.92-7.54C4.36-7.54 4.72-7.4 4.97-7.11C5.24-6.81 5.34-6.41 5.36-5.61L5.57-5.57L6.05-7.94H5.78C5.61-7.69 5.5-7.63 5.24-7.63C5.09-7.63 4.94-7.67 4.69-7.77C4.44-7.87 4.05-7.93 3.68-7.93C2.44-7.93 1.56-7.11 1.56-5.94C1.56-5.3 1.74-4.95 2.45-4.19C2.61-4.04 2.76-3.87 2.92-3.69L3.38-3.19C3.94-2.61 4.1-2.3 4.1-1.79C4.1-.88 3.44-.2 2.56-.2C1.56-.2 .82-1.05 .82-2.22C.82-2.3 .82-2.35 .85-2.45L.61-2.48L.2 .18H.42C.5-.1 .63-.21 .87-.21C1-.21 1.17-.17 1.49-.06C2.04 .14 2.36 .21 2.73 .21C4.1 .21 5.13-.81 5.13-2.17Z'/>
</defs>
<g id='eq126-page1'>
<use x='.24' y='0' xlink:href='#eq126-g1-40'/>
</g>
</svg></span> is <code>signalPower</code>, and <span class="m-math"><svg style="width: 0.890em; height: 0.796em; vertical-align: -0.018em; " viewBox=".22 -7.78 8.9 7.96">
<title>
\(N\)
</title>
<defs>
<path id='eq127-g1-35' d='M8.66-7.59V-7.78H6.29V-7.59C6.97-7.53 7.12-7.41 7.12-6.98C7.12-6.84 7.1-6.71 7.02-6.46L6.99-6.36L5.78-1.83L3.3-7.78H1.38V-7.59C1.94-7.54 2.19-7.38 2.41-6.92L.99-1.95C.54-.43 .44-.29-.24-.19V0H2.12V-.19C1.5-.24 1.29-.37 1.29-.7C1.29-.86 1.32-1.1 1.39-1.35L2.75-6.37L5.49 .18H5.71L7.42-5.81C7.86-7.35 7.91-7.42 8.66-7.59Z'/>
</defs>
<g id='eq127-page1'>
<use x='.45' y='0' xlink:href='#eq127-g1-35'/>
</g>
</svg></span> is <code>noisePower</code>. These functions are typically not known, but:</p>
<ul>
<li>
<p><code>signalPower</code> can be estimated as the Fourier transform of the autocorrelation of <code>in</code>. If a raw image
  is passed for this argument (<code>dip::Image{}</code>), then it will be computed as such.</p>
</li>
<li>
<p><code>noisePower</code> can be estimated as a flat function. A 0D image can be given here, it will be expanded to
  the size of the other images. <code>noisePower</code> should not be zero anywhere, as that might lead to division
  by zero and consequently meaningless results.</p>
</li>
</ul>
<p>The other syntax for <a href="microscopy.html#dip-WienerDeconvolution-dip-Image-CL-dip-Image-CL-dip-Image-CL-dip-Image-CL-dip-Image-L-dip-StringSet-CL"><code>dip::WienerDeconvolution</code></a> takes an estimate of the noise-to-signal
ratio instead of the signal and noise power spectra. Note that <span class="m-math"><svg style="width: 1.959em; height: 0.969em; vertical-align: -0.191em; " viewBox=".22 -7.78 19.59 9.69">
<title>
\(H_\text{inv}\)
</title>
<defs>
<path id='eq128-g0-105' d='M2.22 0V-.13C1.64-.18 1.57-.26 1.57-.89V-4.01L1.53-4.03L.18-3.55V-3.42L.25-3.43C.35-3.45 .46-3.45 .54-3.45C.75-3.45 .83-3.31 .83-2.93V-.89C.83-.26 .75-.17 .14-.13V0H2.22ZM1.65-5.54C1.65-5.79 1.46-5.99 1.2-5.99C.96-5.99 .75-5.79 .75-5.54C.75-5.29 .96-5.09 1.2-5.09C1.46-5.09 1.65-5.29 1.65-5.54Z'/>
<path id='eq128-g0-110' d='M4.25 0V-.13C3.82-.18 3.72-.28 3.72-.71V-2.72C3.72-3.54 3.33-4.03 2.68-4.03C2.28-4.03 2.01-3.88 1.41-3.32V-4.02L1.35-4.03C.92-3.88 .62-3.78 .14-3.64V-3.49C.19-3.52 .28-3.52 .38-3.52C.62-3.52 .7-3.39 .7-2.96V-.79C.7-.29 .6-.17 .16-.13V0H2.02V-.13C1.57-.17 1.44-.27 1.44-.59V-3.05C1.86-3.45 2.05-3.55 2.34-3.55C2.77-3.55 2.98-3.28 2.98-2.7V-.87C2.98-.32 2.87-.17 2.43-.13V0H4.25Z'/>
<path id='eq128-g0-118' d='M4.18-3.81V-3.95H2.96V-3.81C3.24-3.79 3.38-3.7 3.38-3.53C3.38-3.45 3.36-3.36 3.32-3.27L2.45-1L1.56-3.24C1.51-3.37 1.48-3.49 1.48-3.57C1.48-3.73 1.58-3.79 1.88-3.81V-3.95H.17V-3.81C.5-3.8 .56-3.71 .96-2.81L2.02-.29C2.03-.24 2.06-.18 2.09-.11C2.14 .05 2.19 .12 2.24 .12S2.36 .01 2.49-.32L3.61-3.13C3.87-3.73 3.92-3.79 4.18-3.81Z'/>
<path id='eq128-g2-29' d='M7.48 0V-.19C6.71-.27 6.55-.36 6.55-.69C6.55-.79 6.56-.88 6.59-.98L8.16-6.71C8.36-7.4 8.46-7.47 9.14-7.59V-7.78H6.19V-7.59C6.88-7.5 7.03-7.41 7.03-7.07C7.03-6.9 6.98-6.66 6.9-6.34L6.35-4.38H2.95L3.6-6.71C3.78-7.31 4.09-7.54 4.8-7.59V-7.78H1.55V-7.59C2.3-7.52 2.47-7.42 2.47-7.07C2.47-6.9 2.43-6.66 2.33-6.34L.87-1.07C.66-.38 .57-.31-.1-.19V0H2.83V-.19C2.12-.29 1.99-.37 1.99-.71C1.99-.8 2-.89 2.02-.98L2.81-3.88H6.21L5.43-1.07C5.24-.45 5-.27 4.23-.19V0H7.48Z'/>
</defs>
<g id='eq128-page1'>
<use x='.31' y='0' xlink:href='#eq128-g2-29'/>
<use x='9.06' y='1.79' xlink:href='#eq128-g0-105'/>
<use x='11.5' y='1.79' xlink:href='#eq128-g0-110'/>
<use x='15.62' y='1.79' xlink:href='#eq128-g0-118'/>
</g>
</svg></span> can be rewritten as</p>
<div class="m-math"><svg style="width: 14.831em; height: 3.036em; vertical-align: -0.000em; " viewBox="119.83 -30.36 148.31 30.36">
<title>
\[ H_\text{inv} = \frac{H^*}{ H^* H  + \frac{N}{S} } = \frac{H^*}{ H^* H  + K } \; , \]
</title>
<defs>
<use id='eq120-g14-29' xlink:href='#eq120-g11-29' transform='scale(1.36)'/>
<use id='eq120-g14-32' xlink:href='#eq120-g11-32' transform='scale(1.36)'/>
<use id='eq120-g14-150' xlink:href='#eq120-g11-150' transform='scale(1.36)'/>
<use id='eq120-g8-184' xlink:href='#eq120-g5-184' transform='scale(1.36)'/>
<path id='eq120-g5-3' d='M3.57-2.92C3.57-3.07 3.45-3.22 3.29-3.22C3.09-3.22 2.38-2.51 2.12-2.36C2.12-2.85 2.37-3.34 2.37-3.63C2.37-3.82 2.24-3.93 2.06-3.93C1.89-3.93 1.78-3.81 1.78-3.63C1.78-3.29 1.99-2.83 1.99-2.36C1.71-2.52 1.03-3.26 .85-3.26C.69-3.26 .55-3.11 .55-2.95C.55-2.65 1.58-2.44 1.92-2.24C1.55-2.04 .87-1.93 .7-1.82C.61-1.76 .54-1.68 .54-1.56C.54-1.41 .66-1.27 .82-1.27C1.02-1.27 1.73-1.97 1.99-2.12C1.99-1.64 1.75-1.15 1.75-.85C1.75-.67 1.88-.55 2.05-.55S2.33-.68 2.33-.85C2.33-1.21 2.13-1.66 2.13-2.12C2.4-1.97 3.09-1.23 3.27-1.23C3.42-1.23 3.56-1.38 3.56-1.54C3.56-1.65 3.49-1.73 3.4-1.78C3.17-1.93 2.57-2.03 2.19-2.24C2.6-2.49 3.16-2.52 3.42-2.67C3.51-2.73 3.57-2.8 3.57-2.92Z'/>
<path id='eq120-g5-184' d='M2.17-2.5H.26V-1.92H2.17V0H2.75V-1.92H4.66V-2.5H2.75V-4.42H2.17V-2.5Z'/>
<path id='eq120-g11-29' d='M5.49 0V-.14C4.92-.2 4.8-.26 4.8-.51C4.8-.58 4.81-.65 4.83-.72L5.98-4.92C6.13-5.42 6.2-5.48 6.7-5.56V-5.7H4.54V-5.56C5.05-5.5 5.15-5.43 5.15-5.19C5.15-5.06 5.12-4.88 5.06-4.65L4.66-3.21H2.17L2.64-4.92C2.77-5.36 3-5.53 3.52-5.56V-5.7H1.14V-5.56C1.69-5.51 1.81-5.44 1.81-5.19C1.81-5.06 1.78-4.88 1.71-4.65L.64-.79C.48-.28 .42-.23-.07-.14V0H2.08V-.14C1.55-.21 1.46-.27 1.46-.52C1.46-.59 1.47-.66 1.48-.72L2.06-2.85H4.55L3.98-.79C3.84-.33 3.67-.2 3.1-.14V0H5.49Z'/>
<path id='eq120-g11-32' d='M5.4 0V-.14C4.85-.19 4.8-.22 4.55-.63L3.03-3.28L5.65-5.25C5.9-5.43 6.1-5.53 6.31-5.56V-5.7H4.37V-5.56L4.6-5.54C4.81-5.52 4.9-5.47 4.9-5.37C4.9-5.16 4.42-4.7 3.64-4.15L2.31-3.22L2.78-4.92C2.91-5.35 3.14-5.53 3.66-5.56V-5.7H1.28V-5.56C1.83-5.51 1.95-5.44 1.95-5.19C1.95-5.06 1.92-4.88 1.85-4.65L.78-.79C.62-.26 .58-.22 .06-.14V0H2.23V-.14C1.68-.2 1.6-.25 1.6-.52C1.6-.62 1.61-.68 1.67-.86L1.72-1.05L2.26-3.04L3.32-1.22C3.53-.86 3.65-.56 3.65-.39C3.65-.26 3.53-.19 3.25-.17L3-.14V0H5.4Z'/>
<path id='eq120-g11-35' d='M6.35-5.56V-5.7H4.61V-5.56C5.11-5.52 5.22-5.43 5.22-5.12C5.22-5.01 5.21-4.92 5.14-4.73L5.13-4.66L4.24-1.35L2.42-5.7H1.01V-5.56C1.42-5.53 1.61-5.42 1.76-5.07L.72-1.43C.39-.31 .32-.21-.17-.14V0H1.55V-.14C1.1-.17 .94-.27 .94-.52C.94-.63 .97-.8 1.02-.99L2.02-4.67L4.03 .13H4.18L5.44-4.26C5.76-5.39 5.8-5.44 6.35-5.56Z'/>
<path id='eq120-g11-40' d='M3.76-1.59C3.76-2.16 3.57-2.49 2.78-3.29C1.98-4.09 1.91-4.21 1.91-4.64C1.91-5.19 2.28-5.53 2.87-5.53C3.2-5.53 3.46-5.42 3.64-5.21C3.84-5 3.91-4.7 3.93-4.11L4.09-4.09L4.44-5.83H4.24C4.11-5.64 4.04-5.6 3.84-5.6C3.73-5.6 3.62-5.62 3.44-5.69C3.26-5.77 2.97-5.82 2.7-5.82C1.79-5.82 1.14-5.21 1.14-4.36C1.14-3.89 1.28-3.63 1.8-3.07C1.91-2.96 2.03-2.84 2.14-2.71L2.48-2.34C2.89-1.91 3-1.69 3-1.31C3-.65 2.52-.15 1.88-.15C1.14-.15 .6-.77 .6-1.62C.6-1.69 .6-1.72 .62-1.8L.45-1.82L.15 .13H.31C.37-.07 .46-.16 .64-.16C.73-.16 .86-.12 1.09-.04C1.49 .1 1.73 .16 2 .16C3 .16 3.76-.59 3.76-1.59Z'/>
<path id='eq120-g11-150' d='M1.7-.05C1.7-.78 1.2-.89 1-.89C.78-.89 .49-.76 .49-.38C.49-.03 .8 .05 1.03 .05C1.09 .05 1.14 .04 1.16 .03C1.2 .03 1.22 .02 1.24 .02C1.3 .02 1.36 .06 1.36 .14C1.36 .31 1.22 .7 .65 1.07L.72 1.23C.99 1.14 1.7 .57 1.7-.05Z'/>
<path id='eq120-g2-61' d='M6.57-3.93V-4.6H.48V-3.93H6.57ZM6.57-1.51V-2.18H.48V-1.51H6.57Z'/>
<path id='eq120-g0-105' d='M2.22 0V-.13C1.64-.18 1.57-.26 1.57-.89V-4.01L1.53-4.03L.18-3.55V-3.42L.25-3.43C.35-3.45 .46-3.45 .54-3.45C.75-3.45 .83-3.31 .83-2.93V-.89C.83-.26 .75-.17 .14-.13V0H2.22ZM1.65-5.54C1.65-5.79 1.46-5.99 1.2-5.99C.96-5.99 .75-5.79 .75-5.54C.75-5.29 .96-5.09 1.2-5.09C1.46-5.09 1.65-5.29 1.65-5.54Z'/>
<path id='eq120-g0-110' d='M4.25 0V-.13C3.82-.18 3.72-.28 3.72-.71V-2.72C3.72-3.54 3.33-4.03 2.68-4.03C2.28-4.03 2.01-3.88 1.41-3.32V-4.02L1.35-4.03C.92-3.88 .62-3.78 .14-3.64V-3.49C.19-3.52 .28-3.52 .38-3.52C.62-3.52 .7-3.39 .7-2.96V-.79C.7-.29 .6-.17 .16-.13V0H2.02V-.13C1.57-.17 1.44-.27 1.44-.59V-3.05C1.86-3.45 2.05-3.55 2.34-3.55C2.77-3.55 2.98-3.28 2.98-2.7V-.87C2.98-.32 2.87-.17 2.43-.13V0H4.25Z'/>
<path id='eq120-g0-118' d='M4.18-3.81V-3.95H2.96V-3.81C3.24-3.79 3.38-3.7 3.38-3.53C3.38-3.45 3.36-3.36 3.32-3.27L2.45-1L1.56-3.24C1.51-3.37 1.48-3.49 1.48-3.57C1.48-3.73 1.58-3.79 1.88-3.81V-3.95H.17V-3.81C.5-3.8 .56-3.71 .96-2.81L2.02-.29C2.03-.24 2.06-.18 2.09-.11C2.14 .05 2.19 .12 2.24 .12S2.36 .01 2.49-.32L3.61-3.13C3.87-3.73 3.92-3.79 4.18-3.81Z'/>
</defs>
<g id='eq120-page1'>
<use x='119.92' y='-14' xlink:href='#eq120-g14-29'/>
<use x='128.67' y='-12.2' xlink:href='#eq120-g0-105'/>
<use x='131.11' y='-12.2' xlink:href='#eq120-g0-110'/>
<use x='135.23' y='-12.2' xlink:href='#eq120-g0-118'/>
<use x='143.43' y='-14' xlink:href='#eq120-g2-61'/>
<use x='170.81' y='-22.09' xlink:href='#eq120-g14-29'/>
<use x='180.11' y='-26.43' xlink:href='#eq120-g5-3'/>
<rect x='155.03' y='-17.4' height='.67' width='45.19'/>
<use x='155.34' y='-4.29' xlink:href='#eq120-g14-29'/>
<use x='164.64' y='-7.74' xlink:href='#eq120-g5-3'/>
<use x='169.58' y='-4.29' xlink:href='#eq120-g14-29'/>
<use x='181.53' y='-4.29' xlink:href='#eq120-g8-184'/>
<use x='192.46' y='-9' xlink:href='#eq120-g11-35'/>
<rect x='192.13' y='-7.69' height='.67' width='6.89'/>
<use x='193.32' y='-.16' xlink:href='#eq120-g11-40'/>
<use x='204.73' y='-14' xlink:href='#eq120-g2-61'/>
<use x='232' y='-22.09' xlink:href='#eq120-g14-29'/>
<use x='241.3' y='-26.43' xlink:href='#eq120-g5-3'/>
<rect x='216.33' y='-17.4' height='.67' width='44.97'/>
<use x='216.64' y='-5.8' xlink:href='#eq120-g14-29'/>
<use x='225.94' y='-9.25' xlink:href='#eq120-g5-3'/>
<use x='230.88' y='-5.8' xlink:href='#eq120-g14-29'/>
<use x='242.83' y='-5.8' xlink:href='#eq120-g8-184'/>
<use x='252.41' y='-5.8' xlink:href='#eq120-g14-32'/>
<use x='265.81' y='-14' xlink:href='#eq120-g14-150'/>
</g>
</svg></div>
<p>where <span class="m-math"><svg style="width: 0.860em; height: 0.778em; vertical-align: -0.000em; " viewBox=".18 -7.78 8.6 7.78">
<title>
\(K\)
</title>
<defs>
<path id='eq129-g1-32' d='M7.36 0V-.19C6.61-.26 6.54-.3 6.21-.86L4.13-4.47L7.71-7.16C8.05-7.41 8.31-7.54 8.6-7.59V-7.78H5.96V-7.59L6.28-7.55C6.56-7.53 6.68-7.46 6.68-7.32C6.68-7.04 6.03-6.41 4.97-5.66L3.16-4.39L3.79-6.71C3.97-7.3 4.29-7.54 4.99-7.59V-7.78H1.74V-7.59C2.49-7.52 2.66-7.42 2.66-7.07C2.66-6.9 2.62-6.66 2.53-6.34L1.06-1.07C.85-.36 .79-.3 .08-.19V0H3.04V-.19C2.29-.27 2.18-.35 2.18-.71C2.18-.85 2.19-.93 2.27-1.18L2.35-1.43L3.08-4.14L4.53-1.67C4.81-1.18 4.98-.76 4.98-.54C4.98-.36 4.81-.26 4.43-.23L4.09-.19V0H7.36Z'/>
</defs>
<g id='eq129-page1'>
<use x='.18' y='0' xlink:href='#eq129-g1-32'/>
</g>
</svg></span> is the noise-to-signal ratio.</p>
<p><code>psf</code> is given in the spatial domain, and will be zero-padded to the size of <code>in</code> and Fourier transformed.
The PSF (point spread function) should sum to one in order to preserve the mean image intensity.
If the OTF (optical transfer function, the Fourier transform of the PSF) is known, it is possible to pass
that as <code>psf</code>; add the string <code>"OTF"</code> to <code>options</code>.</p>
<p>All input images must be real-valued and scalar, except if the OFT is given instead of the PSF, in which
case <code>psf</code> could be complex-valued.</p>
          </div></section>
          <section class="m-doc-details" id="dip-WienerDeconvolution-dip-Image-CL-dip-Image-CL-dip-Image-L-dip-dfloat--dip-StringSet-CL"><div>
            <h3>
              <span class="m-doc-wrap-bumper">void
                </span><span class="m-doc-wrap"><span class="m-doc-wrap-bumper"><a href="#dip-WienerDeconvolution-dip-Image-CL-dip-Image-CL-dip-Image-L-dip-dfloat--dip-StringSet-CL" class="m-doc-self">dip::<wbr />WienerDeconvolution</a>(</span><span class="m-doc-wrap"><a href="dip-Image.html" class="m-doc">dip::Image</a> const&amp; in,
              <a href="dip-Image.html" class="m-doc">dip::Image</a> const&amp; psf,
              <a href="dip-Image.html" class="m-doc">dip::Image</a>&amp; out,
              <a href="pixeltypes.html#dip-dfloat" class="m-doc">dip::dfloat</a> regularization = 1e-4,
              <a href="supporttypes.html#dip-StringSet" class="m-doc">dip::StringSet</a> const&amp; options = {})</span></span>
            </h3>
            <p>Wiener Deconvolution using an estimate of noise-to-signal ratio</p>
<p>See the description of the function with the same name above. The difference here is that a single number,
<code>regularization</code>, is given instead of the signal and noise power spectra. We then set <span class="m-math"><svg style="width: 0.860em; height: 0.778em; vertical-align: -0.000em; " viewBox=".18 -7.78 8.6 7.78">
<title>
\(K\)
</title>
<defs>
<path id='eq130-g1-32' d='M7.36 0V-.19C6.61-.26 6.54-.3 6.21-.86L4.13-4.47L7.71-7.16C8.05-7.41 8.31-7.54 8.6-7.59V-7.78H5.96V-7.59L6.28-7.55C6.56-7.53 6.68-7.46 6.68-7.32C6.68-7.04 6.03-6.41 4.97-5.66L3.16-4.39L3.79-6.71C3.97-7.3 4.29-7.54 4.99-7.59V-7.78H1.74V-7.59C2.49-7.52 2.66-7.42 2.66-7.07C2.66-6.9 2.62-6.66 2.53-6.34L1.06-1.07C.85-.36 .79-.3 .08-.19V0H3.04V-.19C2.29-.27 2.18-.35 2.18-.71C2.18-.85 2.19-.93 2.27-1.18L2.35-1.43L3.08-4.14L4.53-1.67C4.81-1.18 4.98-.76 4.98-.54C4.98-.36 4.81-.26 4.43-.23L4.09-.19V0H7.36Z'/>
</defs>
<g id='eq130-page1'>
<use x='.18' y='0' xlink:href='#eq130-g1-32'/>
</g>
</svg></span> (the
noise-to-signal ratio) to <code>regularization * dip::Maximum(P)</code>, with <code>P</code> equal to <span class="m-math"><svg style="width: 2.347em; height: 0.827em; vertical-align: -0.000em; " viewBox=".22 -8.27 23.47 8.27">
<title>
\(H^* H\)
</title>
<defs>
<path id='eq131-g1-3' d='M3.57-2.92C3.57-3.07 3.45-3.22 3.29-3.22C3.09-3.22 2.38-2.51 2.12-2.36C2.12-2.85 2.37-3.34 2.37-3.63C2.37-3.82 2.24-3.93 2.06-3.93C1.89-3.93 1.78-3.81 1.78-3.63C1.78-3.29 1.99-2.83 1.99-2.36C1.71-2.52 1.03-3.26 .85-3.26C.69-3.26 .55-3.11 .55-2.95C.55-2.65 1.58-2.44 1.92-2.24C1.55-2.04 .87-1.93 .7-1.82C.61-1.76 .54-1.68 .54-1.56C.54-1.41 .66-1.27 .82-1.27C1.02-1.27 1.73-1.97 1.99-2.12C1.99-1.64 1.75-1.15 1.75-.85C1.75-.67 1.88-.55 2.05-.55S2.33-.68 2.33-.85C2.33-1.21 2.13-1.66 2.13-2.12C2.4-1.97 3.09-1.23 3.27-1.23C3.42-1.23 3.56-1.38 3.56-1.54C3.56-1.65 3.49-1.73 3.4-1.78C3.17-1.93 2.57-2.03 2.19-2.24C2.6-2.49 3.16-2.52 3.42-2.67C3.51-2.73 3.57-2.8 3.57-2.92Z'/>
<path id='eq131-g4-29' d='M7.48 0V-.19C6.71-.27 6.55-.36 6.55-.69C6.55-.79 6.56-.88 6.59-.98L8.16-6.71C8.36-7.4 8.46-7.47 9.14-7.59V-7.78H6.19V-7.59C6.88-7.5 7.03-7.41 7.03-7.07C7.03-6.9 6.98-6.66 6.9-6.34L6.35-4.38H2.95L3.6-6.71C3.78-7.31 4.09-7.54 4.8-7.59V-7.78H1.55V-7.59C2.3-7.52 2.47-7.42 2.47-7.07C2.47-6.9 2.43-6.66 2.33-6.34L.87-1.07C.66-.38 .57-.31-.1-.19V0H2.83V-.19C2.12-.29 1.99-.37 1.99-.71C1.99-.8 2-.89 2.02-.98L2.81-3.88H6.21L5.43-1.07C5.24-.45 5-.27 4.23-.19V0H7.48Z'/>
</defs>
<g id='eq131-page1'>
<use x='.31' y='0' xlink:href='#eq131-g4-29'/>
<use x='9.61' y='-4.34' xlink:href='#eq131-g1-3'/>
<use x='14.55' y='0' xlink:href='#eq131-g4-29'/>
</g>
</svg></span>.</p>
          </div></section>
          <section class="m-doc-details" id="dip-ExponentialFitCorrection-dip-Image-CL-dip-Image-CL-dip-Image-L-dip-dfloat--dip-String-CL-dip-dfloat--dip-String-CL"><div>
            <h3>
              <span class="m-doc-wrap-bumper">void
                </span><span class="m-doc-wrap"><span class="m-doc-wrap-bumper"><a href="#dip-ExponentialFitCorrection-dip-Image-CL-dip-Image-CL-dip-Image-L-dip-dfloat--dip-String-CL-dip-dfloat--dip-String-CL" class="m-doc-self">dip::<wbr />ExponentialFitCorrection</a>(</span><span class="m-doc-wrap"><a href="dip-Image.html" class="m-doc">dip::Image</a> const&amp; in,
              <a href="dip-Image.html" class="m-doc">dip::Image</a> const&amp; mask,
              <a href="dip-Image.html" class="m-doc">dip::Image</a>&amp; out,
              <a href="pixeltypes.html#dip-dfloat" class="m-doc">dip::dfloat</a> percentile = -1.0,
              <a href="supporttypes.html#dip-String" class="m-doc">dip::String</a> const&amp; fromWhere = "first plane",
              <a href="pixeltypes.html#dip-dfloat" class="m-doc">dip::dfloat</a> hysteresis = 1.0,
              <a href="supporttypes.html#dip-String" class="m-doc">dip::String</a> const&amp; weighting = "none")</span></span>
            </h3>
            <p>3D fluorescence attenuation correction using an exponential fit</p>
<p>This routine implements a simple correction of absorption, reflection and bleaching in 3D fluorescence
imaging based upon the assumption that the sum of these effects result in a exponential extinction of
the signal as a function of depth. Only pixels within <code>mask</code>, if given, are taken into account to determine
this attenuation, but the whole image is corrected.</p>
<p>The attenuation is estimated based on the mean of the non-masked pixels as a function of depth. If
<code>percentile</code> is in the valid range [0, 100], the corresponding percentile is used instead of the mean.
An exponential function is fitted to these values. The starting point of the fit is determined by <code>fromWhere</code>,
which can be <code>"first plane"</code>, <code>"first max"</code>, or <code>"global max"</code>. In the case of <code>"first max"</code>, the first maximum
is found with <code>point[z+1] &gt; hysteresis * point[z]</code>.</p>
<p>If the mean variant is chosen, one can choose to apply a variance weighting to the fit by setting <code>weighting</code>
to <code>"variance"</code>.</p>
<p><code>in</code> must be a 3D, scalar and real-valued image. For images with fewer than 3 dimensions, the input is returned
unchanged.</p>
<aside class="m-note m-default">
<h4>Literature</h4>
<ul>
<li>K.C. Strasters, H.T.M. van der Voort, J.M. Geusebroek, and A.W.M. Smeulders,
  &ldquo;Fast attenuation correction in fluorescence confocal imaging: a recursive approach&rdquo;, BioImaging 2(2):78-92, 1994.</li>
</ul>
</aside>
          </div></section>
          <section class="m-doc-details" id="dip-AttenuationCorrection-dip-Image-CL-dip-Image-L-dip-dfloat--dip-dfloat--dip-dfloat--dip-dfloat--dip-dfloat--dip-dfloat--dip-String-CL"><div>
            <h3>
              <span class="m-doc-wrap-bumper">void
                </span><span class="m-doc-wrap"><span class="m-doc-wrap-bumper"><a href="#dip-AttenuationCorrection-dip-Image-CL-dip-Image-L-dip-dfloat--dip-dfloat--dip-dfloat--dip-dfloat--dip-dfloat--dip-dfloat--dip-String-CL" class="m-doc-self">dip::<wbr />AttenuationCorrection</a>(</span><span class="m-doc-wrap"><a href="dip-Image.html" class="m-doc">dip::Image</a> const&amp; in,
              <a href="dip-Image.html" class="m-doc">dip::Image</a>&amp; out,
              <a href="pixeltypes.html#dip-dfloat" class="m-doc">dip::dfloat</a> fAttenuation = 0.01,
              <a href="pixeltypes.html#dip-dfloat" class="m-doc">dip::dfloat</a> bAttenuation = 0.01,
              <a href="pixeltypes.html#dip-dfloat" class="m-doc">dip::dfloat</a> background = 0.0,
              <a href="pixeltypes.html#dip-dfloat" class="m-doc">dip::dfloat</a> threshold = 0.0,
              <a href="pixeltypes.html#dip-dfloat" class="m-doc">dip::dfloat</a> NA = 1.4,
              <a href="pixeltypes.html#dip-dfloat" class="m-doc">dip::dfloat</a> refIndex = 1.518,
              <a href="supporttypes.html#dip-String" class="m-doc">dip::String</a> const&amp; method = "DET")</span></span>
            </h3>
            <p>3D fluorescence attenuation correction using one of three iterative algorithms</p>
<p>This function implements an attenuation correction using three different recursive attenuation correction
algorithms. The method is selected with the <code>method</code> parameter, which must be one of <code>"DET"</code>, <code>"LT2"</code> or <code>"LT1"</code>.
DET stands for Directional Extinction Tracking. LT2 is the Two Light Cone convolutions method, and LT1 is the
One Light Cone convolution.</p>
<p>The DET algorithm is the most accurate one, since it takes both forward and backward attenuation
into account (specified through the <code>fAttenuation</code> and <code>bAttenuation</code> parameters). It is however considerably
slower that the LT2 and LT1 algorithms, which take only forward attenuation into account (<code>fAttenuation</code>).
These last two algorithms assume a constant attenuation (<code>background</code>) for pixels with an intensity lower
than the <code>threshold</code>.</p>
<p>The system is characterized by parameters <code>NA</code> (numerical aperture) and <code>refIndex</code> (refractive index of the
medium), as well as the pixel size information in <code>in</code> (the x and y pixel size must be the same, the z size
must be have the same units, but can be different).</p>
<p><code>in</code> must be a 3D, scalar and real-valued image. For images with fewer than 3 dimensions, the input is returned
unchanged.</p>
<aside class="m-note m-default">
<h4>Literature</h4>
<ul>
<li>K.C. Strasters, H.T.M. van der Voort, J.M. Geusebroek, and A.W.M. Smeulders,
  &ldquo;Fast attenuation correction in fluorescence confocal imaging: a recursive approach&rdquo;, BioImaging 2(2):78-92, 1994.</li>
</ul>
</aside>
          </div></section>
          <section class="m-doc-details" id="dip-SimulatedAttenuation-dip-Image-CL-dip-Image-L-dip-dfloat--dip-dfloat--dip-dfloat--dip-dfloat--dip-uint--dip-dfloat-"><div>
            <h3>
              <span class="m-doc-wrap-bumper">void
                </span><span class="m-doc-wrap"><span class="m-doc-wrap-bumper"><a href="#dip-SimulatedAttenuation-dip-Image-CL-dip-Image-L-dip-dfloat--dip-dfloat--dip-dfloat--dip-dfloat--dip-uint--dip-dfloat-" class="m-doc-self">dip::<wbr />SimulatedAttenuation</a>(</span><span class="m-doc-wrap"><a href="dip-Image.html" class="m-doc">dip::Image</a> const&amp; in,
              <a href="dip-Image.html" class="m-doc">dip::Image</a>&amp; out,
              <a href="pixeltypes.html#dip-dfloat" class="m-doc">dip::dfloat</a> fAttenuation = 0.01,
              <a href="pixeltypes.html#dip-dfloat" class="m-doc">dip::dfloat</a> bAttenuation = 0.01,
              <a href="pixeltypes.html#dip-dfloat" class="m-doc">dip::dfloat</a> NA = 1.4,
              <a href="pixeltypes.html#dip-dfloat" class="m-doc">dip::dfloat</a> refIndex = 1.518,
              <a href="supporttypes.html#dip-uint" class="m-doc">dip::uint</a> oversample = 1,
              <a href="pixeltypes.html#dip-dfloat" class="m-doc">dip::dfloat</a> rayStep = 1)</span></span>
            </h3>
            <p>3D fluorescence attenuation simulation</p>
<p>Simulates an attenuation based on the model of a CSLM, using a ray tracing method.</p>
<aside class="m-note m-warning">
<h4>Warning</h4>
<p>This function is extremely slow, and its running time grows exponentially with the number of slices.</p>
</aside>
<p>The system is characterized by parameters <code>NA</code> (numerical aperture) and <code>refIndex</code> (refractive index of the
medium), as well as the pixel size information in <code>in</code> (the x and y pixel size must be the same, the z size
must be have the same units, but can be different).</p>
<p><code>fAttenuation</code> and <code>bAttenuation</code> are the forward and backward attenuation factors, respectively.</p>
<p>The ray tracing method uses a step size of <code>rayStep</code>, and a ray casting oversampling of <code>oversample</code>.</p>
<p><code>in</code> must be a 3D, scalar and real-valued image. For images with fewer than 3 dimensions, the input is returned
unchanged.</p>
<aside class="m-note m-default">
<h4>Literature</h4>
<ul>
<li>K.C. Strasters, H.T.M. van der Voort, J.M. Geusebroek, and A.W.M. Smeulders,
  &ldquo;Fast attenuation correction in fluorescence confocal imaging: a recursive approach&rdquo;, BioImaging 2(2):78-92, 1994.</li>
</ul>
</aside>
          </div></section>
        </section>
      </div>
    </div>
  </div>
</article></main>
<div class="m-doc-search" id="search">
  <a href="#!" onclick="return hideSearch()"></a>
  <div class="m-container">
    <div class="m-row">
      <div class="m-col-m-8 m-push-m-2">
        <div class="m-doc-search-header m-text m-small">
          <div><span class="m-label m-default">Tab</span> / <span class="m-label m-default">T</span> to search, <span class="m-label m-default">Esc</span> to close</div>
          <div id="search-symbolcount">&hellip;</div>
        </div>
        <div class="m-doc-search-content">
          <form action="https://diplib.org/diplib-docs/#search">
            <input type="search" name="q" id="search-input" placeholder="Loading &hellip;" disabled="disabled" autofocus="autofocus" autocomplete="off" spellcheck="false" />
          </form>
          <noscript class="m-text m-danger m-text-center">Unlike everything else in the docs, the search functionality <em>requires</em> JavaScript. Enable it or <a href="https://google.com/search?q=site:diplib.org+">use an external search engine</a>.</noscript>
          <div id="search-help" class="m-text m-dim m-text-center">
            <p class="m-noindent">Search for symbols, directories, files, pages or modules.
              You can omit any prefix from the symbol or file path; adding a <code>:</code> or
              <code>/</code> suffix lists all members of given symbol or directory.</p>
            <p class="m-noindent">Use <span class="m-label m-dim">&darr;</span> / <span class="m-label m-dim">&uarr;</span> to navigate through the list,
              <span class="m-label m-dim">Enter</span> to go.
              <span class="m-label m-dim">Tab</span> autocompletes common prefix.
              You can copy a link to the result using <span class="m-label m-dim">⌘</span> <span class="m-label m-dim">L</span>,
              or <span class="m-label m-dim">⌘</span> <span class="m-label m-dim">M</span> to copy a Markdown link.</p>
          </div>
          <div id="search-notfound" class="m-text m-warning m-text-center">Sorry, nothing was found.<br />Maybe try a full-text <a href="#" id="search-external" data-search-engine="https://google.com/search?q=site:diplib.org+{query}">search with external engine</a>?</div>
          <ul id="search-results"></ul>
        </div>
      </div>
    </div>
  </div>
</div>
<script src="search-v1.js"></script>
<script src="searchdata-v1.js" async="async"></script>
<footer><nav>
  <div class="m-container">
    <div class="m-row">
      <div class="m-col-l-10 m-push-l-1">
        <p>DIPlib, a library for quantitative image analysis. Documentation compiled with <a href="https://crisluengo.github.io/doxpp/">dox++</a> and styled with <a href="https://mcss.mosra.cz/">m.css</a>.</p>
      </div>
    </div>
  </div>
</nav></footer>
</body>
</html>